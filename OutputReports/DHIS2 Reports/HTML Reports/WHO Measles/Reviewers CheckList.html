<html>

<head>
    <title>HIV Care and ART Treatment-Individual Patient Summary</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <style>
        .report-table {
            text-align: left;
        }

        /* Absolute Center Spinner */

        .loading {
            position: fixed;
            z-index: 999;
            height: 2em;
            width: 2em;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            display: none;
        }

        /* Transparent Overlay */

        .loading:before {
            content: '';
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* :not(:required) hides these rules from IE9 and below */

        .loading:not(:required) {
            /* hide "loading..." text */
            font: 0/0 a;
            color: transparent;
            text-shadow: none;
            background-color: transparent;
            border: 0;
        }

        .loading:not(:required):after {
            content: '';
            display: block;
            font-size: 10px;
            width: 1em;
            height: 1em;
            margin-top: -0.5em;
            -webkit-animation: spinner 1500ms infinite linear;
            -moz-animation: spinner 1500ms infinite linear;
            -ms-animation: spinner 1500ms infinite linear;
            -o-animation: spinner 1500ms infinite linear;
            animation: spinner 1500ms infinite linear;
            border-radius: 0.5em;
            -webkit-box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.5) -1.5em 0 0 0, rgba(0, 0, 0, 0.5) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
            box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) -1.5em 0 0 0, rgba(0, 0, 0, 0.75) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
        }

        /* Animation */

        @-webkit-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-moz-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @-o-keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        @keyframes spinner {
            0% {
                -webkit-transform: rotate(0deg);
                -moz-transform: rotate(0deg);
                -ms-transform: rotate(0deg);
                -o-transform: rotate(0deg);
                transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
                -moz-transform: rotate(360deg);
                -ms-transform: rotate(360deg);
                -o-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

        button {
            cursor: pointer;
        }
    </style>

</head>

<body>

    <a id="dlink" style="display:none;"></a>

    <button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;position:fixed;z-index:1"
        onclick="printContent('printing')"><span class="glyphicon glyphicon-print" style="font-size: 15px;"></span>
        &nbsp;
        Print
    </button>
    <button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;position:fixed;z-index:1;margin-left:4em;" id="btnExport"
        onclick="tableToExcel('printing', 'Reviewers CheckList', 'Reviewers CheckList')"><span
            class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span>Download As Excel
        </button>
    
    <br/>
    <div style="width: 50%; margin: 0 auto;">
        <table class="table table-borderless table-striped">
            <tr style="border: 1px solid #F8F8F8;">
                <td style="font-size: 15px;padding-top: 15px;">
                    <label for="dateFormat"><strong>Select Reviewer: </strong></label>
                </td>
                <td style="width: 60%;">
                    <select class="form-control" id="reviewer-names" onchange="showData()">
                        <option selected hidden>Please select a reviewer</option>
                    </select>
                </td>
            </tr>
        </table>
    </div>

    <div id="loader"></div>

    <div id="printing" class="animate-bottom">

        <table class="table table-hover table-bordered" id="report-table" style="display:none">
            <colgroup>
                <col width="50%">
                <col width="50%">
              </colgroup>
            
            <tbody id="table-body"></tbody>
            
        </table>
    </div>
</body>
<script>
    var selectedOrgunit = dhis2.report.organisationUnit;
    var selectedPeriod = dhis2.report.periods["0"];
    var bodyList = [
        "Review items",
        "Executive summary",
        "Progress on three criteria for verification addressed",
        "Progress on three criteria for verification addressed",
        "National Verification Committee (NVC)",
        "Signed cover letter",
        "Any change in current membership",
        "Evidence of active NVC",
        "Comment on TOR, if any change required or made?",
        "NVC has a well described plan for 2018",
        "Key definitions-Are they aligned with the Regional framework or do they require any change?",
        "Country demography",
        "Does the report have<br/> 1) a country map,<br/> 2) description of the health system with reference to infectious disease reporting system and<br/> 3) have high risk/hard-to-reach populations been identified?",
        "History of measles, rubella and CRS control in the country",
        "Key milestones included",
        "Does the country have a national plan or equivalent for measles elimination and rubella control?",
        `Recent strategic changes made in ${selectedPeriod} for measles and rubella program, if any`,
        "Surveillance system well described",
        "1.	A detailed description of the epidemiology of measles and rubella since the introduction of measles and rubella vaccine in the national immunization programme",
        "Incidence for last 10 years or more",
        "Epidemic curve for last 5 years ",
        "Spot map for the last two years ",
        "Age distribution and vaccination status of cases",
        "Case classification",
        "Case classification (endemic, imported, import related, unknown)",
        "CRS cases- comparison of Incidence in 2008/2010 or year for which it is available   and currently in 2017. Is reduction more than 90%",
        "2.	Genotyping and molecular evidence that measles and rubella virus transmission was interrupted",
        "Endemic genotype",
        "Non-endemic genotype",
        "3.	A. Epidemiological surveillance and laboratory performance quality- for measles and rubella",
        "Timeliness of reporting to national level ",
        "Reporting rate of non-measles non-rubella cases as proxy to sensitivity of surveillance at national level",
        "Second level administrative unit reporting at least 2 non-measles-non-rubella cases per 100,000 population as proxy to representativeness of surveillance ",
        "Case investigation initiated within 48 hours of notification",
        "Timeliness of specimen transport",
        "Timeliness of laboratory reporting",
        "Virology /viral detection completed within 2 months",
        "Accreditation of MR laboratories",
        "Additional evidence of surveillance quality/ other parallel surveillance systems",
        "3.	B. Epidemiological surveillance and laboratory performance quality- for CRS",
        "Suspected CRS cases well investigated with all key data points",
        "Timeliness of specimen transport",
        "Timeliness of laboratory reporting ",
        "Virology /viral detection completed within 2 months",
        "Additional evidence on surveillance quality",
        "4.	High Population Immunity ",
        "Vaccination coverage estimates",
        "Supplementary immunization activities to close immunity gap in children and adult population",
        "Qualitative assessment of immunization activities ",
        "Survey information",
        "Sero-epidemiological survey",
        "Surveillance dependent data and models- Immunity profile by age cohort",
        "Risk assessment at subnational level ",
        "5.	Sustainability of national immunization program for measles elimination",
        "Evidence on budgeted national plan for measles and rubella (e.g. - Comprehensive Multi-Year Plan of Action (cMYPA) or equivalent)",
        "Documented evidence of monitoring and reviewing progress of plans",
        "Evidence of immunization system security (secured funding for vaccines, SPOS at each level etc.) ",
        "Written programmatic risk assessment at sub-national level ",
        "Budgeted importation and outbreak preparedness and response plan",
        "Evidence of capacity for epidemiological investigation and analysis of outbreaks at national and sub-national level",
        "NVC conclusions and recommendations",
        "1. Detailed description of the current and past epidemiology of measles, rubella and congenital rubella syndrome (CRS) available",
        "2. Molecular epidemiology analyzed to document viral transmission patterns and the duration of circulation of viruses of specific lineages",
        "3. Quality of surveillance and monitoring systems for measles, rubella and CRS",
        "4. High population immunity presented as a birth cohort analysis, including evidence on adults and underserved, migrant and refugee groups",
        "5. Accountability",
        "Issues and challenges as identified by NVC for progress towards measles elimination and rubella/CRS control. Do you endorse the conclusions and recommendations of NVC?",
        "Any other relevant aspect the reviewer wants to flag or highlight",
        "Reviewers comments and evaluations on progress towards measles elimination and rubella /CRS control: ",
        "Reviewers classification of the country for measles ",
        "If classified as endemic, please classify one of the below",
        "A. Immunity gap mainly in children/ adolescent and adults/undefined",
        "B. Surveillance quality - Elimination standard, High quality, Inadequate",
        "Additional comment",
        "Reviewers classification of the country for rubella ",
        "Additional comment",
        "Reviewers classification of the country for CRS",
        "Additional comment",
        "Reviewer’s recommendation to the country"
    ]
    var dataElements = [
        "GRwnSQpR1cPv",
        "NWtPBCVQAZy",
        "KdWmb8t1Pn2",
        ["YFSTJGSI3B3", "MSazUqF2PR7", "H19z0eY37nu"],
        "X6GSYFOu1I5",
        "DkgDFbolpP9",
        "QpN6Pf1UNIY",
        "SYDcNIXM1qS",
        "ifI3f12nAM4",
        "EyIZZMatRR3",
        "tEHlxdP31Km",
        "g4jniDOj8Mn",
        ["u6VyRVESapR", "va4Zits6nvK", "hRQNbgKydW2"],
        "KzWR3ZURSh2",
        "yU56UQaOc1G",
        "IRJhQpaXrpG",
        "al5vOX4f05P",
        "qofwmGg7aDo",
        "No52FO4YVqS",
        "QzzgcfLda8j",
        "etJwuF8ebOM",
        "AC7gHO1yVR3",
        "DANs5hCdUck",
        "P3fcfpBKpFy",
        ["deP65l2DeiX", "tSdzeBFAqUD", "vpoUe4RjcoL", "pmXiykBkICZ"],
        "IIWqxF4nItw",
        "CzjLL2L3sTQ",
        "Fgea1HxQsZ0",
        "qSjja1FbUq1",
        "YWoAxh0IN43",
        "CeOrmsBVtqh",
        "r46cuCvUMar",
        "DAKujPqUyyK",
        "EAn64RkRRpZ",
        "XFL3qot40Us",
        "azBBvjzBZxY",
        "jzqwzRoJLbx",
        "luazl7sAumu",
        "ykMgMAhdIVd",
        "d8hiGhmCw0k",
        "c2lGK1r5fOS",
        "BrmAJWCpWHs",
        "BfI9dqDBwID",
        "ayLp4vtraJg",
        "dk64ebZjtvF",
        "wC5eHimKJcx",
        "yfMgMzNwgTf",
        "HQHIFdoWT3r",
        "c3hq0oHJTMK",
        "OqRicqfalWl",
        "YQUDtj4UCEi",
        "KRJtuo1eJ66",
        "x5lQO663EYq",
        "dq0uttgvJwj",
        "ab8PT0rc7uJ",
        "h6vFIVhXNjH",
        "mSag5qcPlWn",
        "TE3zS0W0jAv",
        "xwq2ulliHU7",
        "KWFcBGosj4J",
        "Gr0oDlXW8tc",
        "DIgF6qAP7BQ",
        "PSGp9EV8N7z",
        "bADVPZtQSz2",
        "yMkTtJgeQSs",
        "oYQSR9cSbkX",
        "tU9eYuqapvS",
        "cdxxDAifzkh",
        "vWjgC0e2e7O",
        "g1vkL9lvBYu",
        "vcL6DCBcwRW",
        "SykAZpyN3Oh",
        "UxIX3SlcIu2",
        "W5trqQ9357N",
        "KJVtChEsCJI",
        "umJPuJHItk2",
        "N2YoN6kzCYY",
        "b9ZVNrF18ux",
        "yTWsQrs3fsM",
    ]
    var printValue = [];
    document.getElementById("report-table").style.display = "none";
    document.getElementById("loader").style.display = "block";
    $.ajax({
        async: false,
        type: "GET",
        url: `../../events.json?program=SkWSuOzF0Pu&programStage=Djj0AaPEdAu&orgUnit=${selectedOrgunit.id}&startDate=${selectedPeriod}-01-01&endDate=${selectedPeriod}-12-31&paging=false`,
        success: function (datas) {
            datas.events.forEach(data => {
                printValue[data.event] = []
                data.dataValues.forEach(dataValue => {
                    printValue[data.event][dataValue.dataElement] = dataValue.value;
                })
                document.getElementById("reviewer-names").innerHTML += `<option value="${data.event}">${printValue[data.event]["z7qWGu5M887"]}</option>`
            })
        }
    });
    
    function showData() {
        
        let eventId = document.getElementById("reviewer-names").value;
        var tableRow = "";
        tableRow +=`<tr>
                    <td colspan="2" style="background-color:#F8F8F8"><span style="font-weight:bold">Country under review:</span> ${selectedOrgunit.name}</td>

                </tr>
                <tr>
                    <td colspan="2" style="background-color:#F8F8F8"><span style="font-weight:bold">Year of Review:</span> ${selectedPeriod}</td>

                </tr>
                <tr>
                    <td colspan="2" style="background-color:#F8F8F8"><span style="font-weight:bold">Name of the reviewer:</span> ${printValue[eventId]["z7qWGu5M887"]}</td>

                </tr>
                <tr>
                    <td colspan="2" style="font-weight:bold;background-color:#F8F8F8">
                        Remarks/comments of the reviewer under the following headings:
                    </td>
                </tr>`
        for (let i = 0; i < bodyList.length; i++) {
            if(i == 18) tableRow += `<tr><td style="font-weight:bold; background-color:#F8F8F8" colspan="2">Progress towards five lines of evidence (please provide brief comment on each of these below)</td></tr>`;
            if(i == 61) tableRow += `<tr><td style="font-weight:bold; background-color:#F8F8F8" colspan="2">Comment on Progress towards five lines of evidence</td></tr>`;
            
            if(i >= "70" && i <= "73" && selectedPeriod >= "2020") continue;
            else if (i == 3) tableRow += `<tr>
                                    <td style="font-weight:bold">${bodyList[i]}</td>
                                    <td>${printValue[eventId][dataElements["3"]["0"]] ? `<span style="font-weight:bold">a. Documentation of interruption of endemic measles and rubella for at least 36 months:</span><br/>${printValue[eventId][dataElements["3"]["0"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["3"]["1"]] ? `<span style="font-weight:bold">b. Presence of elimination standard surveillance:</span><br/>${printValue[eventId][dataElements["3"]["1"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["3"]["2"]] ? `<span style="font-weight:bold">c. Genotyping and molecular evidence that supports interruption:</span><br/>${printValue[eventId][dataElements["3"]["2"]]}<br/>` : " "}
                                    </td>
                                    </tr>`;
            else if (i == 12) tableRow += `<tr>
                                    <td style="font-weight:bold">${bodyList[i]}</td>
                                    <td>${printValue[eventId][dataElements["12"]["0"]] ? `<span style="font-weight:bold"> 1) </span> ${printValue[eventId][dataElements["12"]["0"]]}<br/>` : " "}
                                         ${printValue[eventId][dataElements["12"]["1"]] ? `<span style="font-weight:bold"> 2) </span> ${printValue[eventId][dataElements["12"]["1"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["12"]["2"]] ? `<span style="font-weight:bold"> 3) </span>  ${printValue[eventId][dataElements["12"]["2"]]}<br/>` : " "}
                                    </td>
                                    </tr>`;
           
            else if (i == 24) tableRow += `<tr>
                                    <td style="font-weight:bold">${bodyList[i]}</td>
                                    <td>${printValue[eventId][dataElements["24"]["0"]] ? `<span style="font-weight:bold">Endemic: </span>${printValue[eventId][dataElements["24"]["0"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["24"]["1"]] ? `<span style="font-weight:bold">Imported: </span>${printValue[eventId][dataElements["24"]["1"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["24"]["2"]] ? `<span style="font-weight:bold">Import related: </span>${printValue[eventId][dataElements["24"]["2"]]}<br/>` : " "}
                                        ${printValue[eventId][dataElements["24"]["3"]] ? `<span style="font-weight:bold">Unknown: </span>${printValue[eventId][dataElements["24"]["3"]]}<br/>` : " "}
                                    </td>
                                    </tr>`;
            else tableRow += `<tr><td style="font-weight:bold">${bodyList[i]}</td><td>${printValue[eventId][dataElements[i]] ? printValue[eventId][dataElements[i]] : ""}</td></tr>`;
        }
        tableRow +=`<tr>
                    <td><span style="font-weight:bold">Signature of the reviewer: </span><img src="../../events/files?dataElementUid=IgwilgmSsrd&eventUid=${eventId}" alt="No signature attached" height="100' width="100"/></td>
                    <td><span style="font-weight:bold">Date:</span> ${(printValue[eventId]["DyU7krKzmiY"] ? printValue[eventId]["DyU7krKzmiY"] : "___________")}</td>
                </tr>`

        document.getElementById("report-table").style.display = "block";
        document.getElementById("loader").style.display = "none";
        document.getElementById("table-body").innerHTML = tableRow;

    }



    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename + "-" + (selectedOrgunit.name);
            document.getElementById("dlink").click();
        }
    })()

    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }

</script>

</html>