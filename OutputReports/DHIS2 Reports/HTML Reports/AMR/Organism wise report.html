<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        table,
        tr,
        td {
            border: 1px solid black;
            border-collapse: collapse;
            text-align: center;
            font-size: 14px;
            font-family: Roboto, sans-serif;
        }
        .dSelection {
            margin-left: 25%;
            height: 100px;
            width: 550px;
            background-color: #ebf0f6;
            padding: 50px;
            border-radius: 10px;
            font-size: 16px;
            border: 1px solid black;
        }
        option:hover {
        background-color: #f3f3f3  !important;
        }
        #loader {
            position: absolute;
            left: 50%;
            top: 70%;
            z-index: 1;
            width: 150px;
            height: 150px;
            margin: -75px 0 0 -75px;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #34B4DB;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<div class="dSelection">
    <label>Department Name :</label>
    <select name="" id="department" style="height: 30px;">
        <option selected hidden>Select Department</option>
    </select>
    <br />
    <div style="padding: 10px;">
     <label style="margin-right: 30px;">Select Period :</label>
     <select  id="year" style="height: 30px;">
    </select>
    <select name="" id="month" style="height: 30px;">
        <option value="01">January</option>
        <option value="02">February</option>
        <option value="03">March</option>
        <option value="04">April</option>
        <option value="05">May</option>
        <option value="06">June</option>
        <option value="07">July</option>
        <option value="08">August</option>
        <option value="09">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
    </select>
    </div>
    <button style="background-color:rgb(44, 102, 147); margin-left: 10px; border-radius: 10px;height: 35px; font-weight: bold; margin-left: 185px; color: white;" onclick="generateReport()">Generate Report</button>
</div>
<div id="loader"></div>
<div id="print" >
    <button type="button"  style=" background-color: rgb(44, 102, 147); height: 40px; font-weight: bold; padding: 10px; width: 90px; text-align: center; border-radius: 10px; color: white; "onclick="printContent('table')">&nbsp;Print</button>
</div>
<section id="table">
    <table id="table1" width="100%" >
        <thead style="background-color: rgb(44, 102, 147);">
            <tr style="background-color: rgb(44, 102, 147); color: white;">
                <th colspan="11">Three most common isolates</th>
            </tr>
            <tr>
                <th colspan="11" style="background-color: rgb(44, 102, 147); color: white;"> Department - <span class="selectedDepartment"></span></th>
            </tr>
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample1"></span></th>
            </tr>
             <tr style="background-color: #ebf0f6;">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody> 
        </tbody>
    </table>
    <br />
    <table id="table2" width="100%">
        <thead style="background-color: rgb(44, 102, 147);">
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample2"></span></th>
            </tr>
            <tr style="background-color: #ebf0f6;">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <br />
    <table id="table3" width="100%">
        <thead style="background-color: rgb(44, 102, 147);">
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample3"></span></th>
            </tr>
            <tr style="background-color: #ebf0f6">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <br />
    <table id="table4" width="100%">
        <thead style="background-color: rgb(44, 102, 147);">
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample4"></span></th>
            </tr>
            <tr style="background-color: #ebf0f6;">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <br />
    <table id="table5" width="100%">
        <thead style="background-color: rgb(44, 102, 147);">
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample5"></span></th>
            </tr>
            <tr style="background-color: #ebf0f6;">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <br />
    <table id="table6" width="100%">
        <thead style="background-color: rgb(44, 102, 147);">
            <tr>
                <th colspan="11" style="color: white;"> Sample - <span id="sample6"></span></th>
            </tr>
            <tr style="background-color: #ebf0f6;">
                <td>S.No</td>
                <td>Organism Name</td>
                <td>OPD</td>
                <td>ICU</td>
                <td>NICU</td>
                <td>Ward</td>
                <td>CCU</td>
                <td>Burn Unit</td>
                <td>PICU</td>
                <td>Unknown</td>
                <td>Total</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</section>

</html>
<script>
    $('#table').hide()
    $('#loader').hide()
    $('#print').hide()
    var url = '../api/29/categories/uoGPDb7NKXC.json?fields=categoryOptions[displayName,id]&paging=false';
    $.get(url, function (json) {
        for (let opt of json.categoryOptions) {
            let select = document.getElementById('department')
            select.options[select.options.length] = new Option(opt.displayName, JSON.stringify(opt));
        }
    })
    let year = new Date().getFullYear()
      for( let i =1; i<10; i++ ){
             let select = document.getElementById('year')
            select.options[select.options.length] = new Option(year, year);
            year =year-1
      }

    function generateReport() {
        $('#loader').show()
        $('#print').show()
        let dpName = document.getElementById("department").value
        let year = document.getElementById("year").value
        let month = document.getElementById("month").value
        var period = year.concat(month)
        if (dpName === '' || dpName === 'Select Department') {
            alert('Select Department')
           $('#loader').hide()
            return false;
        } else {
              let dp = JSON.parse(dpName)
              let department = dp.displayName
              var dpId = dp.id;
            $('.selectedDepartment').text(department)
            var url2 = '../api/29/analytics.json?dimension=BB34TO1MsbB:o2KJuGuyUQ8;Ci3YWzweFIZ;DlD3fIWinjJ;PDkTBvpXxDL;hUsQwwsNkYs;EixFFe8U26O;fkwG2huZCzS;Evx7exBNN1A&dimension=uoGPDb7NKXC:'+dpId+'&dimension=AapI9odDnk2:nOCKwu6CrWi;fmErXlxWNJe;rsM7PcWW6at;Z8WLvfVppGO;MFQMoYwwUWU;TnI52tKWlV3&dimension=dx:vcAIYI5yREO;wZ7LAmgPWWw;X7iypNUfSJm;gmn116uDf7s;e1IUxzo6g1J;pTCUC4aW6Km;F8XIhKNG5vJ;mYJjJmdJOqw;tXD8XFWShLu;LvZ43nVFRo0;pK7hHbAJK7b;oeTx5HoZdl8;w3g4l2KTcPg;VF1W4Ya1A1T;M2s0qSrhJej;j4pTAIz3Cy8;jIdJQTPkQeL;Rz3lMI7fRbS;kBLWWk3jd42;ULu7XaTIDTS;OXW4u7hVvXS;uca3pIEzbiX;ZF5OKh2kZRQ;K6TrparggHU;BZNcL8jeUPf;wkfpknYuhkM;tQ85XfQoxDc;jRXpq7vJUXu;mzRsc86gEoc;fBUrCfm0YEy;dSisvVZ4d59;FAwYniCYfBF;acAD5WuxgA6;Dy5HaZTpFni;MJQEOmUzffr;J3NQNoWBljN;INLI7NuGyQr;upIQDsLIJzj;mcaCZXuV5D4;NFudkhOso6I;gJznP3m2NRE;VMxNF5iK8dS;dpmZcGHVWZB;z5caDJJZJ1j;JAoSDpqpkyi;IUBUzZPxGrF;bP0L5pKSRY7;RLe066CQyGe;vDLo6oLqDuY;Wqmy4Ele0Al;eP8lKHcKaXC;L7B2ptwmDO9;cRRwk1KUwKG;vsXRwL9otSn;k0F3u9qeeQH;zAI1KUCGWPu;xJP6r1TrmGL;t4KKsLSFAp2;H5K1W8Q1zeE;NKNmuaR8s2N;tqvokkL4TJf;zbTL4RrXNq5;rAC7CcnPU9r;wuXQOZxz9El;vSFbuVNkmOi;gxTCG0Vpcps;w5xXSuQ9Rkp;ywm2iro8c5Z;auXNqzoMcQn;NbBdhKEcCUV;BgyqycBiUIR;yag0FZhCZfZ;jeS639ZOW6b;n0wFL3n68aa;PZWQcSkafCq;uv4t28QJdRR;vN0qlfKHJYv;hErNR35JuIv;rHgmoWaULpH;mSBKBPedoDh;mEdjfTj4PaN;uhjMye9Btov;np2ZmJwhlkT;dtneHlF0wVU;WWZs9GUDdHn;Ovy5Po3M3md;KozFhmkpUhA;yoqq0WHeEnQ;ZUUGtqgpqgU;opRQ63g58sm;hpydGEvRhMJ;Lu5yq1rIyOR;jAepVDlhPEn;jaRrqCnI932;zWaK3RahvGp;YIHMCA8ExQr;BptjMCxkGHI;haO3du80dTz;gsRbyPA2ETG;hMEn8cxOlN7;XbYGDUr8ls2;TRgLeuMACtt;g6wX3liurW8;jUJ6BTXPBRS;h7pnFefA1FW;gt9dMPr4e1X;njAw2Yz8FXQ;StDYA5rCGzm;qGrgqXNmY6F;k2QX2mwzeiN;bXVTDmmMjKl;NyzmVyllwxZ;QsOVM8yoy00;uWC1uTbh1t0;IQdO5CMfs9a&filter=ou:bLfOUtl4eZd&filter=pe:'+period+'&displayProperty=SHORTNAME&outputIdScheme=UID'
            $.get(url2, function (json) {
               $('#table').show()
               $('#loader').hide()
                let obj = {}
                let data = {}
                var dataArr = [], sampleArr = [], locationArr = [];
                var dx = json.metaData.dimensions.dx
                var dp = json.metaData.dimensions.uoGPDb7NKXC
                var sample = json.metaData.dimensions.AapI9odDnk2
                var locations = json.metaData.dimensions.BB34TO1MsbB
                var gObj = { department: {} }
                var jsonObj = json.metaData.items
                for (let d of dx) {
                    let o = {}
                    for (let de in jsonObj) {
                        if (d === de) {
                            o['name'] = jsonObj[de].name
                            o['id'] = d
                            dataArr.push(o)
                        }
                    }
                }
                for (let s of sample) {
                    let o = {}
                    for (let pro in jsonObj) {
                        if (s === pro) {
                            o['name'] = jsonObj[pro].name
                            o['id'] = s
                            sampleArr.push(o)
                        }
                    }
                }
                for (let d of locations) {
                    let o = {}
                    for (let de in jsonObj) {
                        if (d === de) {
                            o['name'] = jsonObj[de].name
                            o['id'] = d
                            locationArr.push(o)
                        }
                    }
                }               
                for (let sample of sampleArr) {
                    gObj.department[sample.name] = {}
                    for (let location of locationArr) {
                        gObj.department[sample.name][location.name] = []
                        let o = {}
                        for (let data of json.rows) {
                            if (sample.id == data['3'] && location.id == data['1']) {
                                for (let d of dataArr) {
                                    if (d.id === data['0']) {
                                        o[d.name] = Number(data["4"])
                                        gObj.department[sample.name][location.name].shift()
                                        gObj.department[sample.name][location.name].push(o)
                                    }
                                }
                            }
                        }
                    }
                }

                var teckObj = {}
                for (let sample of sampleArr) {
                    teckObj[sample.name] = []
                    for (let d of dataArr) {
                        let no = {}
                        no['name'] = d.name
                        no['total'] = 0
                        for (let location of locationArr) {
                            no[location.name] = ''
                        }
                        teckObj[sample.name].push(no)
                    }
                }
                for (let pro in gObj.department) {
                    for (let pro1 in gObj.department[pro]) {
                        let l = gObj.department[pro][pro1]['0']
                        makeObj(pro, pro1, l)
                    }
                }
                function makeObj(s, l, d) {
                    let myobj = {}
                    myobj[s] = {}
                    for (let p in d) {
                        for (let e of teckObj[s]) {
                            if (p == e.name) {
                                e[l] = d[p]
                                e["total"] += Number(d[p])
                            }
                        }
                    }
                }
                for (let sample of sampleArr) {
                    let arr = teckObj[sample.name].sort((a, b) => (a.total < b.total) ? 1 : ((b.total < a.total) ? -1 : 0)).slice(0, 3)
                      printData(sample, arr)
                }

                function printData(sample, arr){
                    if(sample.name == "Blood (Attribute)"){
                         $('#sample1').text(sample.name)
                        $('#table1').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table1').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                    if(sample.name == "LRT (Lower Respiratory Tract) (Attribute)"){
                        $('#sample2').text(sample.name)
                        $('#table2').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table2').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                    if(sample.name == "Superficial Infection (Attribute)"){
                        $('#sample3').text(sample.name)
                        $('#table3').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table3').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                    if(sample.name == "Sterile Sites (Attribute)"){
                        $('#sample4').text(sample.name)
                        $('#table4').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table4').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                    if(sample.name == "Others (Attribute)"){
                        $('#sample5').text(sample.name)
                        $('#table5').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table5').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                    
                    if(sample.name == "Urine (Attribute)"){
                        $('#sample6').text(sample.name)
                        $('#table6').find("tbody").empty()
                        let i =1;
                        for( let element of arr){
                            $('#table6').find('tbody').append(`<tr><td>${i}</td><td>${element.name}</td><td>${element.OPD}</td><td>${element.ICU}</td><td>${element.NICU}</td><td>${element.Ward}</td><td>${element.CCU}</td><td>${element['Burn Unit']}</td><td>${element.PICU}</td><td>${element.Unknown}</td><td>${element.total}</td></tr>`);
                             i++;
                        }
                    } 
                }
            })
        }
    }
    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }
</script>