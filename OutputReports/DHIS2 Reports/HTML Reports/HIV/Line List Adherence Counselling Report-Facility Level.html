<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<style>
    table {
        border-collapse: collapse;
    }

    thead>tr>td {
        font-weight: bold;
    }

    tbody>tr>td {
        font-weight: bold;
    }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        opacity: 1;
    }

    /* Center the loader  */
    #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #34B4DB;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Add animation to "page content" */

    .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0px;
            opacity: 1
        }
    }

    @keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0;
            opacity: 1
        }
    }

    #printing {

        text-align: center;
    }



    .nepali-date-picker {
        background: #ffffff none repeat scroll 0 0;
        border: 1px solid #cccccc;
        box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.506);
        box-sizing: border-box;
        color: #333333;
        display: block;
        font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif;
        padding: 8px;
        position: absolute;
        z-index: 9999;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .nepali-date-picker table {
        background-color: transparent;
        border-collapse: collapse;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        border: 2px solid rgba(129, 120, 120, 0.17);
    }

    .nepali-date-picker table thead {
        background: #dedede;
    }

    .nepali-date-picker table th {
        color: #999;
        cursor: default;
        font-weight: 700;
        text-align: center;
        cursor: default;
    }

    .nepali-date-picker table th {
        background: #f1f1f1 none repeat scroll 0 0;
    }

    .nepali-date-picker table thead td {
        color: #8b8686;
        font-weight: bold;
    }

    .nepali-date-picker table td {
        border: 1px solid rgba(154, 150, 150, 0.46);
        color: #666666;
        padding: 0;
        width: 35px;
        text-align: center;
        font-size: 14px;
    }

    .nepali-date-picker table tbody td {
        cursor: pointer;
    }

    .nepali-date-picker table tbody td.current-month-date:hover {
        background-color: #718fcd;
        color: white;
        font-weight: bold;
    }

    .nepali-date-picker table td.other-month-date,
    .nepali-date-picker table td.current-month-date.disable {
        color: #cccccc;
        cursor: default;
    }

    .nepali-date-picker table tbody td.current-month-date.disable:hover {
        background-color: inherit;
        color: #cccccc;
        font-weight: normal;
    }

    .nepali-date-picker .icon {
        opacity: 0.5;
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAeCAYAAADaW7vzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Q0NBRjI1NjM0M0UwMTFFNDk4NkFGMzJFQkQzQjEwRUIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6Q0NBRjI1NjQ0M0UwMTFFNDk4NkFGMzJFQkQzQjEwRUIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDQ0FGMjU2MTQzRTAxMUU0OTg2QUYzMkVCRDNCMTBFQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDQ0FGMjU2MjQzRTAxMUU0OTg2QUYzMkVCRDNCMTBFQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PoNEP54AAAIOSURBVHja7Jq9TsMwEMcxrZD4WpBYeKUCe+kTMCACHZh4BFfHO/AAIHZGFhYkBBsSEqxsLCAgXKhbXYOTxh9pfJVP+qutnZ5s/5Lz2Y5I03QhWji2GIcgAokWgfCxNvcOCCGKqiSqhUp0laHOne05vdEyGMfkdxJDVjgwDlEQgYQBgx+ULJaWSXXS6r/ER5FBVR8VfGftTKcITNs+a1XpcFoExREIDF14AVIFxgQUS+h520cdud6wNkC0UBw6BCO/HoCYwBhD8QCkQ/x1mwDyD4plh4D6DDV0TAGyo4HcawLIBBSLDkHeH0Mg2yVP3l4TQMZQDDsEOl/MgHQqhMNuE0D+oBh0CIr8MAKyazBH9WyBuKxDWgbXfjNf32TZ1KWm/Ap1oSk/R53UtQ5xTh3LUlMmT8gt6g51Q9p+SobxgJQ/qmsfZhWywGFSl0yBjCLJCMgXail3b7+rumdVJ2YRss4cN+r6qAHDkPWjPjdJCF4n9RmAD/V9A/Wp4NQassDjwlB6XBiCxcJQWmZZb8THFilfy/lfrTvLghq2TqTHrRMTKNJ0sIhdo15RT+RpyWwFdY96UZ/LdQKBGjcXpcc1AlSFEfLmouD+1knuxBDUVrvOBmoOC/rEcN7OQxKVeJTCiAdUzUJhA2Oez9QTkp72OTVcxDcXY8iKNkxGAJXmJCOQwOa6dhyXsOa6XwEGAKdeb5ET3rQdAAAAAElFTkSuQmCC");
    }

    .nepali-date-picker .icon:hover {
        opacity: 1;
    }

    .nepali-date-picker .prev-btn.icon {
        background-position: 80px center;
        float: left;
        height: 30px;
        width: 20px;
    }

    .current-month-date.active,
    .drop-down-content li.active {
        background-color: #7bde77;
        color: white;
        font-weight: bold;
    }

    .nepali-date-picker .next-btn.icon {
        background-position: 0 center;
        float: right;
        height: 30px;
        width: 20px;
    }

    .nepali-date-picker .today-btn.icon {
        background-position: 130px center;
        display: block;
        float: left;
        height: 30px;
        margin: 0 15px;
        width: 20px;
    }

    .nepali-date-picker .current-month-txt {
        color: #545b54;
        cursor: pointer;
        display: inline-block;
        font-weight: bold;
        line-height: 30px;
        padding-right: 20px;
        position: relative;
        text-align: right;
        width: 80px;
    }

    .nepali-date-picker .current-year-txt {
        color: #545b54;
        font-weight: bold;
        padding-right: 20px;
        cursor: pointer;
        position: relative;
        display: inline-block;
        line-height: 30px;
    }

    .nepali-date-picker .current-year-txt:hover,
    .nepali-date-picker .current-month-txt:hover {
        text-decoration: underline;
    }

    .nepali-date-picker .calendar-controller i.icon-drop-down {
        background-position: 12px -15px;
        height: 30px;
        position: absolute;
        width: 20px;
    }

    .nepali-date-picker .drop-down-content {
        background-color: #ffffff;
        border: 1px solid #cccccc;
        box-shadow: 0 3px 3px 0 rgba(0, 0, 0, 0.32);
        display: none;
        height: 99px;
        padding: 5px;
        position: absolute;
        width: 100%;
        /*overflow: hidden;*/
    }


    .nepali-date-picker .scrollbar-wrapper {
        border-left: 1px solid rgba(204, 204, 204, 0.2);
        height: 100%;
        position: absolute;
        right: 0;
        top: 0;
        width: 15px;
    }

    .scrollbar {
        background-color: black;
        border-radius: 2.5px;
        display: block;
        height: 100%;
        opacity: 0.5;
        position: absolute;
        right: 6.5px;
        width: 5px;
    }

    .nepali-date-picker .drop-down-content .option-wrapper {
        height: 100%;
        overflow-x: hidden;
        overflow-y: scroll;
        padding: 0;
        position: relative;
    }

    .nepali-date-picker .drop-down-content ul {
        list-style: outside none none;
        margin: 0;
        padding: 0 5px 0 0;
    }


    .drop-down-content li {
        border-bottom: 1px solid rgba(159, 153, 153, 0.39);
        font-size: 16px;
        font-weight: normal;
        line-height: 20px;
        text-align: right;
    }

    .drop-down-content li:hover {
        background: #718fcd;
    }


    .drop-down-content li:last-child {
        border-bottom: medium none;
    }

    ::-webkit-scrollbar {
        width: 13px;
        height: 13px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.5);
    }
</style>
<script>
    var calendarFunctions = {};
    (function ($) {
        var calendarData = {
            bsMonths: ["बैशाख", "जेठ", "असार", "सावन", "भदौ", "असोज", "कार्तिक", "मंसिर", "पौष", "माघ", "फागुन", "चैत"],
            bsDays: ["आईत", "सोम", "मंगल", "बुध", "बिही", "शुक्र", "शनि"],
            nepaliNumbers: ["०", "१", "२", "३", "४", "५", "६", "७", "८", "९"],
            bsMonthUpperDays: [
                [30, 31],
                [31, 32],
                [31, 32],
                [31, 32],
                [31, 32],
                [30, 31],
                [29, 30],
                [29, 30],
                [29, 30],
                [29, 30],
                [29, 30],
                [30, 31]
            ],
            extractedBsMonthData: [
                [0, 1, 1, 22, 1, 3, 1, 1, 1, 3, 1, 22, 1, 3, 1, 3, 1, 22, 1, 3, 1, 19, 1, 3, 1, 1, 3, 1, 2, 2, 1, 3, 1],
                [1, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 3, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 1, 3, 1, 1, 2],
                [0, 1, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 1, 3, 1, 1, 2],
                [1, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 2, 2, 1, 3, 1, 2, 2, 2, 1, 2],
                [59, 1, 26, 1, 28, 1, 2, 1, 12],
                [0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 1, 1, 2, 2, 1, 3, 1, 2, 1, 2],
                [0, 12, 1, 3, 1, 3, 1, 5, 1, 11, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 27, 1, 2],
                [1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 3, 1, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 15, 2, 4],
                [0, 1, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 3, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 15, 2, 4],
                [1, 1, 3, 1, 3, 1, 14, 1, 3, 1, 1, 1, 3, 1, 14, 1, 3, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 3, 1, 14, 1, 3, 15, 1, 2, 1, 1],
                [0, 1, 1, 3, 1, 3, 1, 10, 1, 3, 1, 3, 1, 1, 1, 3, 1, 3, 1, 10, 1, 3, 1, 3, 1, 3, 1, 3, 1, 14, 1, 3, 1, 3, 1, 3, 1, 3, 1, 10, 1, 20, 1, 1, 1],
                [1, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 20, 3]
            ],
            minBsYear: 1970,
            maxBsYear: 2100,
            minAdDateEqBsDate: {
                "ad": {
                    "year": 1913, "month": 3, "date": 13
                },
                "bs": {
                    "year": 1970, "month": 1, "date": 1
                }
            }
        };

        var validationFunctions = {
            validateRequiredParameters: function (requiredParameters) {
                $.each(requiredParameters, function (key, value) {
                    if (typeof value === "undefined" || value === null) {
                        throw new ReferenceError("Missing required parameters: " + Object.keys(requiredParameters).join(", "));
                    }
                });
            },
            validateBsYear: function (bsYear) {
                if (typeof bsYear !== "number" || bsYear === null) {
                    throw new TypeError("Invalid parameter bsYear value");
                } else if (bsYear < calendarData.minBsYear || bsYear > calendarData.maxBsYear) {
                    throw new RangeError("Parameter bsYear value should be in range of " + calendarData.minBsYear + " to " + calendarData.maxBsYear);
                }
            },
            validateAdYear: function (adYear) {
                if (typeof adYear !== "number" || adYear === null) {
                    throw new TypeError("Invalid parameter adYear value");
                } else if (adYear < calendarData.minBsYear - 57 || adYear > calendarData.maxBsYear - 57) {
                    throw new RangeError("Parameter adYear value should be in range of " + (calendarData.minBsYear - 57) + " to " + (calendarData.maxBsYear - 57));
                }
            },
            validateBsMonth: function (bsMonth) {
                if (typeof bsMonth !== "number" || bsMonth === null) {
                    throw new TypeError("Invalid parameter bsMonth value");
                } else if (bsMonth < 1 || bsMonth > 12) {
                    throw new RangeError("Parameter bsMonth value should be in range of 1 to 12");
                }
            },
            validateAdMonth: function (adMonth) {
                if (typeof adMonth !== "number" || adMonth === null) {
                    throw new TypeError("Invalid parameter adMonth value");
                } else if (adMonth < 1 || adMonth > 12) {
                    throw new RangeError("Parameter adMonth value should be in range of 1 to 12");
                }
            },
            validateBsDate: function (bsDate) {
                if (typeof bsDate !== "number" || bsDate === null) {
                    throw new TypeError("Invalid parameter bsDate value");
                } else if (bsDate < 1 || bsDate > 32) {
                    throw new RangeError("Parameter bsDate value should be in range of 1 to 32");
                }
            },
            validateAdDate: function (adDate) {
                if (typeof adDate !== "number" || adDate === null) {
                    throw new TypeError("Invalid parameter adDate value");
                } else if (adDate < 1 || adDate > 31) {
                    throw new RangeError("Parameter adDate value should be in range of 1 to 31");
                }
            },
            validatePositiveNumber: function (numberParameters) {
                $.each(numberParameters, function (key, value) {
                    if (typeof value !== "number" || value === null || value < 0) {
                        throw new ReferenceError("Invalid parameters: " + Object.keys(numberParameters).join(", "));
                    } else if (key === "yearDiff" && value > (calendarData.maxBsYear - calendarData.minBsYear + 1)) {
                        throw new RangeError("Parameter yearDiff value should be in range of 0 to " + (calendarData.maxBsYear - calendarData.minBsYear + 1));
                    }
                });
            }
        };

        $.extend(calendarFunctions, {
            /**
             * Return equivalent number in nepaliNumber
             * @param {Number} number
             * @returns {String} nepaliNumber
             */
            getNepaliNumber: function (number) {
                if (typeof number === "undefined") {
                    throw new Error("Parameter number is required");
                } else if (typeof number != "number" || number < 0) {
                    throw new Error("Number should be positive integer");
                }

                var prefixNum = Math.floor(number / 10);
                var suffixNum = number % 10;
                if (prefixNum !== 0) {
                    return calendarFunctions.getNepaliNumber(prefixNum) + calendarData.nepaliNumbers[suffixNum];
                } else {
                    return calendarData.nepaliNumbers[suffixNum];
                }
            },
            /**
             * Return equivalent number from nepaliNumber
             * @param {String} nepaliNumber
             * @returns {Number} number
             */
            getNumberByNepaliNumber: function (nepaliNumber) {
                if (typeof nepaliNumber === "undefined") {
                    throw new Error("Parameter nepaliNumber is required");
                } else if (typeof nepaliNumber !== "string") {
                    throw new Error("Parameter nepaliNumber should be in string");
                }

                var number = 0;
                for (var i = 0; i < nepaliNumber.length; i++) {
                    var numIndex = calendarData.nepaliNumbers.indexOf(nepaliNumber.charAt(i));
                    if (numIndex === -1) {
                        throw new Error("Invalid nepali number");
                    }
                    number = number * 10 + numIndex;
                }

                return number;
            },
            getBsMonthInfoByBsDate: function (bsYear, bsMonth, bsDate, dateFormatPattern) {
                validationFunctions.validateRequiredParameters({ "bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate });
                validationFunctions.validateBsYear(bsYear);
                validationFunctions.validateBsMonth(bsMonth);
                validationFunctions.validateBsDate(bsDate);
                if (dateFormatPattern === null) {
                    dateFormatPattern = "%D, %M %d, %y";
                } else if (typeof dateFormatPattern != "string") {
                    throw new TypeError("Invalid parameter dateFormatPattern value");
                }

                var daysNumFromMinBsYear = calendarFunctions.getTotalDaysNumFromMinBsYear(bsYear, bsMonth, bsDate);
                var adDate = new Date(calendarData.minAdDateEqBsDate.ad.year, calendarData.minAdDateEqBsDate.ad.month, calendarData.minAdDateEqBsDate.ad.date - 1);
                adDate.setDate(adDate.getDate() + daysNumFromMinBsYear);

                var bsMonthFirstAdDate = calendarFunctions.getAdDateByBsDate(bsYear, bsMonth, 1);
                var bsMonthDays = calendarFunctions.getBsMonthDays(bsYear, bsMonth);
                bsDate = (bsDate > bsMonthDays) ? bsMonthDays : bsDate;
                var eqAdDate = calendarFunctions.getAdDateByBsDate(bsYear, bsMonth, bsDate);
                var weekDay = eqAdDate.getDay() + 1;
                var formattedDate = calendarFunctions.bsDateFormat(dateFormatPattern, bsYear, bsMonth, bsDate);
                return {
                    bsYear: bsYear,
                    bsMonth: bsMonth,
                    bsDate: bsDate,
                    weekDay: weekDay,
                    formattedDate: formattedDate,
                    adDate: eqAdDate,
                    bsMonthFirstAdDate: bsMonthFirstAdDate,
                    bsMonthDays: bsMonthDays
                };
            },
            getAdDateByBsDate: function (bsYear, bsMonth, bsDate) {
                validationFunctions.validateRequiredParameters({ "bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate });
                validationFunctions.validateBsYear(bsYear);
                validationFunctions.validateBsMonth(bsMonth);
                validationFunctions.validateBsDate(bsDate);
                var daysNumFromMinBsYear = calendarFunctions.getTotalDaysNumFromMinBsYear(bsYear, bsMonth, bsDate);
                var adDate = new Date(calendarData.minAdDateEqBsDate.ad.year, calendarData.minAdDateEqBsDate.ad.month, calendarData.minAdDateEqBsDate.ad.date - 1);
                adDate.setDate(adDate.getDate() + daysNumFromMinBsYear);
                return adDate;
            },
            getTotalDaysNumFromMinBsYear: function (bsYear, bsMonth, bsDate) {
                validationFunctions.validateRequiredParameters({ "bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate });
                validationFunctions.validateBsYear(bsYear);
                validationFunctions.validateBsMonth(bsMonth);
                validationFunctions.validateBsDate(bsDate);

                if (bsYear < calendarData.minBsYear || bsYear > calendarData.maxBsYear) {
                    return null;
                }

                var daysNumFromMinBsYear = 0;
                var diffYears = bsYear - calendarData.minBsYear;
                for (var month = 1; month <= 12; month++) {
                    if (month < bsMonth) {
                        daysNumFromMinBsYear += calendarFunctions.getMonthDaysNumFormMinBsYear(month, diffYears + 1);
                    } else {
                        daysNumFromMinBsYear += calendarFunctions.getMonthDaysNumFormMinBsYear(month, diffYears);
                    }
                }

                if (bsYear > 2085 && bsYear < 2088) {
                    daysNumFromMinBsYear += bsDate - 2;
                } else if (bsYear === 2085 && bsMonth > 5) {
                    daysNumFromMinBsYear += bsDate - 2;
                } else if (bsYear > 2088) {
                    daysNumFromMinBsYear += bsDate - 4;
                } else if (bsYear === 2088 && bsMonth > 5) {
                    daysNumFromMinBsYear += bsDate - 4;
                } else {
                    daysNumFromMinBsYear += bsDate;
                }

                return daysNumFromMinBsYear;
            },
            /**
             * Return total number of bsMonth days from minYear
             * @param {int} bsMonth
             * @param {int} yearDiff
             * @returns {int}
             */
            getMonthDaysNumFormMinBsYear: function (bsMonth, yearDiff) {
                validationFunctions.validateRequiredParameters({ "bsMonth": bsMonth, "yearDiff": yearDiff });
                validationFunctions.validateBsMonth(bsMonth);
                validationFunctions.validatePositiveNumber({ "yearDiff": yearDiff });

                var yearCount = 0;
                var monthDaysFromMinBsYear = 0;
                if (yearDiff === 0) {
                    return 0;
                }

                var bsMonthData = calendarData.extractedBsMonthData[bsMonth - 1];
                for (var i = 0; i < bsMonthData.length; i++) {
                    if (bsMonthData[i] === 0) {
                        continue;
                    }

                    var bsMonthUpperDaysIndex = i % 2;
                    if (yearDiff > yearCount + bsMonthData[i]) {
                        yearCount += bsMonthData[i];
                        monthDaysFromMinBsYear += calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] * bsMonthData[i];
                    } else {
                        monthDaysFromMinBsYear += calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] * (yearDiff - yearCount);
                        yearCount = yearDiff - yearCount;
                        break;
                    }
                }

                return monthDaysFromMinBsYear;
            },
            /**
             * Return number of bsMonth days
             * @param {int} bsYear
             * @param {int} bsMonth
             * @returns {int} days
             */
            getBsMonthDays: function (bsYear, bsMonth) {
                validationFunctions.validateRequiredParameters({ "bsYear": bsYear, "bsMonth": bsMonth });
                validationFunctions.validateBsYear(bsYear);
                validationFunctions.validateBsMonth(bsMonth);

                var yearCount = 0;
                var totalYears = (bsYear + 1) - calendarData.minBsYear;
                var bsMonthData = calendarData.extractedBsMonthData[bsMonth - 1];
                for (var i = 0; i < bsMonthData.length; i++) {
                    if (bsMonthData[i] === 0) {
                        continue;
                    }

                    var bsMonthUpperDaysIndex = i % 2;
                    yearCount += bsMonthData[i];
                    if (totalYears <= yearCount) {
                        if ((bsYear === 2085 && bsMonth === 5) || (bsYear === 2088 && bsMonth === 5)) {
                            return calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] - 2;
                        } else {
                            return calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex];
                        }
                    }
                }

                return null;
            },
            getBsDateByAdDate: function (adYear, adMonth, adDate) {
                validationFunctions.validateRequiredParameters({ "adYear": adYear, "adMonth": adMonth, "adDate": adDate });
                validationFunctions.validateAdYear(adYear);
                validationFunctions.validateAdMonth(adMonth);
                validationFunctions.validateAdDate(adDate);

                var bsYear = adYear + 57;
                var bsMonth = (adMonth + 9) % 12;
                bsMonth = bsMonth === 0 ? 12 : bsMonth;
                var bsDate = 1;

                if (adMonth < 4) {
                    bsYear -= 1;
                } else if (adMonth === 4) {
                    var bsYearFirstAdDate = calendarFunctions.getAdDateByBsDate(bsYear, 1, 1);
                    if (adDate < bsYearFirstAdDate.getDate()) {
                        bsYear -= 1;
                    }
                }

                var bsMonthFirstAdDate = calendarFunctions.getAdDateByBsDate(bsYear, bsMonth, 1);
                if (adDate >= 1 && adDate < bsMonthFirstAdDate.getDate()) {
                    bsMonth = (bsMonth !== 1) ? bsMonth - 1 : 12;
                    var bsMonthDays = calendarFunctions.getBsMonthDays(bsYear, bsMonth);
                    bsDate = bsMonthDays - (bsMonthFirstAdDate.getDate() - adDate) + 1;
                } else {
                    bsDate = adDate - bsMonthFirstAdDate.getDate() + 1;
                }

                return {
                    bsYear: bsYear,
                    bsMonth: bsMonth,
                    bsDate: bsDate
                };
            },
            getBsYearByAdDate: function (adYear, adMonth, adDate) {
                validationFunctions.validateRequiredParameters({ "adYear": adYear, "adMonth": adMonth, "adDate": adDate });
                validationFunctions.validateAdYear(adYear);
                validationFunctions.validateAdMonth(adMonth);
                validationFunctions.validateAdDate(adDate);

                var bsDate = calendarFunctions.getBsDateByAdDate(adYear, adMonth, adDate);
                return bsDate.bsYear;
            },
            getBsMonthByAdDate: function (adYear, adMonth, adDate) {
                validationFunctions.validateRequiredParameters({ "adYear": adYear, "adMonth": adMonth, "adDate": adDate });
                validationFunctions.validateAdYear(adYear);
                validationFunctions.validateAdMonth(adMonth);
                validationFunctions.validateAdDate(adDate);

                var bsDate = calendarFunctions.getBsDateByAdDate(adYear, adMonth, adDate);
                return bsDate.bsMonth;
            },
            bsDateFormat: function (dateFormatPattern, bsYear, bsMonth, bsDate) {
                validationFunctions.validateRequiredParameters({
                    "dateFormatPattern": dateFormatPattern,
                    "bsYear": bsYear,
                    "bsMonth": bsMonth,
                    "bsDate": bsDate
                });
                validationFunctions.validateBsYear(bsYear);
                validationFunctions.validateBsMonth(bsMonth);
                validationFunctions.validateBsDate(bsDate);

                var eqAdDate = calendarFunctions.getAdDateByBsDate(bsYear, bsMonth, bsDate);
                var weekDay = eqAdDate.getDay() + 1;
                var formattedDate = dateFormatPattern;
                formattedDate = formattedDate.replace(/%d/g, calendarFunctions.getNepaliNumber(bsDate));
                formattedDate = formattedDate.replace(/%y/g, calendarFunctions.getNepaliNumber(bsYear));
                formattedDate = formattedDate.replace(/%m/g, calendarFunctions.getNepaliNumber(bsMonth));
                formattedDate = formattedDate.replace(/%M/g, calendarData.bsMonths[bsMonth - 1]);
                formattedDate = formattedDate.replace(/%D/g, calendarData.bsDays[weekDay - 1]);
                return formattedDate;
            },
            parseFormattedBsDate: function (dateFormat, dateFormattedText) {
                validationFunctions.validateRequiredParameters({
                    "dateFormat": dateFormat,
                    "dateFormattedText": dateFormattedText
                });

                var diffTextNum = 0;
                var extractedFormattedBsDate = {
                    "bsYear": null,
                    "bsMonth": null,
                    "bsDate": null,
                    "bsDay": null
                };

                for (var i = 0; i < dateFormat.length; i++) {
                    if (dateFormat.charAt(i) === '%') {
                        var valueOf = dateFormat.substring(i, i + 2);
                        var endChar = dateFormat.charAt(i + 2);
                        var tempText = dateFormattedText.substring(i + diffTextNum);
                        var endIndex = (endChar !== '') ? tempText.indexOf(endChar) : tempText.length;
                        var value = tempText.substring(0, endIndex);

                        if (valueOf === "%y") {
                            extractedFormattedBsDate.bsYear = calendarFunctions.getNumberByNepaliNumber(value);
                            diffTextNum += value.length - 2;
                        } else if (valueOf === "%d") {
                            extractedFormattedBsDate.bsDate = calendarFunctions.getNumberByNepaliNumber(value);
                            diffTextNum += value.length - 2;
                        } else if (valueOf === "%D") {
                            extractedFormattedBsDate.bsDay = calendarData.bsDays.indexOf(value) + 1;
                            diffTextNum += value.length - 2;
                        } else if (valueOf === "%m") {
                            extractedFormattedBsDate.bsMonth = calendarFunctions.getNumberByNepaliNumber(value);
                            diffTextNum += value.length - 2;
                        } else if (valueOf === "%M") {
                            extractedFormattedBsDate.bsMonth = calendarData.bsMonths.indexOf(value) + 1;
                            diffTextNum += value.length - 2;
                        }
                    }
                }

                if (!extractedFormattedBsDate.bsDay) {
                    var eqAdDate = calendarFunctions.getAdDateByBsDate(extractedFormattedBsDate.bsYear, extractedFormattedBsDate.bsMonth, extractedFormattedBsDate.bsDate);
                    extractedFormattedBsDate.bsDay = eqAdDate.getDay() + 1;
                }

                return extractedFormattedBsDate;
            }
        });

        $.fn.nepaliDatePicker = function (options) {
            var datePickerPlugin = {
                options: $.extend({
                    dateFormat: "%D, %M %d, %y",
                    closeOnDateSelect: true,
                    defaultDate: "",
                    minDate: null,
                    maxDate: null,
                    yearStart: calendarData.minBsYear,
                    yearEnd: calendarData.maxBsYear
                }, options),
                init: function ($element) {
                    $element.prop("readonly", true);
                    var $nepaliDatePicker = $('<div class="nepali-date-picker">');
                    $('body').append($nepaliDatePicker);
                    if ($element.val() !== '') {
                        datePickerPlugin.renderFormattedSpecificDateCalendar($nepaliDatePicker, datePickerPlugin.options.dateFormat, $element.val());
                    } else {
                        datePickerPlugin.renderCurrentMonthCalendar($nepaliDatePicker);
                    }
                    datePickerPlugin.addEventHandler($element, $nepaliDatePicker);
                    datePickerPlugin.addCommonEventHandler($nepaliDatePicker);
                },
                addCommonEventHandler: function () {
                    var $datePickerWrapper = $(".nepali-date-picker");
                    $(document).click(function (event) {
                        var $targetElement = $(event.target);
                        if (!$targetElement.is($(".nepali-date-picker"))) {
                            $datePickerWrapper.hide();
                            $datePickerWrapper.find(".drop-down-content").hide();
                        }
                    });
                },
                addEventHandler: function ($element, $nepaliDatePicker) {
                    $element.click(function () {
                        if ($(".nepali-date-picker").is(":visible")) {
                            $(".nepali-date-picker").hide();
                            return;
                        }

                        var inputFieldPosition = $(this).offset();
                        $nepaliDatePicker.css({
                            "top": inputFieldPosition.top + $(this).outerHeight(true),
                            "left": inputFieldPosition.left
                        });

                        if ($element.val()) {
                            datePickerPlugin.renderFormattedSpecificDateCalendar($nepaliDatePicker, datePickerPlugin.options.dateFormat, $element.val());
                        }
                        $nepaliDatePicker.show();
                        datePickerPlugin.eventFire($element, $nepaliDatePicker, "show");

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".next-btn", function (event) {
                        event.preventDefault();
                        var preCalendarData = {
                            "bsYear": $nepaliDatePicker.data().bsYear,
                            "bsMonth": $nepaliDatePicker.data().bsMonth,
                            "bsDate": $nepaliDatePicker.data().bsDate
                        };
                        datePickerPlugin.renderNextMonthCalendar($nepaliDatePicker);
                        datePickerPlugin.triggerChangeEvent($element, $nepaliDatePicker, preCalendarData);
                        $nepaliDatePicker.show();

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".prev-btn", function (event) {
                        event.preventDefault();
                        var preCalendarData = {
                            "bsYear": $nepaliDatePicker.data().bsYear,
                            "bsMonth": $nepaliDatePicker.data().bsMonth,
                            "bsDate": $nepaliDatePicker.data().bsDate
                        };
                        datePickerPlugin.renderPreviousMonthCalendar($nepaliDatePicker);
                        var calendarData = $nepaliDatePicker.data();
                        datePickerPlugin.triggerChangeEvent($element, $nepaliDatePicker, preCalendarData);
                        $nepaliDatePicker.show();

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".today-btn", function (event) {
                        event.preventDefault();
                        var preCalendarData = {
                            "bsYear": $nepaliDatePicker.data().bsYear,
                            "bsMonth": $nepaliDatePicker.data().bsMonth,
                            "bsDate": $nepaliDatePicker.data().bsDate
                        };
                        datePickerPlugin.renderCurrentMonthCalendar($nepaliDatePicker);
                        var calendarData = $nepaliDatePicker.data();
                        datePickerPlugin.triggerChangeEvent($element, $nepaliDatePicker, preCalendarData);
                        $nepaliDatePicker.show();

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".current-year-txt, .current-month-txt", function () {
                        if (!$(this).find(".drop-down-content").is(":visible")) {
                            $nepaliDatePicker.find(".drop-down-content").hide();
                            $(this).find(".drop-down-content").show();
                            var $optionWrapper = $(this).find(".option-wrapper");
                            $optionWrapper.scrollTop(0);
                            var scrollTopTo = $optionWrapper.find(".active").position().top;
                            $optionWrapper.scrollTop(scrollTopTo);
                        } else {
                            $(this).find(".drop-down-content").hide();
                        }

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".current-month-date", function () {
                        if ($(this).hasClass("disable")) {
                            return;
                        }

                        var datePickerData = $nepaliDatePicker.data();
                        var bsYear = datePickerData.bsYear;
                        var bsMonth = datePickerData.bsMonth;
                        var preDate = datePickerData.bsDate;
                        var bsDate = $(this).data("date");
                        var dateText = calendarFunctions.bsDateFormat(datePickerPlugin.options.dateFormat, bsYear, bsMonth, bsDate);
                        $element.val(dateText);
                        datePickerPlugin.setCalendarDate($nepaliDatePicker, bsYear, bsMonth, bsDate);
                        datePickerPlugin.renderMonthCalendar($nepaliDatePicker);


                        if (preDate !== bsDate)
                            datePickerPlugin.eventFire($element, $nepaliDatePicker, "dateChange");
                        datePickerPlugin.eventFire($element, $nepaliDatePicker, "dateSelect");

                        if (datePickerPlugin.options.closeOnDateSelect) {
                            $nepaliDatePicker.hide();
                        } else {
                            $nepaliDatePicker.show();
                        }

                        return false;
                    });

                    $nepaliDatePicker.on("click", ".drop-down-content li", function () {
                        var $dropDown = $(this).parents(".drop-down-content");
                        $dropDown.data("value", $(this).data("value"));
                        $dropDown.attr("data-value", $(this).data("value"));

                        var preCalendarData = {
                            "bsYear": $nepaliDatePicker.data().bsYear,
                            "bsMonth": $nepaliDatePicker.data().bsMonth,
                            "bsDate": $nepaliDatePicker.data().bsDate
                        };
                        var bsMonth = $nepaliDatePicker.find(".month-drop-down").data("value");
                        var bsYear = $nepaliDatePicker.find(".year-drop-down").data("value");
                        var bsDate = preCalendarData.bsDate;
                        datePickerPlugin.setCalendarDate($nepaliDatePicker, bsYear, bsMonth, bsDate);
                        datePickerPlugin.renderMonthCalendar($nepaliDatePicker);
                        var calendarData = $nepaliDatePicker.data();
                        datePickerPlugin.triggerChangeEvent($element, $nepaliDatePicker, preCalendarData);
                        $nepaliDatePicker.show();

                        return false;
                    });
                },
                triggerChangeEvent: function ($element, $nepaliDatePicker, preCalendarData) {
                    var calendarData = $nepaliDatePicker.data();
                    if (preCalendarData.bsYear !== calendarData.bsYear) {
                        datePickerPlugin.eventFire($element, $nepaliDatePicker, "yearChange");
                    }

                    if (preCalendarData.bsMonth !== calendarData.bsMonth) {
                        datePickerPlugin.eventFire($element, $nepaliDatePicker, "monthChange");
                    }

                    if (preCalendarData.bsDate !== calendarData.bsDate) {
                        datePickerPlugin.eventFire($element, $nepaliDatePicker, "dateChange");
                    }
                },
                eventFire: function ($element, $nepaliDatePicker, eventType) {
                    switch (eventType) {
                        case "generate":
                            $element.trigger({
                                type: eventType,
                                message: 'Nepali date picker initialize',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "show":
                            $element.trigger({
                                type: eventType,
                                message: 'Show nepali date picker',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "close":
                            $element.trigger({
                                type: eventType,
                                message: 'close nepali date picker',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "dateSelect":
                            $element.trigger({
                                type: eventType,
                                message: 'Select date',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "dateChange":
                            $element.trigger({
                                type: eventType,
                                message: 'Change date',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "monthChange":
                            $element.trigger({
                                type: eventType,
                                message: 'Change month',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        case "yearChange":
                            $element.trigger({
                                type: eventType,
                                message: 'Change year',
                                datePickerData: $nepaliDatePicker.data(),
                                time: new Date()
                            });
                            break;
                        default:
                            break;
                    }
                },
                setCalendarDate: function ($nepaliDatePicker, bsYear, bsMonth, BsDate) {
                    $nepaliDatePicker.data(calendarFunctions.getBsMonthInfoByBsDate(bsYear, bsMonth, BsDate, datePickerPlugin.options.dateFormat));
                },
                renderMonthCalendar: function ($nepaliDatePicker) {
                    $nepaliDatePicker.find(".calendar-wrapper").remove();
                    $nepaliDatePicker.append(datePickerPlugin.getCalendar($nepaliDatePicker)).hide();
                },
                getCalendar: function ($nepaliDatePicker) {
                    var calendarWrapper = $('<div class="calendar-wrapper">');
                    calendarWrapper.append(datePickerPlugin.getCalendarController($nepaliDatePicker));
                    var calendarTable = $("<table>");
                    calendarTable.append(datePickerPlugin.getCalendarHeader());
                    calendarTable.append(datePickerPlugin.getCalendarBody($nepaliDatePicker));
                    calendarWrapper.append(calendarTable);

                    return calendarWrapper;
                },
                getCalendarController: function ($nepaliDatePicker) {
                    var calendarController = $("<div class='calendar-controller'>");
                    calendarController.append('<a href="javascript:void(0);" class="prev-btn icon" title="prev"></a>');
                    calendarController.append('<a href="javascript:void(0);" class="today-btn icon" title=""></a>');
                    calendarController.append(datePickerPlugin.getMonthDropOption($nepaliDatePicker));
                    calendarController.append(datePickerPlugin.getYearDropOption($nepaliDatePicker));
                    calendarController.append('<a href="javascript:void(0);" class="next-btn icon" title="next"></a>');

                    return calendarController;
                },
                getMonthDropOption: function ($nepaliDatePicker) {
                    var datePickerData = $nepaliDatePicker.data();
                    var $monthSpan = $('<div class="current-month-txt">');
                    $monthSpan.text(calendarData.bsMonths[datePickerData.bsMonth - 1]);
                    $monthSpan.append('<i class="icon icon-drop-down">');

                    var data = [];
                    for (var i = 0; i < 12; i++) {
                        data.push({
                            "label": calendarData.bsMonths[i],
                            "value": i + 1
                        });
                    }

                    var $monthDropOption = datePickerPlugin.getCustomSelectOption(data, datePickerData.bsMonth).addClass("month-drop-down");
                    $monthSpan.append($monthDropOption);

                    return $monthSpan;
                },
                getYearDropOption: function ($nepaliDatePicker) {
                    var datePickerData = $nepaliDatePicker.data();
                    var $yearSpan = $('<div class="current-year-txt">');
                    $yearSpan.text(calendarFunctions.getNepaliNumber(datePickerData.bsYear));
                    $yearSpan.append('<i class="icon icon-drop-down">');
                    var data = [];
                    for (var i = datePickerPlugin.options.yearStart; i <= datePickerPlugin.options.yearEnd; i++) {
                        data.push({
                            "label": calendarFunctions.getNepaliNumber(i),
                            "value": i
                        });
                    }

                    var $yearDropOption = datePickerPlugin.getCustomSelectOption(data, datePickerData.bsYear).addClass("year-drop-down");
                    $yearSpan.append($yearDropOption);

                    return $yearSpan;
                },
                getCustomSelectOption: function (datas, activeValue) {
                    var $dropDown = $('<div class="drop-down-content" data-value="' + activeValue + '">');
                    var $dropDownWrapper = $('<div class="option-wrapper">');
                    var $ul = $('<ul>');
                    $.each(datas, function (index, data) {
                        $ul.append('<li data-value="' + data.value + '">' + data.label + '</li>');
                    });

                    $dropDownWrapper.append($ul);
                    $ul.find('li[data-value="' + activeValue + '"]').addClass("active");
                    $dropDown.append($dropDownWrapper);

                    return $dropDown;
                },
                getCalendarHeader: function () {
                    var calendarHeader = $("<thead>");
                    var tableRow = $("<tr>");
                    for (var i = 0; i < 7; i++) {
                        tableRow.append("<td>" + calendarData.bsDays[i] + "</td>");
                    }

                    calendarHeader.append(tableRow);
                    return calendarHeader;
                },
                getCalendarBody: function ($nepaliDatePicker) {
                    var datePickerData = $nepaliDatePicker.data();
                    var weekCoverInMonth = Math.ceil((datePickerData.bsMonthFirstAdDate.getDay() + datePickerData.bsMonthDays) / 7);
                    var preMonth = (datePickerData.bsMonth - 1 !== 0) ? datePickerData.bsMonth - 1 : 12;
                    var preYear = preMonth === 12 ? datePickerData.bsYear - 1 : datePickerData.bsYear;
                    var preMonthDays = preYear >= calendarData.minBsYear ? calendarFunctions.getBsMonthDays(preYear, preMonth) : 30;
                    var minBsDate = null;
                    var maxBsDate = null;

                    if (datePickerPlugin.options.minDate !== null) {
                        minBsDate = calendarFunctions.parseFormattedBsDate(datePickerPlugin.options.dateFormat, datePickerPlugin.options.minDate);
                    }
                    if (datePickerPlugin.options.maxDate !== null) {
                        maxBsDate = calendarFunctions.parseFormattedBsDate(datePickerPlugin.options.dateFormat, datePickerPlugin.options.maxDate);
                    }
                    var calendarBody = $("<tbody>");
                    for (var i = 0; i < weekCoverInMonth; i++) {
                        var tableRow = $("<tr>");
                        for (var k = 1; k <= 7; k++) {
                            var calendarDate = (i * 7) + k - datePickerData.bsMonthFirstAdDate.getDay();
                            var isCurrentMonthDate = true;
                            if (calendarDate <= 0) {
                                calendarDate = preMonthDays + calendarDate;
                                isCurrentMonthDate = false;
                            } else if (calendarDate > datePickerData.bsMonthDays) {
                                calendarDate = calendarDate - datePickerData.bsMonthDays;
                                isCurrentMonthDate = false;
                            }

                            if (isCurrentMonthDate) {
                                var $td = $('<td class="current-month-date" data-date="' + calendarDate + '" data-weekDay="' + (k - 1) + '">' +
                                    calendarFunctions.getNepaliNumber(calendarDate) + '</td>');
                                if (calendarDate == datePickerData.bsDate) {
                                    $td.addClass("active");
                                }
                                datePickerPlugin.disableIfOutOfRange($td, datePickerData, minBsDate, maxBsDate, calendarDate);
                                tableRow.append($td);
                            } else {
                                tableRow.append('<td class="other-month-date">' + calendarFunctions.getNepaliNumber(calendarDate) + '</td>');
                            }
                        }


                        calendarBody.append(tableRow);
                    }


                    return calendarBody;
                },
                disableIfOutOfRange: function ($td, datePickerData, minBsDate, maxBsDate, calendarDate) {
                    if (minBsDate !== null) {
                        if (datePickerData.bsYear < minBsDate.bsYear) {
                            $td.addClass("disable");
                        } else if (datePickerData.bsYear === minBsDate.bsYear && datePickerData.bsMonth < minBsDate.bsMonth) {
                            $td.addClass("disable");
                        } else if (datePickerData.bsYear === minBsDate.bsYear && datePickerData.bsMonth === minBsDate.bsMonth && calendarDate < minBsDate.bsDate) {
                            $td.addClass("disable");
                        }
                    }

                    if (maxBsDate !== null) {
                        if (datePickerData.bsYear > maxBsDate.bsYear) {
                            $td.addClass("disable");
                        } else if (datePickerData.bsYear === maxBsDate.bsYear && datePickerData.bsMonth > maxBsDate.bsMonth) {
                            $td.addClass("disable");
                        } else if (datePickerData.bsYear === maxBsDate.bsYear && datePickerData.bsMonth === maxBsDate.bsMonth && calendarDate > maxBsDate.bsDate) {
                            $td.addClass("disable");
                        }
                    }

                    return $td;
                },
                renderCurrentMonthCalendar: function ($nepaliDatePicker) {
                    var currentDate = new Date();
                    var currentBsDate = calendarFunctions.getBsDateByAdDate(currentDate.getFullYear(), currentDate.getMonth() + 1, currentDate.getDate());
                    var bsYear = currentBsDate.bsYear;
                    var bsMonth = currentBsDate.bsMonth;
                    var bsDate = currentBsDate.bsDate;
                    datePickerPlugin.setCalendarDate($nepaliDatePicker, bsYear, bsMonth, bsDate);
                    datePickerPlugin.renderMonthCalendar($nepaliDatePicker);
                },
                renderPreviousMonthCalendar: function ($nepaliDatePicker) {
                    var datePickerData = $nepaliDatePicker.data();
                    var prevMonth = (datePickerData.bsMonth - 1 > 0) ? datePickerData.bsMonth - 1 : 12;
                    var prevYear = (prevMonth !== 12) ? datePickerData.bsYear : datePickerData.bsYear - 1;
                    var prevDate = datePickerData.bsDate;
                    if (prevYear < datePickerPlugin.options.yearStart || prevYear > datePickerPlugin.options.yearEnd) {
                        return null;
                    }
                    datePickerPlugin.setCalendarDate($nepaliDatePicker, prevYear, prevMonth, prevDate);
                    datePickerPlugin.renderMonthCalendar($nepaliDatePicker);
                },
                renderNextMonthCalendar: function ($nepaliDatePicker) {
                    var datePickerData = $nepaliDatePicker.data();
                    var nextMonth = (datePickerData.bsMonth + 1 <= 12) ? datePickerData.bsMonth + 1 : 1;
                    var nextYear = (nextMonth !== 1) ? datePickerData.bsYear : datePickerData.bsYear + 1;
                    var nextDate = datePickerData.bsDate;
                    if (nextYear < datePickerPlugin.options.yearStart || nextYear > datePickerPlugin.options.yearEnd) {
                        return null;
                    }
                    datePickerPlugin.setCalendarDate($nepaliDatePicker, nextYear, nextMonth, nextDate);
                    datePickerPlugin.renderMonthCalendar($nepaliDatePicker);
                },
                renderFormattedSpecificDateCalendar: function ($nepaliDatePicker, dateFormat, dateFormattedText) {
                    var datePickerDate = calendarFunctions.parseFormattedBsDate(dateFormat, dateFormattedText);
                    datePickerPlugin.setCalendarDate($nepaliDatePicker, datePickerDate.bsYear, datePickerDate.bsMonth, datePickerDate.bsDate);
                    datePickerPlugin.renderMonthCalendar($nepaliDatePicker);
                }
            };

            this.each(function () {
                var $element = $(this);
                datePickerPlugin.init($element);
            });

            datePickerPlugin.addCommonEventHandler();
            return this;
        };
    }(jQuery, calendarFunctions));
</script>
<a id="dlink" style="display:none;"></a>
<button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;"
    onclick="printContent('printing')"><span class="glyphicon glyphicon-print" style="font-size: 15px;"></span> &nbsp;
    Print
</button>

<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport"
    onclick="tableToExcel('dataTable', 'Line List Adherence Counselling Report', 'Line List Adherence Counselling Report')"><span
        class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span>Download As Excel</button>
<div align="center">
    <div style="width: 50%; margin: 0 auto;">
        <table class="table table-borderless table-striped">
            <tr style="border: 1px solid #DDDDDD;">
                <td style="font-size: 15px;padding-top: 15px;">
                    <label for="dateFormat"><strong>Select Date Fomart : </strong></label>
                </td>
                <td style="width: 60%;">

                    <select id="dateFormat" onchange="showCalendar()" class="form-control">
                        <option selected hidden> Please Select a Calendar Format</option>
                        <option value="vc">Nepali calendar</option>
                        <option value="gc">English calendar</option>
                    </select>
                </td>
            </tr>
        </table>
    </div>
</div>
<div id="loader" style="display: none"></div>
<div id='state'>
    <div style="width: 50%; margin-left:25%;">
        <table class="table table-borderless table-striped">
            <tr style="border: 1px solid #DDDDDD;">
                <td style="font-size: 15px;padding-top: 15px;">
                    <strong>Start Month : </strong>
                </td>
                <td style="width: 60%;">
                    <input type="text" class="date form-control" id="start-date">
                    <input type="date" class="form-control" id="start-date-gc">
                </td>
            </tr>
            <tr>
                <td style="font-size: 15px;padding-top: 15px;">
                    <strong>End Month : </strong>
                </td>
                <td style="width: 60%;">
                    <input type="text" class="date form-control" id="end-date">
                    <input type="date" class="form-control" id="end-date-gc">
                </td>
            </tr>
            <tr>
                <td colspan="2"><button onClick="submitData()" class="btn btn-primary" id="tap">Submit</button></td>
            </tr>
        </table>
    </div>
    <div id="printing" class="animate-bottom">
        <div id='state'>
            <table border="1" id="dataTable" class="table  table-hover text-center" cellspacing="6" cellpadding="4"
                style="border-collapse: collapse; text-align: center;">
                <thead>
                    <tr style="font-weight:800; text-align:center;">
                        <td colspan="4" style="border:1px solid black;background:#ADD8E6;">Line list Adherence
                            Counselling Report</td>
                    </tr>
                    <tr style="font-weight:800; text-align:center;">
                        <td id="facility" colspan="4" style="border:1px solid black;background:#ADD8E6;"></td>
                    </tr>
                    <tr>
                        <td style="font-weight:800; border:1px solid black;background-color:#F8F8F8;text-align:center">
                            S.No.</td>
                        <td style="font-weight:800; border:1px solid black;background-color:#F8F8F8;text-align:center">
                            Client Code</td>
                        <td style="font-weight:800; border:1px solid black;background-color:#F8F8F8;text-align:center">
                            Name of ART Site</td>
                        <td style="font-weight:800; border:1px solid black;background-color:#F8F8F8;text-align:center">
                            Adherence</td>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>
<script>

    var selectedOrgUnit = dhis2.report.organisationUnit;
    document.getElementById("state").style.display = "none";
    function showCalendar() {
        let calendar = document.getElementById("dateFormat").value;
        if (calendar == "gc") {
            document.getElementById("start-date-gc").style.display = "block";
            document.getElementById("end-date-gc").style.display = "block";
            document.getElementById("start-date").style.display = "none";
            document.getElementById("end-date").style.display = "none";
        } else {
            document.getElementById("start-date-gc").style.display = "none";
            document.getElementById("end-date-gc").style.display = "none";
            document.getElementById("start-date").style.display = "block";
            document.getElementById("end-date").style.display = "block";
        }

        document.getElementById("state").style.display = "block";
    }
    var currentDate = new Date();
    var currentNepaliDate = calendarFunctions.getBsDateByAdDate(currentDate.getFullYear(), currentDate.getMonth() + 1, currentDate.getDate());
    var formatedNepaliDate = calendarFunctions.bsDateFormat("%y-%m-%d", currentNepaliDate.bsYear, currentNepaliDate.bsMonth, currentNepaliDate.bsDate);
    $(".date").val(formatedNepaliDate);
    $(".date").nepaliDatePicker({
        dateFormat: "%y-%m-%d",
        closeOnDateSelect: true,
        maxDate: formatedNepaliDate
    });
    var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
    $('#dataTable').hide();
    $('#loader').hide();
    async function submitData() {
        $('#dataTable').hide();

        let startDate = "", endDate = "";
        let calendar = document.getElementById("dateFormat").value;
        if (calendar == "gc") {
            let StartDate = document.getElementById("start-date-gc").value;
            let EndDate = document.getElementById("end-date-gc").value;
            startDate = StartDate;
            endDate = EndDate;
        } else {
            let StartDate = document.getElementById("start-date").value;
            let EndDate = document.getElementById("end-date").value;
            let d = StartDate.split('-')
            let e = EndDate.split('-')
            let sYear = calendarFunctions.getNumberByNepaliNumber(d[0])
            let sMonth = calendarFunctions.getNumberByNepaliNumber(d[1])
            let sDay = calendarFunctions.getNumberByNepaliNumber(d[2])
            let eYear = calendarFunctions.getNumberByNepaliNumber(e[0])
            let eMonth = calendarFunctions.getNumberByNepaliNumber(e[1])
            let eDay = calendarFunctions.getNumberByNepaliNumber(e[2])
            let sdate = calendarFunctions.getAdDateByBsDate(sYear, sMonth, sDay)
            startDate = sdate.getFullYear() + '-' + (sdate.getMonth() + 1) + '-' + sdate.getDate();
            let edate = calendarFunctions.getAdDateByBsDate(eYear, eMonth, eDay)
            endDate = edate.getFullYear() + '-' + (edate.getMonth() + 1) + '-' + edate.getDate();

        }
        var month = [startDate, endDate];
        if (!startDate || !endDate || new Date(startDate) > new Date(endDate)) {
            alert("Please Select dates Correctly!");
            return;
        } else {
            document.getElementById("facility").innerHTML = selectedOrgUnit.name + " ( " + startDate + " to " + endDate + " )"
            $('#loader').show();
            var organisationUnits = await orgUnitChildren();

            async function orgUnitChildren() {
                var saveChildrenGroup = {};
                var resSaveChildrenGroup = await (await fetch("../../organisationUnitGroups/pW6owR4oRKb.json?fields=id,name,organisationUnits[id,name]&paging=false")).json();
                resSaveChildrenGroup.organisationUnits.forEach(ou => saveChildrenGroup[ou.id] = true)
     
                var orgUnitChildren = [];
                var url = '../../organisationUnits/' + selectedOrgUnit.id + '.json?paging=false&fields=id,name,level';

                let response = await fetch('../../organisationUnitLevels.json');
                var orgUnitLevel = await response.json();

                for (let i = 0; i < orgUnitLevel.organisationUnitLevels.length; i++) url += ',children[id,name,level';
                url += ']';

                response = await fetch(url);
                var data = await response.json();

                treeDown(data);

                function treeDown(arr) {
                    var key = arr;
                    if (key.children.length) for (let i = 0; i < key.children.length; i++)  treeDown(key.children[i]);
                    if (saveChildrenGroup[key.id]) orgUnitChildren.push(key.id);
                }
                return orgUnitChildren;
            }
            
            var sno = 0;
            var tableData = '';
            for (let orgUnit of organisationUnits) {
                var url = '../../analytics/enrollments/query/L78QzNqadTV.json?startDate=' + month["0"] + '&endDate=' + month["1"] + '&dimension=ou:' + orgUnit + '&dimension=YRSdePjzzfs.drKkLxaGFwv&dimension=YRSdePjzzfs.hHMqjpDyygd&stage=YRSdePjzzfs&displayProperty=NAME&outputType=ENROLLMENT&desc=enrollmentdate&paging=false'
                var resEvents = '';
                $.ajax({
                    type: "GET",
                    async: false,
                    url: url,
                    data: JSON,
                    success: function (resEvents) {
                        resEvents.rows.forEach(row => {
                            if (row[11] && row[11] != "NaN") {
                                tableData += `
                                    <tr>
                                        <td  style="border:1px solid black;background-color:#F8F8F8;text-align:center" >${sno++}</td>
                                        <td  style="border:1px solid black;background-color:#F8F8F8;text-align:center" >${row[7]}</td>
                                        <td  style="border:1px solid black;background-color:#F8F8F8;text-align:center" >${row[10]}</td>
                                        <td  style="border:1px solid black;background-color:#F8F8F8;text-align:center" >${Number(row[11])}</td>
                                    </tr>`;
                            }
                        })
                    }
                })

            }
debugger;
            document.getElementById("tableBody").innerHTML = tableData;

            $('#dataTable').show();
            $('#loader').hide();
        }
    }
    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename + "-" + selectedOrgUnit.name + ".xls";
            document.getElementById("dlink").click();
        }
    })()

    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }
</script>