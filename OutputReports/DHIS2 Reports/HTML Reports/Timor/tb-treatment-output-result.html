<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TB Result output</title>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"> -->

    <!-- for table content -->
    <style>
        * {
            font-size: 15px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            padding: 10px;
            width: 100%;
        }


        .header img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, Helvetica, sans-serif;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            min-width: 50px;
        }

        td {
            height: 20px !important;
            text-align: center !important;
        }

        th {
            background-color: #bdd7ee;
            text-align: center;
        }

        .blocks {
            font-weight: 600;
        }

        .container {
            display: flex;
            justify-content: space-between;
            gap: 20px;

            td {
                text-align: center;
            }
        }

        .left-align {
            display: flex;
            justify-content: flex-start;
            font-weight: 700;
            text-align: left;

            th,
            td {
                border: none;
            }
        }
    </style>

    <!-- for loader -->
    <style>
        #loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 47px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
    </style>



</head>

<body>
    <a id="dlink" style="display: none"></a>
    <div id="loader"></div>
    <div id="printing">
        <tr>

            <td colspan="4" style="text-align: right;">
                <div id="downloads">
                    <button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;"
                        onclick="printContent('tb-report')"><span class="glyphicon glyphicon-print"
                            style="font-size: 15px;"></span> &nbsp;
                        Print
                    </button>

                    <button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport"
                        onclick="tableToExcel('tb-report', 'DEPARTMENT OF INFECTIOUS DISEASES CONTROL', 'DEPARTMENT OF INFECTIOUS DISEASES CONTROL.xls')"><span
                            class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span>Download As
                        Excel</button>
                </div>
            </td>
        </tr>
    </div>

    <div id="tb-report">
        <table id="table">


            <tr>
                <td style="border: none;" colspan="6"><img src="../api/documents/OnA95Rqh12I/data"
                        alt="Ministério da Saúde"></td>
                <td style="border: none;" colspan="10">
                    <div class="title">
                        <p>MINISTER OF HEALTH</p>
                        <p><b>DEPARTMENT OF INFECTIOUS DISEASES CONTROL</b></p>
                        <h2 style="text-align: center; font-size: 10px;">RESULTS ON TREATMENT OF TUBERCULOSIS CASES
                            REGISTERED IN THE PAST 12 - 15 MONTHS
                        </h2>

                    </div>

                </td>
                <td style="border: none;" colspan="6">
                    <img width="84px" src="../api/documents/x5nJFLDnCDt/data" alt="END TB">
                </td>

            </tr>

            <tr>
                <td colspan="18" style="border: none;">
                    <hr />

                </td>
            </tr>
            <tr>
                <th colspan="4">Organization unit</th>
                <th colspan="4">NAME of the DOT CENTER</th>
                <th colspan="4">YEARS</th>
                <th colspan="7" rowspan="2">SIGNATURE and COMPLETION DATE THIS FORMAT</th>
            <tr>
                <td colspan="4" id="municipality"></td>
                <td colspan="4" id="dot_center"></td>
                <td colspan="4" id="year"></td>
            </tr>

            </tr>
            <tr>
                <th colspan="4">Name of Health Facility</th>
                <th colspan="4">KTM or TB Responsible</th>
                <th colspan="4">QUARTERLY</th>
                <td colspan="7" rowspan='2'></td>
            </tr>
            <tr>
                <td colspan="4" style="text-align: center;"></td>
                <td colspan="4"></td>
                <td colspan="4" id="quarter"></td>
            </tr>


            <table border="1">
                <thead>
                    <th colspan="20"><strong>Block 1: All TB cases registered during this trimester/Quarter</th>
                    </strong></tr>


                    <th rowspan="3" colspan="2">Types of TB Patients</th>
                    <th colspan="3" rowspan="2">Total Number of Registered TB cases</th>
                    <th colspan="12">TREATMENT RESULTS</th>
                    <th colspan="3" rowspan="2">Total Evaluated</th>
                    </tr>
                    <tr>
                        <th colspan="2">Cured</th>
                        <th colspan="2">Treatment Completed</th>
                        <th colspan="2">Treatment Failure</th>
                        <th colspan="2">Died</th>
                        <th colspan="2">Lost to Follow Up</th>
                        <th colspan="2">Not Evaluated</th>
                    </tr>
                    <tr>
                        <th>M</th>
                        <th>F</th>
                        <th>Total</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>M</th>
                        <th>F</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1.1</td>
                        <td>Bacteriologically Confirmed, New and relapse (Pulmonary and Extra Pulmonary) &lt; 14
                        </td>
                        <td id="rCLHfP8dnLY"></td>
                        <td id="z4tdNlO4FkB"></td>
                        <td id=""></td>
                        <td id="t9tV610ozse"></td>
                        <td id="OgsziR6WM1t"></td>
                        <td id="gBnf9VS3YLF"></td>
                        <td id="dQf64kCOOUL"></td>
                        <td id="JgSrdxCQIJj"></td>
                        <td id="LvSUREckCpv"></td>
                        <td id="eAPlAal8iw8"></td>
                        <td id="YDksol0fSqK"></td>
                        <td id="fKkI2eEPM1u"></td>
                        <td id="H84Mb7LLb4X"></td>
                        <td id="eInA08FbYcB"></td>
                        <td id="ulVWOD4Wsvf"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>1.2</td>
                        <td>Bacteriologically Confirmed, New and Relapse (Pulmonary and Extra Pulmonary) &gt; 15
                            Years Old</td>
                        <td id="nJFR5kLi0Ms"></td>
                        <td id="sx0VlPxxcln"></td>
                        <td id=""></td>
                        <td id="zQYBvjyEQO1"></td>
                        <td id="lSZLXx8VTYr"></td>
                        <td id="XYVL09Tu9GO"></td>
                        <td id="VcBjxozHKx5"></td>
                        <td id="bqxKZOZUcu0"></td>
                        <td id="YmlnmCljRet"></td>
                        <td id="q15ky9ioyqf"></td>
                        <td id="w56MnhKZOkQ"></td>
                        <td id="juBFSarJOIX"></td>
                        <td id="Nle9bjAy9Vb"></td>
                        <td id="tR75Ul9yEjd"></td>
                        <td id="eOiMkcEF1EQ"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>2.1</td>
                        <td>Clinically Diagnosed, New and Relapse (Pulmonary and Extra Pulmonary) &lt;14</td>
                        <td id="bo1rppDwO0B"></td>
                        <td id="oKiN63x15d4"></td>
                        <td id=""></td>
                        <td id="MwZ8NaEnp7S"></td>
                        <td id="T3Iu5TRwfKb"></td>
                        <td id="ugmLAIZkjsN"></td>
                        <td id="OU56nmy4Llj"></td>
                        <td id="Pvt2qbsWDMx"></td>
                        <td id="qvpNDy5S7xv"></td>
                        <td id="ugL8uKL6E1c"></td>
                        <td id="XjwSAsj7rml"></td>
                        </td>
                        <td id="DqHmsdPn0bi">
                        <td id="VmkrLnucyBY"></td>
                        <td id="TeeoAt0m7NS"></td>
                        <td id="oUK44qO3J39"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>2.2</td>
                        <td>Clinical Diagnosis, New and Relapse (Pulmonary and Extra Pulmonary) &gt;16 Years Old
                        </td>
                        <td id="yJzB1y58Gnc"></td>
                        <td id="sx7LtMOPKV5"></td>
                        <td id=""></td>
                        <td id="yrbpnLRBHyS"></td>
                        <td id="WTp5zq6WcvU"></td>
                        <td id="CBddal4FCyg"></td>
                        <td id="OU56nmy4Llj"></td>
                        <td id="aRJqYITEzEr"></td>
                        <td id="Pgf9fOgRzky"></td>
                        <td id="nFFYqqgPcgT"></td>
                        <td id="RzhIT2bqaM1"></td>
                        <td id="H33UykEr5lF"></td>
                        <td id="MWEDh3oWU6n"></td>
                        <td id="LZPsD6CQgTa"></td>
                        <td id="KLf2ASZp8Ub"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>3.1</td>
                        <td>Re-treatment (not including relapse)* &lt;14</td>
                        <td id="dp1RmEJWgYO"></td>
                        <td id="f6b8LK89fb3"></td>
                        <td id=""></td>
                        <td id="YydGTiu7z1F"></td>
                        <td id="MxUFuiw6ubm"></td>
                        <td id="Q5ZLN6tnN0T"></td>
                        <td id="L5rQ21K7d8s"></td>
                        <td id="U4rz5ZsvyOR"></td>
                        <td id="hLCUCEXMtLc"></td>
                        <td id="zVeqsnwV5fH"></td>
                        <td id="kxPvuQ6rwmT"></td>
                        <td id="q9UIsQSJJVo"></td>
                        <td id="e3JearXnN2b"></td>
                        <td id="ARfaKFMZMst"></td>
                        <td id="u45avak6H58"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>3.2</td>
                        <td>Re-treatment (not including relapse)* &gt;15 Years Old</td>
                        <td id="KMTk9MacjMx"></td>
                        <td id="vdXXsBQCke0"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id="EA09xWSm6Jr"></td>
                        <td id="bQfM4k08Igh"></td>
                        <td id="hzvshycuGJC"></td>
                        <td id="v0kwGzZJEnv"></td>
                        <td id="oZtJxlhgnFS"></td>
                        <td id="xsJ2Nu1Ex2V"></td>
                        <td id="GIlBbpWymFw"></td>
                        <td id="N0YxNOOE6Qe"></td>
                        <td id="PhdEGWASITr"></td>
                        <td id="vEeIe5Asrjb"></td>
                        <td id="diKexPJhr0i"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>4.1</td>
                        <td>All types of HIV-positive</td>
                        <td id="i7Emcw9iTlY"></td>
                        <td id="VpiQKTKPQs2"></td>
                        <td id=""></td>
                        <td id="X6AQxL9JVtf"></td>
                        <td id="OsUkpzWnfWi"></td>
                        <td id="k14RVOQepER"></td>
                        <td id="TQ5pMm3GZrj"></td>
                        <td id="QnNDpocDmwB"></td>
                        <td id="R5MFs2VGRZK"></td>
                        <td id="P7E687ZbFMf"></td>
                        <td id="FhV98ickktY"></td>
                        <td id="O5h8vcsD4NN"></td>
                        <td id="OPwRAeBQaVW"></td>
                        <td id="Ul16OPprXk6"></td>
                        <td id="erlvmUvA4Qf"></td>
                        <td id=""></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                </tbody>
            </table>
            <table border="1">
                <thead>
                    <th colspan="20"><strong>Block 2: TB/HIV activity (All Forams TB Cases registered during this
                            trimester/Quarter
                            with HIV Status Negative)</strong></th>
                    <tr>

                        <th rowspan="2" colspan="3">Total Number of All Forams TB Cases Registered</th>
                        <th colspan="12">TREATMENT RESULTS</th>
                        <th rowspan="2" colspan="5">Total Evaluated</th>
                    </tr>
                    <tr>
                        <th colspan="2">Cured</th>
                        <th colspan="2">Treatment Completed</th>
                        <th colspan="2">Treatment Failure</th>
                        <th colspan="2">Died</th>
                        <th colspan="2">Loss to Follow up</th>
                        <th colspan="2">Not Evaluated</th>
                    </tr>
                    <tr>
                        <td colspan="3" id="nkGYhtyodXe"></td>
                        <td colspan="2" id="RwwG4S8LHIG"></td>
                        <td colspan="2" id="g0CEllsES12"></td>
                        <td colspan="2" id="aM8XtWPyh7P"></td>
                        <td colspan="2" id="cO42uNucMhG"></td>
                        <td colspan="2" id="EsJPC7sFspA"></td>
                        <td colspan="2" id="DFigKL5Q0GW"></td>
                        <td colspan="2"></td>
                    </tr>

                </thead>
                <tbody>

                </tbody>
            </table>
            <table border="1">
                <thead>
                    <th colspan="20"><strong>Block 3: TB/HIV activity (All Forams TB cases registered during the
                            trimester/Quarter
                            were not tested for HIV)</strong></th>
                    <tr>
                        <th rowspan="2" colspan="3">Total Number of All Forams TB Cases Registered</th>
                        <th colspan="12">TREATMENT RESULTS</th>
                        <th rowspan="2" colspan="5">Total Evaluated</th>
                    </tr>
                    <tr>
                        <th colspan="2">Cured</th>
                        <th colspan="2">Treatment Completed</th>
                        <th colspan="2">Treatment Failure</th>
                        <th colspan="2">Died</th>
                        <th colspan="2">Loss to Follow up</th>
                        <th colspan="2">Not Evaluated</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="3" id="NDIVb8EIEg0"></td>
                        <td colspan="2" id="nNQJH0URBML"></td>
                        <td colspan="2" id="otdWAaNbfB6"></td>
                        <td colspan="2" id="dETmRlIXm1m"></td>
                        <td colspan="2" id="JrH442MoVQZ"></td>
                        <td colspan="2" id="mhKFp76LA34"></td>
                        <td colspan="2" id="AbXqYqhSyfT"></td>
                        <td colspan="2"></td>
                    </tr>
                </tbody>
            </table>
            <table border="1">
                <thead>
                    <th colspan="20"><strong>Block 4: TB/HIV activity (all TB cases registered during the
                            trimester/Quarter)</strong>
                    </th>
                    <tr>
                        <th colspan="6">HIV-positive for TB patients</th>
                        <th colspan="7">HIV positive of TB patients are receiving ART</th>
                        <th colspan="7">HIV-positive of TB patients receiving CPT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" id="AmMw8Uwnjib"></td>
                        <td colspan="7" id="BrbNekdiVyU"></td>
                        <td colspan="7" id="yHq3704BQwx"></td>
                    </tr>
                </tbody>
            </table>
            <p>a) The registration period was based on the date of case registration in the TB registry, followed by the
                date of
            </p>

            <table border="1">
                <thead>
                    <tr>
                        <th colspan="9"><strong>Block 5: Treatment Observations by DOT Providers</strong></th>
                    </tr>
                    <tr>
                        <th colspan="9" style="background-color: #ffffff;">Directly Observed Treatment (DOT)</th>
                    </tr>
                    <tr>
                        <th rowspan="2">Type of TB Cases</th>
                        <th colspan="7">DOT Provided from:</th>
                        <th rowspan="2">Total</th>
                    </tr>
                    <tr>
                        <th>Health Care Workers</th>
                        <th>NGO Staff</th>
                        <th>Private Clinic</th>
                        <th>Traditional Healer</th>
                        <th>Volunteer/PSF</th>
                        <th>Not by DOT</th>
                        <th>Other</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Bacteriologically Confirmed, New and relapse (Pulmonary and Extra Pulmonary)</td>
                        <td id="mdQVAssDjDk"></td>
                        <td id="SQZUm4Mt5xz"></td>
                        <td id=""></td>
                        <td id="BORWkwpJU4j"></td>
                        <td id="lNFjUhsHpiq"></td>
                        <td id="q5Gem5kjP1c"></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                    <tr>
                        <td>Clinically Diagnosed, New and Relapse (Pulmonary and Extra Pulmonary)</td>
                        <td id="G2tdjqFmj4s"></td>
                        <td id="PJTtHzsknAn"></td>
                        <td id=""></td>
                        <td id="Cs613WxbsOM"></td>
                        <td id="e1vZH4N2Xh4"></td>
                        <td id="gbF71mHt2VC"></td>
                        <td id=""></td>
                        <td id=""></td>
                    </tr>
                </tbody>
            </table>

            <table border="1">
                <thead>
                    <th colspan="20"><strong>Block 6: Treatment Outcome of Volunteer or PSF (PSF=Family Health
                            Promoter)ᵇ</strong>
                    </th>

                    <tr>
                        <th rowspan="2" colspan="2">Type of TB Cases</th>
                        <th rowspan="2" colspan="2">Total TB cases on DOT from PSF in this Quarter</th>
                        <th colspan="12">Treatment Outcome</th>
                        <th rowspan="2" colspan="4">Total patients evaluated</th>
                    </tr>
                    <tr>
                        <th colspan="2">Cured</th>
                        <th colspan="2">Treatment Completed</th>
                        <th colspan="2">Positive (Failure)</th>
                        <th colspan="2">Died</th>
                        <th colspan="2">Lost to follow up</th>
                        <th colspan="2">Evaluation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="2">Bacteriologically Confirmed, New and Relapse (Pulmonary and Extra Pulmonary)
                        </td>
                        <td colspan="2" id="lNFjUhsHpiq"></td>
                        <td colspan="2" id="H5YOcF6Egxb"></td>
                        <td colspan="2" id="uz4yXkitgyG"></td>
                        <td colspan="2" id="yZAuHVRPwMO"></td>
                        <td colspan="2" id="CjgXAPqFm4c"></td>
                        <td colspan="2" id="AbaWnJiD0tl"></td>
                        <td colspan="2" id=""></td>
                        <td colspan="4" id=""></td>
                    </tr>
                    <tr>
                        <td colspan="2">Clinically Diagnosed, New and Relapse (Pulmonary and Extra Pulmonary)</td>
                        <td colspan="2" id="e1vZH4N2Xh4"></td>
                        <td colspan="2" id="ue5zL09aOfk"></td>
                        <td colspan="2" id="eh9xN1IjdOc"></td>
                        <td colspan="2" id="Aihofbqo2V0"></td>
                        <td colspan="2" id="rUWC3txm4kY"></td>
                        <td colspan="2" id="ihgasktgPMX"></td>
                        <td colspan="2" id=""></td>
                        <td colspan="4" id=""></td>
                    </tr>
                </tbody>
            </table>


            <table class="left-align">
                <tr>
                    <td>Approved by,</td>
                </tr>

                <tr>
                    <td>.......</td>
                </tr>
            </table>
    </div>
</body>

<script>
    console.log(dhis2);
    document.getElementById("loader").style.display = "block";
    document.getElementById("tb-report").style.display = "none";

    const quarter = dhis2.report.periods[0].slice(4, 6);
    const reportPeriod = dhis2.report.periods[0];
    const year = parseInt(reportPeriod.slice(0, 4));
    console.log("Quarter: ", quarter);
    console.log("Report Period: ", reportPeriod);


    // const reportPeriod = dhis2.report.date.split("-")[0];
    const { startDate, endDate } = getQuarterDates(quarter, year);
    console.log("Report Period: ", getQuarterDates(quarter, year));


    const { id: ou, name: ouName } = dhis2.report.organisationUnit;

    const dataElement = [
        "rCLHfP8dnLY",
        "z4tdNlO4FkB",
        "t9tV610ozse",
        "OgsziR6WM1t",
        "gBnf9VS3YLF",
        "dQf64kCOOUL",
        "JgSrdxCQIJj",
        "LvSUREckCpv",
        "eAPlAal8iw8",
        "YDksol0fSqK",
        "fKkI2eEPM1u",
        "H84Mb7LLb4X",
        "eInA08FbYcB",
        "ulVWOD4Wsvf",
        "nJFR5kLi0Ms",
        "sx0VlPxxcln",
        "zQYBvjyEQO1",
        "lSZLXx8VTYr",
        "XYVL09Tu9GO",
        "VcBjxozHKx5",
        "bqxKZOZUcu0",
        "YmlnmCljRet",
        "q15ky9ioyqf",
        "w56MnhKZOkQ",
        "juBFSarJOIX",
        "Nle9bjAy9Vb",
        "tR75Ul9yEjd",
        "eOiMkcEF1EQ",
        "bo1rppDwO0B",
        "oKiN63x15d4",
        "MwZ8NaEnp7S",
        "T3Iu5TRwfKb",
        "ugmLAIZkjsN",
        "OU56nmy4Llj",
        "Pvt2qbsWDMx",
        "qvpNDy5S7xv",
        "ugL8uKL6E1c",
        "XjwSAsj7rml",
        "DqHmsdPn0bi",
        "VmkrLnucyBY",
        "TeeoAt0m7NS",
        "oUK44qO3J39",
        "yJzB1y58Gnc",
        "sx7LtMOPKV5",
        "yrbpnLRBHyS",
        "WTp5zq6WcvU",
        "CBddal4FCyg",
        "OU56nmy4Llj",
        "aRJqYITEzEr",
        "Pgf9fOgRzky",
        "nFFYqqgPcgT",
        "RzhIT2bqaM1",
        "H33UykEr5lF",
        "MWEDh3oWU6n",
        "LZPsD6CQgTa",
        "KLf2ASZp8Ub",
        "dp1RmEJWgYO",
        "f6b8LK89fb3",
        "YydGTiu7z1F",
        "MxUFuiw6ubm",
        "Q5ZLN6tnN0T",
        "L5rQ21K7d8s",
        "U4rz5ZsvyOR",
        "hLCUCEXMtLc",
        "zVeqsnwV5fH",
        "kxPvuQ6rwmT",
        "q9UIsQSJJVo",
        "e3JearXnN2b",
        "ARfaKFMZMst",
        "u45avak6H58",
        "KMTk9MacjMx",
        "vdXXsBQCke0",
        "EA09xWSm6Jr",
        "bQfM4k08Igh",
        "hzvshycuGJC",
        "v0kwGzZJEnv",
        "oZtJxlhgnFS",
        "xsJ2Nu1Ex2V",
        "GIlBbpWymFw",
        "N0YxNOOE6Qe",
        "PhdEGWASITr",
        "vEeIe5Asrjb",
        "diKexPJhr0i",
        "i7Emcw9iTlY",
        "VpiQKTKPQs2",
        "X6AQxL9JVtf",
        "OsUkpzWnfWi",
        "k14RVOQepER",
        "TQ5pMm3GZrj",
        "QnNDpocDmwB",
        "R5MFs2VGRZK",
        "P7E687ZbFMf",
        "FhV98ickktY",
        "O5h8vcsD4NN",
        "OPwRAeBQaVW",
        "Ul16OPprXk6",
        "erlvmUvA4Qf",
        "nkGYhtyodXe",
        "RwwG4S8LHIG",
        "g0CEllsES12",
        "aM8XtWPyh7P",
        "cO42uNucMhG",
        "EsJPC7sFspA",
        "DFigKL5Q0GW",
        "NDIVb8EIEg0",
        "nNQJH0URBML",
        "otdWAaNbfB6",
        "dETmRlIXm1m",
        "JrH442MoVQZ",
        "mhKFp76LA34",
        "AbXqYqhSyfT",
        "AmMw8Uwnjib",
        "BrbNekdiVyU",
        "yHq3704BQwx",
        "mdQVAssDjDk",
        "SQZUm4Mt5xz",
        "BORWkwpJU4j",
        "lNFjUhsHpiq",
        "q5Gem5kjP1c",
        "G2tdjqFmj4s",
        "PJTtHzsknAn",
        "Cs613WxbsOM",
        "e1vZH4N2Xh4",
        "gbF71mHt2VC",
        "H5YOcF6Egxb",
        "uz4yXkitgyG",
        "yZAuHVRPwMO",
        "CjgXAPqFm4c",
        "AbaWnJiD0tl",
        "ue5zL09aOfk",
        "eh9xN1IjdOc",
        "Aihofbqo2V0",
        "rUWC3txm4kY",
        "ihgasktgPMX",
    ]


    async function loadReportData() {
        try {
            // Build final URL
            const url = `../api/analytics.json?dimension=pe:${reportPeriod}&dimension=dx:${dataElement.join(';')}&showHierarchy=false&hierarchyMeta=false&includeMetadataDetails=true&includeNumDen=true&skipRounding=false&completedOnly=false&outputIdScheme=UID&filter=ou:${ou}&paging=false`;

            const res = await fetch(url);
            const data = await res.json();

            data.rows.map(item => {
                if (document.getElementById(item[0])) {
                    document.getElementById(item[0]).innerHTML = Number(item[2]) || '';
                }
            });

            document.getElementById('year').innerHTML = reportPeriod.slice(0, 4) || '';
            document.getElementById('municipality').innerHTML = ouName || '';
            document.getElementById('quarter').innerHTML = `${startDate} - ${endDate}`;
        } catch (error) {
            alert("Fetched error: " + error.message);
            console.error('Error fetching data:', error);
        }

        document.getElementById("loader").style.display = "none";
        document.getElementById("tb-report").style.display = "block";

        // calculate total from DOM element
        for (const row in totalValution) {
            let total = 0;

            totalValution[row].forEach(dEle => {
                total += Number(document.getElementById(dEle).textContent) || 0;
            });

            document.getElementById(row).innerHTML = total || '';
        }
    }

    // Call the async function to run
    loadReportData();




    function getQuarterDates(quarterFlag, year) {
        // const year = new Date().getFullYear(); // current year
        if (!year) {
            year = new Date().getFullYear(); // fallback to current year if none passed
        }
        let startDate, endDate;

        switch (quarterFlag.toUpperCase()) {
            case 'Q1':
                startDate = new Date(year, 0, 1);    // Jan 1
                endDate = new Date(year, 2, 31);     // Mar 31
                break;
            case 'Q2':
                startDate = new Date(year, 3, 1);    // Apr 1
                endDate = new Date(year, 5, 30);     // Jun 30
                break;
            case 'Q3':
                startDate = new Date(year, 6, 1);    // Jul 1
                endDate = new Date(year, 8, 30);     // Sep 30
                break;
            case 'Q4':
                startDate = new Date(year, 9, 1);    // Oct 1
                endDate = new Date(year, 11, 31);    // Dec 31
                break;
            default:
                throw new Error("Invalid quarter flag. Use Q1, Q2, Q3, or Q4.");
        }

        // Helper to format dates as dd-mm-yyyy
        const formatDate = (date) => {
            const dd = String(date.getDate()).padStart(2, '0');
            const mm = String(date.getMonth() + 1).padStart(2, '0'); // Month is 0-based
            const yyyy = date.getFullYear();
            return `${dd}-${mm}-${yyyy}`;
        };

        return {
            startDate: formatDate(startDate),
            endDate: formatDate(endDate)
        };
    }


    function printContent(el) {
        var restorePage = document.body.innerHTML;
        var printContent = document.getElementById(el).innerHTML;

        // Add landscape style and scaling for 1-page print
        var style = `
            <style type="text/css" media="print">
                @page {
                    size: A4;
                    margin: 10mm;
                }
                body {
                    -webkit-print-color-adjust: exact;
                    print-color-adjust: exact;
                    zoom: 75%; /* Adjust this to fit your content on one page */
                }
                td {
                    border: 1px solid black;
                    padding: 8px;
                    text-align: left;
                    min-width: 37px;
               
                    height: 20px !important;
                    text-align: center !important;
                }
            </style>
        `;

        document.body.innerHTML = style + printContent;
        window.print();
        document.body.innerHTML = restorePage;
        location.reload(); // Reload page to reset JS/CSS state if needed
    }

    var tableToExcel =
        function downloadTableAsExcel(tableId, filename = '') {
            const table = document.getElementById(tableId);
            const html = table.outerHTML;

            const blob = new Blob(
                ['\ufeff', `<html><head><meta charset="UTF-8"></head><body>${html}</body></html>`],
                { type: 'application/vnd.ms-excel' }
            );

            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename || 'table'}.xls`;

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

</script>

</html>