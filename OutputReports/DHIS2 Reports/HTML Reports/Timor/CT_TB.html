<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TB Case Detection Report</title>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"> -->

    <!-- for table content -->
    <style>
        * {
            font-size: 15px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            padding: 10px;
        }

        .header img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, Helvetica, sans-serif;
        }

        th,
        td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
            min-width: 37px;
        }

        td {
            height: 20px !important;
            text-align: center !important;
        }

        th {
            background-color: #ccc;
            text-align: center;
        }

        .blocks {
            font-weight: 600;
        }

        .container {
            display: flex;
            justify-content: space-between;
            gap: 20px;

            td {
                text-align: center;
            }
        }

        .left-align {
            display: flex;
            justify-content: flex-start;
            font-weight: 700;
            text-align: left;

            th,
            td {
                border: none;
            }
        }
    </style>

    <!-- for loader -->
    <style>
        #loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 47px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
    </style>

   

</head>

<body>
    <a id="dlink" style="display: none"></a>
    <div id="loader"></div>
    <div id="printing">
        <tr>

            <td colspan="4" style="text-align: right;">
                <div id="downloads">
                    <button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;"
                        onclick="printContent('tb-report')"><span class="glyphicon glyphicon-print"
                            style="font-size: 15px;"></span> &nbsp;
                        Print
                    </button>

                    <button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport"
                        onclick="tableToExcel('tb-report', 'DEPARTMENT OF INFECTIOUS DISEASES CONTROL', 'DEPARTMENT OF INFECTIOUS DISEASES CONTROL.xls')"><span
                            class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span>Download As
                        Excel</button>
                </div>
            </td>
        </tr>
    </div>

    <div id="tb-report">
        <table id="table">

            <tr>
                <td style="border: none;" colspan="4"><img src="../api/documents/OnA95Rqh12I/data"
                        alt="Ministério da Saúde"></td>
                <td style="border: none;" colspan="10">
                    <div class="title">
                        <p>MINISTER OF HEALTH</p>
                        <p><b>DEPARTMENT OF INFECTIOUS DISEASES CONTROL</b></p>
                        <h2 style="text-align: center; font-size: 10px;">QUARTERLY REPORT ON TUBERCULOSIS CASE DETECTION
                        </h2>

                    </div>

                </td>
                <td style="border: none;" colspan="4">
                    <img width="84px" src="../api/documents/x5nJFLDnCDt/data" alt="END TB">
                </td>

            </tr>

            <tr>
                <td colspan="18" style="border: none;">
                    <hr />

                </td>
            </tr>
            <tr>
                <th colspan="5">Organization unit</th>
                <th colspan="5">NAME of the DOT CENTER</th>
                <th colspan="5">YEARS</th>
                <th colspan="8" rowspan="2">SIGNATURE and COMPLETION DATE THIS FORMAT</th>
            <tr>
                <td colspan="5" id="municipality"></td>
                <td colspan="5" id="dot_center"></td>
                <td colspan="5" id="year"></td>
            </tr>

            </tr>
            <tr>
                <th colspan="5">Name of Health Facility</th>
                <th colspan="5">KTM or TB Responsible</th>
                <th colspan="5">QUARTERLY</th>
                <td colspan="5" rowspan='2'></td>
            </tr>
            <tr>
                <td colspan="5" style="text-align: center;"></td>
                <td colspan="5"></td>
                <td colspan="5" id="quarter"></td>
            </tr>

            <tr class="blocks">
                <th colspan="18">Block 1 : All TB cases registered during this trimester/Quarterᵇ</th>
            </tr>
            <tr>
                <th colspan="3">Category</th>
                <th colspan="3">New</th>
                <th colspan="3">Relapse</th>
                <th colspan="3">Re-Treatment Cases not including relapse</th>
                <th colspan="3">Others</th>
                <th colspan="3">Total</th>
            </tr>
            <tr>
                <td colspan="3">Pulmonary, Confirmed Bacteriological</td>
                <td colspan="3" id="CQRoy4A77oS"></td>
                <td colspan="3" id="rZlR9pJ1wqO"></td>
                <td colspan="3" id="KJLxCbxmadC"></td>
                <td colspan="3" id="ptiMqpRoSUY"></td>
                <td colspan="3" id="bacteriological_total"></td>
            </tr>
            <tr>
                <td colspan="3">Pulmonary, Clinical diagnosis</td>
                <td colspan="3" id="iOmlSantG2F"></td>
                <td colspan="3" id="oi0XlFPapIE"></td>
                <td colspan="3" id="GBIZzcoirMD"></td>
                <td colspan="3" id="FmLyMk1VApk"></td>
                <td colspan="3" id="clinical_total"></td>
            </tr>
            <tr>
                <td colspan="3">Extra-Pulmonary, Confirmed Bacteriological</td>
                <td colspan="3" id="lh7OOsQ2wEp"></td>
                <td colspan="3" id="KTvOwG6fhoM"></td>
                <td colspan="3" id="KUFBtfAgAf3"></td>
                <td colspan="3" id="UbCfoupUJZl"></td>
                <td colspan="3" id="extra_pulmonary_total"></td>
            </tr>
            <tr>
                <td colspan="3">Extra-Pulmonary, Clinical diagnosis</td>
                <td colspan="3" id="zmo2LrEnDtq"></td>
                <td colspan="3" id="EPBNfRWUbsQ"></td>
                <td colspan="3" id="h20Znk6wZpJ"></td>
                <td colspan="3" id="YhOxCLvolm8"></td>
                <td colspan="3" id="extra_pulmonary_clinical_total"></td>
            </tr>
            <tr>
                <th colspan="18">
                    Block 2: All New and Re-treated pulmonary and Extra Pulmonary TB cases (bacteriologically
                    confirmed and clinically diagnosed) registered during this trimester by age and sex
                </th>
            </tr>


            <!-- ------------------------ -->
            <tr>
                <th colspan="1">Category</th>
                <th colspan="2">0-4</th>
                <th colspan="2">5-14</th>
                <th colspan="2">15-24</th>
                <th colspan="2">25-34</th>
                <th colspan="2">35-44</th>
                <th colspan="2">45-54</th>
                <th colspan="2">55-64</th>
                <th colspan="2">65+</th>
                <th rowspan="2" colspan="1">Total</th>
            </tr>
            <tr>
                <td></td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
                <td>M</td>
                <td>F</td>
            </tr>
            <tr>
                <td>Pulmonary, Confirmed Bacteriological (New & Relapse)</td>
                <td id="SXDckwCKJYC"></td>
                <td id="QqsSDFUrjSB"></td>
                <td id="ccp3RrBnbYd"></td>
                <td id="VJZD6FvOVBe"></td>
                <td id="L2JRD1rbE8C"></td>
                <td id="RWYvhXNt7Fq"></td>
                <td id="LxcN13z8r7Y"></td>
                <td id="hNiV38PUmr5"></td>
                <td id="bJXmuYCemZe"></td>
                <td id="fhrnWpQOYKN"></td>
                <td id="rtVqErgzAH6"></td>
                <td id="MKTZLuYqgFp"></td>
                <td id="S873Lca3cn2"></td>
                <td id="qHn9RhQWRpK"></td>
                <td id="etmtIggSBi2"></td>
                <td id="pH6itJ9bnAA"></td>
                <td id="one_total"></td>
            </tr>
            <tr>
                <td>Pulmonary, Clinical diagnosis (New & Relapse)</td>
                <td id="K81oZQ4b5Vl"></td>
                <td id="K8VVrMcSAUD"></td>
                <td id="MzPenhNCmy2"></td>
                <td id="GkgzaLmrg5S"></td>
                <td id="Tak313dv0CT"></td>
                <td id="QwOHKYNmdN9"></td>
                <td id="eu9RAPEMXhb"></td>
                <td id="IfECSBYqrqV"></td>
                <td id="ragjEZ11Bti"></td>
                <td id="foLPFMyQzkB"></td>
                <td id="doyR9jQvv92"></td>
                <td id="FDxVW7nURcD"></td>
                <td id="KjbIihlYc5D"></td>
                <td id="ck9AtliGzns"></td>
                <td id="npDd2ehR91M"></td>
                <td id="v6mPHFvH2Ho"></td>
                <td id="two_total"></td>
            </tr>
            <tr>
                <td>Extra-Pulmonary, Confirmed Bacteriological (New & Relapse)</td>
                <td id="Qmn9t6ic2Ip"></td>
                <td id="rdTltuMUyJ2"></td>
                <td id="i1kUoUdPh4g"></td>
                <td id="l8o7a9BeWiA"></td>
                <td id="L2JRD1rbE8C"></td>
                <td id="eWf1cLe5CYx"></td>
                <td id="M4YbCXVF9oC"></td>
                <td id="avscrYJ9ii6"></td>
                <td id="GOA1vWQz511"></td>
                <td id="ACz8jHbtXp0"></td>
                <td id="JHLfjvBLeUs"></td>
                <td id="Km24TbRw3x8"></td>
                <td id="bApABSsq2JL"></td>
                <td id="FD9nEnMRyoF"></td>
                <td id="s8uCsbutKGD"></td>
                <td id="xwahWbXIfBY"></td>
                <td id="three_total"></td>
            </tr>
            <tr>
                <td>Extra-Pulmonary, Clinical diagnosis (New & Relapse)</td>
                <td id="OUhSmm4dgib"></td>
                <td id="rultCo5UgRK"></td>
                <td id="YStSsRtrVas"></td>
                <td id="TYH8sXuaXmA"></td>
                <td id="LU5jtYRF6La"></td>
                <td id="HHpHSFSE3EZ"></td>
                <td id="AhInaoftNCd"></td>
                <td id="PPdyhzFTeFo"></td>
                <td id="RnWEc5cKvZp"></td>
                <td id="czLYlOeQwGW"></td>
                <td id="hW5ulsNnnqW"></td>
                <td id="gtMP1QqyRYr"></td>
                <td id="CpkCpMoAYVo"></td>
                <td id="VEudNfnd0aC"></td>
                <td id="aVSA5czHBLU"></td>
                <td id="cL5Ag5X14kt"></td>
                <td id="four_total"></td>
            </tr>
            <tr>
                <td>Re-Treatment (Not Including Relapses)</td>
                <td id="LoaPxMJOKr3"></td>
                <td id="zL8XNXzxnr2"></td>
                <td id="ldrqsEwxWsJ"></td>
                <td id="SJJE4Ni82Sh"></td>
                <td id="gZijJYbKv2k"></td>
                <td id="Ki8mQbu2F1E"></td>
                <td id="VNZAP2Wf5iF"></td>
                <td id="rJGQzuPNywH"></td>
                <td id="rFLaQX02Ddq"></td>
                <td id="pG8werVQdO7"></td>
                <td id="vru43mGzls1"></td>
                <td id="rQMlVZ8lSZm"></td>
                <td id="lLhkZ4D8c3S"></td>
                <td id="hznkuswZSGk"></td>
                <td id="TJx2McykrlS"></td>
                <td id="gumAfDYax97"></td>
                <td id="fifth_total"></td>
            </tr>
            <tr>
                <td>Others</td>
                <td id="oWswmbktgL8"></td>
                <td id="mfTRxMc4DHa"></td>
                <td id="bIe6AZBMSG5"></td>
                <td id="c2cFDV9pgAS"></td>
                <td id="i0ItKQ9YmD8"></td>
                <td id="yy0zr2fIRO2"></td>
                <td id="c3gZVNZg7r4"></td>
                <td id="RklRk3mmOze"></td>
                <td id="MA0u6yw5NA3"></td>
                <td id="RKdFMUJPjLc"></td>
                <td id="NqNkrIUwR53"></td>
                <td id="QNCrfis57j8"></td>
                <td id="A6yGNdnXXlJ"></td>
                <td id="PdwVSUXFLlO"></td>
                <td id="AtKn2nBFn1u"></td>
                <td id="qPWqNjqcLXx"></td>
                <td id="six_total"></td>
            </tr>

            <!-- ------------------- -->

            <tr>
                <th colspan="18">
                    Block 3: Laboratory diagnostic activities
                </th>
            </tr>
            <tr>
                <td colspan="9">BI.</td>
                <td colspan="9">Presumptive TB patients positive on confirmed bacteriological examination</td>
            </tr>

            <tr>
                <td colspan="4">Smear</td>
                <td colspan="4">GeneXpert</td>
                <td colspan="4">Smear</td>
                <td colspan="6">GeneXpert</td>
            </tr>
            <tr>
                <td colspan="4" id="C6lWRx9CeH9"></td>
                <td colspan="4" id="kR9xuxIIdU1"></td>
                <td colspan="4" id="XlmRMbySRXT"></td>
                <td colspan="6" id="OMkZDK3ji6L"></td>
            </tr>

            <tr>
                <th colspan="18">
                    Block 4: Block 4:TB/HIV activity (All cases registered during this Quarter)
                </th>
            </tr>
            <tr>
                <td colspan="8">Patient is tested for HIV at the time of TB diagnosis or during treatment Or his own interest test to know HIV status</td>
                <td colspan="3" rowspan="2">TB- HIV positive patients</td>
                <td colspan="3" rowspan="2">TB- HIV positive patients on ART</td>
                <td colspan="4" rowspan="2">HIV- TB patients is positive and received CPT</td>
            </tr>

            <tr>
                <td colspan="4">Total(Types of TB Cases***  All TB patients tested for HIV)</td>
                <td colspan="4">Total (Types of TB Cases*** New and Relapsing TB Patients Tested for HIV)</td>
            </tr>
            <tr>
                <td colspan="4" id="dcysIdCmmtx"></td>
                <td colspan="4" id="rZIsC2Byzdz"></td>
                <td colspan="3" id="l2muzX2aNUj"></td>
                <td colspan="3" id="xD2oFBuAV4U"></td>
                <td colspan="4" id="Pxf0xz6QPaX"></td>
            </tr>



            <!-- --------------------------- -->

            <tr>
                <th colspan="18">Block 5: TB & Diabetes Activity</th>
            </tr>

            <tr>
                <td colspan="9">TB patients is tested for FBS with a glucometer</td>
                <td colspan="9">TB patients with DM</td>
            </tr>

            <tr>
                <td colspan="9" id="fahEUIf0P5m"></td>
                <td colspan="9" id="D5vhY6E06TG"></td>
            </tr>


            <!-- ------------------------ -->

            <tr>
                <th colspan="18">Block 6:  LTBI management</th>
            </tr>

            <tr>
                <td colspan="4">Nu. of Child (<2 years) close contact and on TPT</td>
                <td colspan="4">Nu. of Child (>2 years to 14 years) close contact and exposure/consume TPT</td>
                <td colspan="4">Nu. of Adult close contact and receive TPT</td>
                <td colspan="6">Nu. of PLHIV received TPT</td>
            </tr>

            <tr>
                <td colspan="4" id="P2i7huDY2aO"></td>
                <td colspan="4" id="eo4PEazr85B"></td>
                <td colspan="4" id="BfDMCn459rK"></td>
                <td colspan="6" id="rf0L3krG4U2"></td>
            </tr>

        </table>

        <p>a) The registration period was based on the date of case registration in the TB registry, followed by the
            date of
        </p>
        <p>b) The case of “Transfer In” does not include</p>
        <p>c) The aggregation date of the laboratory registration is based on the date of the Productive Cough sample,
            excluding patients who under follow up examination.</p>
        <p>d) Include all TB patients who are known to be HIV positive (eg. have documented evidence of receiving HIV
            treatment such as registering for PRE-ART treatment or having ART registration when starting ART) or
            patients
            with evidence of HIV negative in moment on TB diagnose </p>
        <table class="left-align">
            <tr>
                <td>Approved by,</td>
            </tr>

            <tr>
                <td>.......</td>
            </tr>
        </table>
    </div>
</body>


<script>

    console.log(dhis2);
    document.getElementById("loader").style.display = "block";
    document.getElementById("tb-report").style.display = "none";

    const quarter = dhis2.report.periods[0].slice(4, 6);
    const reportPeriod = dhis2.report.periods[0];
    const year = parseInt(reportPeriod.slice(0, 4));
    console.log("Quarter: ", quarter);
    console.log("Report Period: ", reportPeriod);
    

    // const reportPeriod = dhis2.report.date.split("-")[0];
    const { startDate, endDate } = getQuarterDates(quarter,year);
    console.log("Report Period: ", getQuarterDates(quarter,year));
    

    const { id: ou, name: ouName } = dhis2.report.organisationUnit;
    const dataElement = [
        "CQRoy4A77oS",
        "rZlR9pJ1wqO",
        "KJLxCbxmadC",
        "ptiMqpRoSUY",
        "iOmlSantG2F",
        "oi0XlFPapIE",
        "GBIZzcoirMD",
        "FmLyMk1VApk",
        "lh7OOsQ2wEp",
        "KTvOwG6fhoM",
        "KUFBtfAgAf3",
        "UbCfoupUJZl",
        "zmo2LrEnDtq",
        "EPBNfRWUbsQ",
        "h20Znk6wZpJ",
        "YhOxCLvolm8",
        "SXDckwCKJYC",
        "QqsSDFUrjSB",
        "ccp3RrBnbYd",
        "VJZD6FvOVBe",
        "L2JRD1rbE8C",
        "RWYvhXNt7Fq",
        "LxcN13z8r7Y",
        "hNiV38PUmr5",
        "bJXmuYCemZe",
        "fhrnWpQOYKN",
        "rtVqErgzAH6",
        "MKTZLuYqgFp",
        "S873Lca3cn2",
        "qHn9RhQWRpK",
        "etmtIggSBi2",
        "pH6itJ9bnAA",
        "K81oZQ4b5Vl",
        "K8VVrMcSAUD",
        "MzPenhNCmy2",
        "GkgzaLmrg5S",
        "Tak313dv0CT",
        "QwOHKYNmdN9",
        "eu9RAPEMXhb",
        "IfECSBYqrqV",
        "ragjEZ11Bti",
        "foLPFMyQzkB",
        "doyR9jQvv92",
        "FDxVW7nURcD",
        "KjbIihlYc5D",
        "ck9AtliGzns",
        "npDd2ehR91M",
        "v6mPHFvH2Ho",
        "Qmn9t6ic2Ip",
        "rdTltuMUyJ2",
        "i1kUoUdPh4g",
        "l8o7a9BeWiA",
        "L2JRD1rbE8C",
        "eWf1cLe5CYx",
        "M4YbCXVF9oC",
        "avscrYJ9ii6",
        "GOA1vWQz511",
        "ACz8jHbtXp0",
        "JHLfjvBLeUs",
        "Km24TbRw3x8",
        "bApABSsq2JL",
        "FD9nEnMRyoF",
        "s8uCsbutKGD",
        "xwahWbXIfBY",
        "OUhSmm4dgib",
        "rultCo5UgRK",
        "YStSsRtrVas",
        "TYH8sXuaXmA",
        "LU5jtYRF6La",
        "HHpHSFSE3EZ",
        "AhInaoftNCd",
        "PPdyhzFTeFo",
        "RnWEc5cKvZp",
        "czLYlOeQwGW",
        "hW5ulsNnnqW",
        "gtMP1QqyRYr",
        "CpkCpMoAYVo",
        "VEudNfnd0aC",
        "aVSA5czHBLU",
        "cL5Ag5X14kt",
        "LoaPxMJOKr3",
        "zL8XNXzxnr2",
        "ldrqsEwxWsJ",
        "SJJE4Ni82Sh",
        "gZijJYbKv2k",
        "Ki8mQbu2F1E",
        "VNZAP2Wf5iF",
        "rJGQzuPNywH",
        "rFLaQX02Ddq",
        "pG8werVQdO7",
        "vru43mGzls1",
        "rQMlVZ8lSZm",
        "lLhkZ4D8c3S",
        "hznkuswZSGk",
        "TJx2McykrlS",
        "gumAfDYax97",
        "oWswmbktgL8",
        "mfTRxMc4DHa",
        "bIe6AZBMSG5",
        "c2cFDV9pgAS",
        "i0ItKQ9YmD8",
        "yy0zr2fIRO2",
        "c3gZVNZg7r4",
        "RklRk3mmOze",
        "MA0u6yw5NA3",
        "RKdFMUJPjLc",
        "NqNkrIUwR53",
        "QNCrfis57j8",
        "A6yGNdnXXlJ",
        "PdwVSUXFLlO",
        "AtKn2nBFn1u",
        "qPWqNjqcLXx",
        "C6lWRx9CeH9",
        "kR9xuxIIdU1",
        "XlmRMbySRXT",
        "OMkZDK3ji6L",
        "dcysIdCmmtx",
        "rZIsC2Byzdz",
        "l2muzX2aNUj",
        "xD2oFBuAV4U",
        "Pxf0xz6QPaX",
        "fahEUIf0P5m",
        "D5vhY6E06TG",
        "P2i7huDY2aO",
        "eo4PEazr85B",
        "BfDMCn459rK",
        "rf0L3krG4U2"];

    const totalValution = {
        bacteriological_total: ["CQRoy4A77oS", "rZlR9pJ1wqO", "KJLxCbxmadC", "ptiMqpRoSUY"],

        clinical_total: ["iOmlSantG2F", "oi0XlFPapIE", "GBIZzcoirMD", "FmLyMk1VApk"],

        extra_pulmonary_total: ["lh7OOsQ2wEp", "KTvOwG6fhoM", "KUFBtfAgAf3", "UbCfoupUJZl"],

        extra_pulmonary_clinical_total: ["zmo2LrEnDtq", "EPBNfRWUbsQ", "h20Znk6wZpJ", "YhOxCLvolm8"],

        one_total: ["SXDckwCKJYC", "QqsSDFUrjSB", "ccp3RrBnbYd", "VJZD6FvOVBe", "L2JRD1rbE8C", "RWYvhXNt7Fq", "LxcN13z8r7Y", "hNiV38PUmr5", "bJXmuYCemZe", "fhrnWpQOYKN", "rtVqErgzAH6", "MKTZLuYqgFp", "S873Lca3cn2", "qHn9RhQWRpK", "etmtIggSBi2", "pH6itJ9bnAA"],
        two_total: ["K81oZQ4b5Vl", "K8VVrMcSAUD", "MzPenhNCmy2", "GkgzaLmrg5S", "Tak313dv0CT", "QwOHKYNmdN9", "eu9RAPEMXhb", "IfECSBYqrqV", "ragjEZ11Bti", "foLPFMyQzkB", "doyR9jQvv92", "FDxVW7nURcD", "KjbIihlYc5D", "ck9AtliGzns", "npDd2ehR91M", "v6mPHFvH2Ho"],
        three_total: ["Qmn9t6ic2Ip",
            "rdTltuMUyJ2",
            "i1kUoUdPh4g",
            "l8o7a9BeWiA",
            "L2JRD1rbE8C",
            "eWf1cLe5CYx",
            "M4YbCXVF9oC",
            "avscrYJ9ii6",
            "GOA1vWQz511",
            "ACz8jHbtXp0",
            "JHLfjvBLeUs",
            "Km24TbRw3x8",
            "bApABSsq2JL",
            "FD9nEnMRyoF",
            "s8uCsbutKGD",
            "xwahWbXIfBY"],

        four_total: ["OUhSmm4dgib",
            "rultCo5UgRK",
            "YStSsRtrVas",
            "TYH8sXuaXmA",
            "LU5jtYRF6La",
            "HHpHSFSE3EZ",
            "AhInaoftNCd",
            "PPdyhzFTeFo",
            "RnWEc5cKvZp",
            "czLYlOeQwGW",
            "hW5ulsNnnqW",
            "gtMP1QqyRYr",
            "CpkCpMoAYVo",
            "VEudNfnd0aC",
            "aVSA5czHBLU",
            "cL5Ag5X14kt"],

        fifth_total: ["LoaPxMJOKr3",
            "zL8XNXzxnr2",
            "ldrqsEwxWsJ",
            "SJJE4Ni82Sh",
            "gZijJYbKv2k",
            "Ki8mQbu2F1E",
            "VNZAP2Wf5iF",
            "rJGQzuPNywH",
            "rFLaQX02Ddq",
            "pG8werVQdO7",
            "vru43mGzls1",
            "rQMlVZ8lSZm",
            "lLhkZ4D8c3S",
            "hznkuswZSGk",
            "TJx2McykrlS",
            "gumAfDYax97"],

        six_total: ["oWswmbktgL8",
            "mfTRxMc4DHa",
            "bIe6AZBMSG5",
            "c2cFDV9pgAS",
            "i0ItKQ9YmD8",
            "yy0zr2fIRO2",
            "c3gZVNZg7r4",
            "RklRk3mmOze",
            "MA0u6yw5NA3",
            "RKdFMUJPjLc",
            "NqNkrIUwR53",
            "QNCrfis57j8",
            "A6yGNdnXXlJ",
            "PdwVSUXFLlO",
            "AtKn2nBFn1u",
            "qPWqNjqcLXx"]
    }
    document.addEventListener("DOMContentLoaded", async function () {
        // Use Promise.all to wait for all fetch requests to complete
        try {

            // Fetch final URL
            const url = `../api/analytics.json?dimension=pe:${reportPeriod}&dimension=dx:${dataElement.join(';')}&showHierarchy=false&hierarchyMeta=false&includeMetadataDetails=true&includeNumDen=true&skipRounding=false&completedOnly=false&outputIdScheme=UID&filter=ou:${ou}%3BOU_GROUP-Ej7jepIUI2j&paging=false`

            const res = await fetch(url);
            const data = await res.json();

            data.rows.map(item => {
                if (document.getElementById(item[0])) {
                    document.getElementById(item[0]).innerHTML = Number(item[2]) || ''
                }
            })

            document.getElementById('year').innerHTML = reportPeriod.slice(0, 4) || ''
            document.getElementById('municipality').innerHTML = ouName || ''
            document.getElementById('quarter').innerHTML = `${startDate} - ${endDate}`
        } catch (error) {
            alert("Fetched error: ", error)
            console.error('Error fetching data:', error);
        }

        document.getElementById("loader").style.display = "none";
        document.getElementById("tb-report").style.display = "block";


        // calculate total from DOM element
        for (const row in totalValution) {
            let total = 0;

            totalValution[row].forEach(dEle => {
                total += Number(document.getElementById(dEle).textContent) || 0;
            })
            document.getElementById(row).innerHTML = total || '';
        }

    });



    function getQuarterDates(quarterFlag,year) {
        if (!year) {
        year = new Date().getFullYear(); // fallback to current year if none passed
    }
        let startDate, endDate;

        switch (quarterFlag.toUpperCase()) {
            case 'Q1':
                startDate = new Date(year, 0, 1);    // Jan 1
                endDate = new Date(year, 2, 31);     // Mar 31
                break;
            case 'Q2':
                startDate = new Date(year, 3, 1);    // Apr 1
                endDate = new Date(year, 5, 30);     // Jun 30
                break;
            case 'Q3':
                startDate = new Date(year, 6, 1);    // Jul 1
                endDate = new Date(year, 8, 30);     // Sep 30
                break;
            case 'Q4':
                startDate = new Date(year, 9, 1);    // Oct 1
                endDate = new Date(year, 11, 31);    // Dec 31
                break;
            default:
                throw new Error("Invalid quarter flag. Use Q1, Q2, Q3, or Q4.");
        }

        // Helper to format dates as dd-mm-yyyy
        const formatDate = (date) => {
            const dd = String(date.getDate()).padStart(2, '0');
            const mm = String(date.getMonth() + 1).padStart(2, '0'); // Month is 0-based
            const yyyy = date.getFullYear();
            return `${dd}-${mm}-${yyyy}`;
        };

        return {
            startDate: formatDate(startDate),
            endDate: formatDate(endDate)
        };
    }


    function printContent(el) {
        var restorePage = document.body.innerHTML;
        var printContent = document.getElementById(el).innerHTML;

        // Add landscape style and scaling for 1-page print
        var style = `
            <style type="text/css" media="print">
                @page {
                    size: A4;
                    margin: 10mm;
                }
                body {
                    -webkit-print-color-adjust: exact;
                    print-color-adjust: exact;
                    zoom: 75%; /* Adjust this to fit your content on one page */
                }
                td {
                    border: 1px solid black;
                    padding: 8px;
                    text-align: left;
                    min-width: 37px;
               
                    height: 20px !important;
                    text-align: center !important;
                }
            </style>
        `;

        document.body.innerHTML = style + printContent;
        window.print();
        document.body.innerHTML = restorePage;
        location.reload(); // Reload page to reset JS/CSS state if needed
    }

    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="https://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename;
            document.getElementById("dlink").click();
        }
    })()

</script>

</html>