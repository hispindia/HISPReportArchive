<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
    integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<style>
    /* Absolute Center Spinner */
    * {
        font-family: 'Times New Roman', Times, serif;
    }

    .loading {
        position: fixed;
        z-index: 999;
        height: 2em;
        width: 2em;
        overflow: show;
        margin: auto;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        display: none;
    }

    /* Transparent Overlay */

    .loading:before {
        content: '';
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.3);
    }

    /* :not(:required) hides these rules from IE9 and below */

    .loading:not(:required) {
        /* hide "loading..." text */
        font: 0/0 a;
        color: transparent;
        text-shadow: none;
        background-color: transparent;
        border: 0;
    }

    .loading:not(:required):after {
        content: '';
        display: block;
        font-size: 10px;
        width: 1em;
        height: 1em;
        margin-top: -0.5em;
        -webkit-animation: spinner 1500ms infinite linear;
        -moz-animation: spinner 1500ms infinite linear;
        -ms-animation: spinner 1500ms infinite linear;
        -o-animation: spinner 1500ms infinite linear;
        animation: spinner 1500ms infinite linear;
        border-radius: 0.5em;
        -webkit-box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.5) -1.5em 0 0 0, rgba(0, 0, 0, 0.5) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
        box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) -1.5em 0 0 0, rgba(0, 0, 0, 0.75) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
    }

    /* Animation */

    @-webkit-keyframes spinner {
        0% {
            -webkit-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
            -ms-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
            -moz-transform: rotate(360deg);
            -ms-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    @-moz-keyframes spinner {
        0% {
            -webkit-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
            -ms-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
            -moz-transform: rotate(360deg);
            -ms-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    @-o-keyframes spinner {
        0% {
            -webkit-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
            -ms-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
            -moz-transform: rotate(360deg);
            -ms-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    @keyframes spinner {
        0% {
            -webkit-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
            -ms-transform: rotate(0deg);
            -o-transform: rotate(0deg);
            transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
            -moz-transform: rotate(360deg);
            -ms-transform: rotate(360deg);
            -o-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    button {
        cursor: pointer;
    }

    .box {
        width: 50%;
        float: left;
    }
</style>

</head>

<body>
    <div class="loading" id="loader"></div>

    <a id="dlink" style="display:none;"></a>
    <div id="main">
        <div style="width: 40%; margin-left:30%;">
            <table class="table table-bordered">
                <tr>
                    <td style="font-size: 15px;padding-top: 15px;">
                        Start Month / Стартовый месяц
                    </td>
                    <td style="width: 60%;">
                        <input type="date" class=" form-control" id="start-date">
                    </td>
                </tr>
                <tr>
                    <td style="font-size: 15px;padding-top: 15px;">
                        End Month / конец месяца
                    </td>
                    <td style="width: 60%;">
                        <input type="date" class=" form-control" id="end-date">
                    </td>
                </tr>
                <tr>
                    <td style="font-size: 15px;padding-top: 15px;">
                        Programs
                    </td>
                    <td style="width: 60%;">
                        <select id="programs" class="form-control">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><button onClick="submit()" class="btn btn-primary" id="tap">Submit</button></td>
                    <td style="text-align: right;">
                        <div id="downloads" style="display: none;">
                            <img src="https://img.icons8.com/dusk/35/000000/pdf.png"
                                onmouseover="this.style.cursor='pointer'" onclick="printContent('output')"
                                style="cursor: pointer;">
                        </div>
                    </td>


                </tr>
            </table>
        </div>
        <br>
        <div id="output" style="display: none;">
            <table class="table table-bordered table-hover" style="width:100%;text-align:center">
                <tbody>
                    <tr>
                        <td>
                            <h2>MIZORAM HEALTH SYSTEMS STRENGTHENING PROJECT</h2>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h3>IPA SCORE CARD (PHC)</h3>
                        </td>
                    </tr>

                </tbody>
            </table>

            <table class="table table-bordered table-hover" style="width:100%;text-align:left">
                <colgroup>
                    <col width="40%" />
                    <col width="60%" />
                </colgroup>
                <tbody>
                    <tr>
                        <td>
                            <h5>NAME OF FACILITY:</h5>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>
                            <h5>DATE OF ASSESSMENT:</h5>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>
                            <h5>TYPE OF ASSESSMENT:</h5>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>


            <table class="table table-bordered table-hover" width="100%">
            <colgroup>
                <col width="40%" />
                <col width="60%" />
            </colgroup>
                <thead>
                    <td>
                        <h6>CODE</h6>
                    </td>
                    <td>
                        <h6>Score</h6>
                    </td>
                </thead>
                <tbody id="code-score"></tbody>
            </table>


            <div>
                <h5>Name and Signature of Assessors: </h5>
            </div>
            <div>
                <div style="width:30%;float:left;">
                    ________________
                    <br>
                    <p>Team Leader</p>
                </div>
                <div style="width:40%;float:left;">
                    __________________________
                    <br>
                    <p>NQAS Certified Assessor</p>
                </div>
                <div style="width:30%;float:left;">
                    ________________
                    <br>
                    <p>Project Staff</p>
                </div>
            </div>



        </div>
    </div>
</body>

<script>
    var selectedOrgUnit = dhis2.report.organisationUnit;
    var dataElement = [
        'PHC_1_NQAS',
        'PHC_2_Meetings',
        'PHC_3_Execution',
        'PHC_4_Premises',
        'PHC_5_Cleanliness',
        'PHC_6_Handwashing',
        'PHC_7_Toilets',
        'PHC_8_Showers',
        'PHC_9_Med_Waste',
        'PHC_10_Waste_Disp',
        'PHC_11_Patient_Exp',
        'PHC_12_Insurance',
        'TOTAL (Max 800 points = 100%)',
        'PERCENTAGE'
    ]
    var programs = [
        {
            "id": "k6OM7dIb2X6",
            "displayName": "PHC 01 - Service Provision A + IPA Assessment"
        },
        {
            "id": "IA0NVbbRZ1e",
            "displayName": "PHC 02 - Patient's Rights B + IPA Assessment"
        },
        {
            "id": "apkZqa2yqeC",
            "displayName": "PHC 03 - Inputs C + IPA Assessment"
        },
        {
            "id": "wpQQKp9Hy5E",
            "displayName": "PHC 04 - Support Services D + IPA Assessment"
        },
        {
            "id": "kZ1sTUuqdbJ",
            "displayName": "PHC 05 - Clinical Services E + IPA Assessment"
        },
        {
            "id": "go6Fw0IRk6Z",
            "displayName": "PHC 06 - Infection Control F + IPA Assessment"
        },
        {
            "id": "xil8ellyMgi",
            "displayName": "PHC 07 - Quality Management G + IPA Assessment"
        },
        {
            "id": "PJogjQhf9rJ",
            "displayName": "PHC 08 - Outcomes H + IPA Assessment"
        }
    ]

    var pList = '';
    programs.forEach(program => {
        pList += `<option value='${program.id}'>${program.displayName}</option>`
    })
    document.getElementById('programs').innerHTML = pList;

    document.getElementById("loader").style.display = "none";

    var submit = function () {
        document.getElementById("downloads").style.display = "none";
        var startDate = document.getElementById("start-date").value;
        var endDate = document.getElementById("end-date").value;
        var programName = document.getElementById("programs").value;
        var dates = [startDate, endDate];
        var data = {
            startDate: startDate,
            endDate: endDate,
            program: programName
        }


        if (new Date(dates["0"]) > new Date(dates["1"]) || !dates["0"] || !dates["1"]) alert("Please select dates Correctly");
        else {
            document.getElementById("output").style.display = "none";
            document.getElementById("loader").style.display = "block";

            setTimeout(function () {
                getData(data)
            }, 1000)
        }

        async function getData(data) {
            var dataObj = {};

            var responseFirst = await (await fetch(`../api/events.json?program=${data.program}&orgUnit=${selectedOrgUnit.id}&startDate=${data.startDate}&endDate=${data.endDate}&paging=false`)).json();
            responseFirst.events.forEach(event => {
                event.dataValues.forEach(dv => {
                    dataObj[dv.dataElement] = dv.value;
                    if (dv.dataElement == 'm50G1QGE4E8') {
                        dataObj["exAnte-ev"] = event.eventDate.split("T")[0];
                    }
                })
            });


    var codeScore = '';
    dataElement.forEach(de => {
        codeScore += `<tr><td>${de}</td><td></td></tr>`
    })
    document.getElementById('code-score').innerHTML = codeScore;

            document.getElementById("output").style.display = "block";
            document.getElementById("downloads").style.display = "block";
            document.getElementById("loader").style.display = "none";

        }
    };

    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }

</script>