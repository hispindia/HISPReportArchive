<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<style>
    thead>tr>td {
        font-weight: bold;
    }

    tbody>tr>td {
        font-weight: bold;
    }

    /* Center the loader  */

    #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #34B4DB;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Add animation to "page content" */

    .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0px;
            opacity: 1
        }
    }

    @keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0;
            opacity: 1
        }
    }

    #printing {

        text-align: center;
    }
</style>

<a id="dlink" style="display:none;"></a>
<button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;"
    onclick="printContent('printing')"><span class="glyphicon glyphicon-print" style="font-size: 15px;"></span> &nbsp;
    Print
</button>

<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport"
    onclick="tableToExcel('dataTable', 'Excel Report', 'Excel Report.xls')"><span
        class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span>Download As Excel</button>
<br><br>
<div id="loader"></div>
<div id="printing" class="animate-bottom">
    <div id='state'>
        <table id="dataTable" border="1" class="table  table-hover text-center" cellspacing="6" cellpadding="4"
            style="border-collapse: collapse; text-align: center">
            <thead>
                <tr style=" font:bold; text-align:center;">
                    <td style="border:1px solid black;background:#ADD8E6;">Region and country</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Code</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Population <span class="currentYear"></span>
                        (in '000)</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Total Number of New Cases Detected in <span
                            class="currentYear"></td>
                    <td style="border:1px solid black;background:#ADD8E6;">New Case Detection Rate</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Number of Cases Registered for Treatment at
                        end of Year <span class="currentYear"> </span></td>
                    <td style="border:1px solid black;background:#ADD8E6;">Prevalence Rate (per 10,000 Population)</td>
                    <td style="border:1px solid black;background:#ADD8E6;">MB Cases</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Proportion of MB</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Female cases</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Proportion of Female cases</td>

                    <td style="border:1px solid black;background:#ADD8E6;">Children &lt;5 years </td>
                    <td style="border:1px solid black;background:#ADD8E6;">Children 6-15 years </td>

                    <td style="border:1px solid black;background:#ADD8E6;">Child Population <span class="currentYear">
                        </span>( in '000)</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Children Under 15 Years of Age</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Proportion of Child Cases</td>

                    <td style="border:1px solid black;background:#ADD8E6;">Child case detection rate (per Million
                        population)</td>

                    <td style="border:1px solid black;background:#ADD8E6;">New Cases With Grade-2 Disabilities children
                        (< 15 Years)</td>
                    <td style="border:1px solid black;background:#ADD8E6;">New Cases with Grade-2
                        Disabilities Adult (>= 15 Years)</td>

                    <td style="border:1px solid black;background:#ADD8E6;">Leprosy Cases - Grade 2 Disability Age
                        (Unknown) </td>
                    <td style="border:1px solid black;background:#ADD8E6;">New Cases with Grade-2 Disabilities (G2D
                        Cases</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Proportion of New G2D Cases</td>
                    <td style="border:1px solid black;background:#ADD8E6;">New G2D Case Rate</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Number of Relapses Reported During the Year
                    </td>
                    <td style="border:1px solid black;background:#ADD8E6;">Number of Re-treatment cases Reported During
                        the Year2</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Number of Total Re-treatment cases Reported
                        During the Year3</td>

                    <td style="border:1px solid black;background:#ADD8E6;">Cure Rate PB% - Cohort Year <span
                            id="lastYear"></span< /td>
                    <td style="border:1px solid black;background:#ADD8E6;">Cure Rate MB% - Cohort Year <span
                            id="secondLastYear"></span< /td>
                    <td style="border:1px solid black;background:#ADD8E6;">Foreign Cases</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Legistation against discrimination</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Number of Cases with Drug Resistance</td>

                    <td style="border:1px solid black;background:#ADD8E6;">Number of Cases with Drug Resistance 2</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Percentage of Contacts examined</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Cases detected from contacts</td>
                    <td style="border:1px solid black;background:#ADD8E6;">Proportion of cases detected from Contacts
                    </td>
                    <td style="border:1px solid black;background:#ADD8E6;">Remarks</td>
                </tr>
                <tr id="show" style=" display:none; font-weight:400; text-align:center;">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>=ROUND(D3/C3*100,2)</td>
                    <td></td>
                    <td>=ROUND(F3/C3*10,2)</td>
                    <td></td>
                    <td>=ROUND(H3/D3*100,2)</td>
                    <td></td>
                    <td>=ROUND(J3/D3*100,2)</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>=ROUND(L3/D3*100,2)</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>=ROUND(Q3/D3*100,2)</td>
                    <td>=ROUND(Q3/C3*1000,2)</td>
                </tr>
            </thead>
        </table>
    </div>
</div>



<!-- printing script -->
<script type="text/javascript">
    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }

</script>

<!-- Main Script -->

<script type="text/javascript">
    console.log("hello")
    $(document).ready(function () {
        var startDate = (dhis2.report.date.split('-'))[0];
        for (let i = 0; i < document.getElementsByClassName("currentYear").length; i++) {
            document.getElementsByClassName("currentYear")[i].innerHTML = startDate;
        }
        document.getElementById("lastYear").innerHTML = startDate - 1;
        document.getElementById("secondLastYear").innerHTML = startDate - 2;

        let arrSorting = (a, b) => {
            if (a.name < b.name) //sort string ascending
                return -1
            if (a.name > b.name)
                return 1
            return 0
        }

        var tabledatalevel2Orgs = '';
        var firstOrgUnitid = dhis2.report.organisationUnit.name;
        let orgUnitLevel = dhis2.report.organisationUnitHierarchy.length;
        let orgUnitChildren = [];
        let orgUnitChildrenAll = [];
        let orgUnitPbMbCureRate = [];

        var value1;
        var value2 = 0;
        var value3;
        var value4 = 0;
        var value5;
        var value6;
        var value7;
        var value8;
        var value9;
        var value10 = 0;
        var value11;
        var value12;
        var value13;
        var value14 = 0;
        var value15;
        var value16;
        var value17 = 0;
        var value18 = 0;
        var value19;
        var value20;
        var value21;
        var value22;
        var value23 = 0;
        var value24 = 0;
        var value25;
        var value26;
        var value27 = 0;
        var value28 = 0;
        var value29;
        var value30 = 0;
        var value31 = 0;
        var value32;
        var value33;
        var value34;
        var value35 = '';

        var totalValue1 = 0, totalValue2 = 0, totalValue3 = 0, totalValue4 = 0, totalValue5 = 0, totalValue6 = 0, totalValue7 = 0, totalValue8 = 0, totalValue9 = 0, totalValue10 = 0, totalValue11 = 0, totalValue12 = 0, totalValue13 = 0, totalValue14 = 0, totalValue15 = 0, totalValue16 = 0, totalValue17 = 0, totalValue18 = 0, totalValue19 = 0, totalValue20 = 0, totalValue21 = 0, totalValue22 = 0, totalValue23 = 0, totalValue25 = 0, totalValue26 = 0, totalValue27 = 0, totalValue28 = 0, totalValue29 = 0, totalValue30 = 0, totalValue31 = 0, totalValue32 = 0, totalValue33 = 0, totalValue34 = 0, totalValue35 = "";
        var globalTotalValue1 = 0, globalTotalValue2 = 0, globalTotalValue3 = 0, globalTotalValue4 = 0, globalTotalValue5 = 0, globalTotalValue6 = 0, globalTotalValue7 = 0, globalTotalValue8 = 0, globalTotalValue9 = 0, globalTotalValue10 = 0, globalTotalValue11 = 0, globalTotalValue12 = 0, globalTotalValue13 = 0, globalTotalValue14 = 0, globalTotalValue15 = 0, globalTotalValue16 = 0, globalTotalValue17 = 0, globalTotalValue18 = 0, globalTotalValue19 = 0, globalTotalValue20 = 0, globalTotalValue21 = 0, globalTotalValue22 = 0, globalTotalValue23 = 0, globalTotalValue25 = 0, globalTotalValue26 = 0, globalTotalValue27 = 0, globalTotalValue28 = 0, globalTotalValue29 = 0, globalTotalValue30 = 0, globalTotalValue31 = 0, globalTotalValue32 = 0, globalTotalValue33 = 0, globalTotalValue34 = 0, globalTotalValue35 = "";


        const getOrgUnitChildern = function () {



            //To get the pb and mb cure rate for total and grand total
            $.ajax({
                type: "GET",
                async: false,
                url: "../api/analytics.json?dimension=pe:" + startDate + "&dimension=dx:trqV4BI71xI;M2kzreZCnhv;SsZP6Izyhay;PQCJ1jNYVMU;xWUvequQxeM&dimension=ou:QvCHetFovQg;vY40CQrh4Kk;L9CbxlithLc;uWVIlmAl1r5;XHT7CFb5mEe;UzbbopOhq1L;x3i5oi4axNu&displayProperty=NAME&paging=false",
                data: JSON,
                success: function (data, status) {

                    data.rows.forEach(element => {
                        let region = data.metaData.items[element["2"]].name;

                        if (!orgUnitPbMbCureRate[region]) orgUnitPbMbCureRate[region] = [];

                        if (element["0"] == "PQCJ1jNYVMU") {  //PB cure rate 
                            orgUnitPbMbCureRate[region]["0"] = element["3"];
                        }
                        if (element["0"] == "xWUvequQxeM") { //MB cure rate 
                            orgUnitPbMbCureRate[region]["1"] = element["3"];
                        }
                        if (element["0"] == "SsZP6Izyhay") {
                            orgUnitPbMbCureRate[region]["2"] = element["3"];
                        }

                        if (element["0"] ==  "trqV4BI71xI") {
                            orgUnitPbMbCureRate[region]["3"] = element["3"];
                        }
                        if (element["0"] ==  "M2kzreZCnhv") {
                            orgUnitPbMbCureRate[region]["4"] = element["3"];
                        }



                    })


                }
            });

            if (orgUnitLevel == 1) {
                dhis2.report.organisationUnitChildren.forEach((child, index) => {

                    $.ajax({
                        type: "GET",
                        async: false,
                        url: "../api/organisationUnits/" + child.id + ".json?fields=children[id,name,code]&paging=false",
                        data: JSON,
                        success: function (data, status) {
                            orgUnitChildren[child.name] = data.children;
                            let sortedChildrens = orgUnitChildren[child.name].sort(arrSorting);
                            orgUnitChildrenAll[child.name] = []
                            for (let i = 0; i < sortedChildrens.length; i++) {
                                orgUnitChildrenAll[child.name][i + "-" + sortedChildrens[i].id] = { name: sortedChildrens[i].name, code: sortedChildrens[i].code };
                            }

                        }
                    });
                })
            }
            else if (orgUnitLevel == 2) {
                orgUnitChildren[firstOrgUnitid] = dhis2.report.organisationUnitChildren.sort(arrSorting);
                let sortedChildrens = dhis2.report.organisationUnitChildren.sort(arrSorting);
                orgUnitChildrenAll[firstOrgUnitid] = []
                for (let i = 0; i < sortedChildrens.length; i++) {
                    orgUnitChildrenAll[firstOrgUnitid][i + "-" + sortedChildrens[i].id] = { name: sortedChildrens[i].name, code: sortedChildrens[i].code };
                }

            }
            else {
                let id = dhis2.report.organisationUnit;
                orgUnitChildren[id.name] = id;
                orgUnitChildrenAll[firstOrgUnitid] = [];
                orgUnitChildrenAll[firstOrgUnitid]["0-" + id.id] = { name: id.name, code: id.code };

            }



            let orgUnitChildrenKeys = Object.keys(orgUnitChildren).sort();

            orgUnitChildrenKeys.forEach((val, i) => {
                if (orgUnitLevel != 3) {
                    var orgUnitChildrenkeysTotal = orgUnitChildren[val].reduce((total, currentVal, index) => (index == 1) ? total.id + ";" + currentVal.id + ";" : total + currentVal.id + ";");
                } else {
                    orgUnitChildrenkeysTotal = orgUnitChildren[val].id;
                }
                $.ajax({
                    type: "GET",
                    async: false,
                    url: "../api/analytics.json?dimension=pe:" + startDate + "&dimension=dx:SsZP6Izyhay;trqV4BI71xI;Xzuid5sSSg3;M2kzreZCnhv;EnQPW5xZDPX;ze0DbmcIajV;d1d6EWQZJGB;evXyDr6c7eu;gVmFx873rdZ;IQgrP2W9gTV;LL3PpzJHqJZ;ElAjdwOrjMq;bLR7YvL1f5O;mdupOTsRJ58;lzbsUQJvvJB;sAXV6Hnve4i;LhfXR2fKhsZ;xdbnQxRVTBq;KrvcvcTLqIh;C6xcdI95huJ;xl4EXfRMBrK.Te9RyzefSAz;xl4EXfRMBrK.ZZFiCRpT37i;xl4EXfRMBrK.sdMU6tpPki6;v1Fr4On014j;j62SFyBOrSN;VBEhMPsLu53.HllvX50cXC0;YVj2PYy0Slj.HllvX50cXC0;lhSRNgfsxYC.HllvX50cXC0;EHT4ON2ZtNl.HllvX50cXC0;PQCJ1jNYVMU;xWUvequQxeM;nbDlMYKljTK.HllvX50cXC0;fWOu6CXWmYj.HllvX50cXC0;CAwisvSGkaj.qqJwrOzkzcz;CAwisvSGkaj.G0EY8ZnkmVI;CAwisvSGkaj.oSHl2cUvHmk;sgdAybfDzTl.qqJwrOzkzcz;sgdAybfDzTl.G0EY8ZnkmVI;sgdAybfDzTl.oSHl2cUvHmk;MiHLzmsVFPf.xC5PhT2YVtr;MiHLzmsVFPf.GcQ4Ep0wmnH;ubgNtdy3h9H.xC5PhT2YVtr;ubgNtdy3h9H.GcQ4Ep0wmnH;tyHgOKrZsMJ.GcQ4Ep0wmnH;tyHgOKrZsMJ.xC5PhT2YVtr;TBTHguhWty1;gVmFx873rdZ.ZZFiCRpT37i;TBTHguhWty1;evXyDr6c7eu.ZZFiCRpT37i;IQgrP2W9gTV.ZZFiCRpT37i&dimension=ou:" + orgUnitChildrenkeysTotal + "&displayProperty=NAME&user=dcMT9xWEWHA",
                    data: JSON,
                    success: function (res4, status) {

                        finalvalue(res4, ouidRegion = orgUnitChildrenKeys[i]);
                    }
                });

            })

        }

        getOrgUnitChildern();

        function finalvalue(res4, ouidRegion) {

            let data = res4.rows;
            let regionPbCureRate = data.filter(val => ouidRegion)
            let count1 = 0, count2 = 0, count3 = 0, count4 = 0, count5 = 0, count6 = 0, count7 = 0, count8 = 0;
            tabledatalevel2Orgs = '<tr>';
            tabledatalevel2Orgs += ('<td align="left"; style=" font-weight:bold; background-color:#ADD8E6;">' + ouidRegion + "</td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>\
                                            <td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td><td style='background-color:#ADD8E6'></td>");
            tabledatalevel2Orgs += "</tr>";
            document.getElementById("dataTable").innerHTML += tabledatalevel2Orgs;

            for (let keys in orgUnitChildrenAll[ouidRegion]) {

                let newdata = data.filter((val, i) => (keys.split("-")[1] == val[2]));

                let ouname, ouidCode;

                for (let j = 0; j < newdata.length; j++) {


                    if (newdata[j][0] == "d1d6EWQZJGB") {
                        value1 = (newdata[j][3]) / 1000;
                    }
                    if (newdata[j][0] == "ElAjdwOrjMq") {
                        value3 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "sAXV6Hnve4i") {
                        value5 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "evXyDr6c7eu") {
                        value6 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "LhfXR2fKhsZ") {
                        value7 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "xdbnQxRVTBq") {
                        value8 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "KrvcvcTLqIh") {
                        value9 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "C6xcdI95huJ") {
                        value11 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "xl4EXfRMBrK.ZZFiCRpT37i") {
                        value12 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "xl4EXfRMBrK.Te9RyzefSAz") {
                        value13 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "j62SFyBOrSN") {
                        value15 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "v1Fr4On014j") {
                        value16 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "PQCJ1jNYVMU") {
                        value19 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "xWUvequQxeM") {
                        value20 = parseFloat(newdata[j][3]).toFixed(2);
                    }
                    if (newdata[j][0] == "nbDlMYKljTK.HllvX50cXC0") {
                        value21 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "fWOu6CXWmYj.HllvX50cXC0") {
                        value22 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "xl4EXfRMBrK.sdMU6tpPki6") {
                        value25 = parseInt(newdata[j][3]);
                    }
                    if (newdata[j][0] == "EnQPW5xZDPX") {
                        value26 = Number(datavalue(newdata[j][3]) / 1000);
                    }
                    if (newdata[j][0] == "SsZP6Izyhay") {
                        value29 = Number(newdata[j][3]);
                    }
                    if (newdata[j][0] == "trqV4BI71xI") {
                        value32 = Number(newdata[j][3]);
                    }
                    if (newdata[j][0] == "Xzuid5sSSg3") {
                        value33 = Number(newdata[j][3]);
                    }
                    if (newdata[j][0] == "M2kzreZCnhv") {
                        value34 = Number(newdata[j][3]);
                    }


                    let value = Number(newdata[j][3]);

                    if (newdata[j][0] == "MiHLzmsVFPf.xC5PhT2YVtr" || newdata[j][0] == "ubgNtdy3h9H.xC5PhT2YVtr" || newdata[j][0] == "tyHgOKrZsMJ.xC5PhT2YVtr") {
                        value27 += value;
                    }
                    if (newdata[j][0] == "MiHLzmsVFPf.GcQ4Ep0wmnH" || newdata[j][0] == "ubgNtdy3h9H.GcQ4Ep0wmnH" || newdata[j][0] == "tyHgOKrZsMJ.GcQ4Ep0wmnH") {
                        value28 += value;
                    }
                    if (newdata[j][0] == "sgdAybfDzTl.oSHl2cUvHmk" || newdata[j][0] == "sgdAybfDzTl.qqJwrOzkzcz" || newdata[j][0] == "sgdAybfDzTl.G0EY8ZnkmVI") {
                        value30 += value;
                    }
                    if (newdata[j][0] == "CAwisvSGkaj.oSHl2cUvHmk" || newdata[j][0] == "CAwisvSGkaj.qqJwrOzkzcz" || newdata[j][0] == "CAwisvSGkaj.G0EY8ZnkmVI") {
                        value31 += value;
                    }

                    if (newdata[j][0] == "evXyDr6c7eu" || newdata[j][0] == "gVmFx873rdZ" || newdata[j][0] == "IQgrP2W9gTV") {
                        if (newdata[j][3] == "0.0") count1++;
                        value2 += value;
                    }

                    if (newdata[j][0] == "lzbsUQJvvJB" || newdata[j][0] == "bLR7YvL1f5O" || newdata[j][0] == "mdupOTsRJ58" || newdata[j][0] == "LL3PpzJHqJZ") {
                        if (newdata[j][3] == "0.0") count2++;
                        value4 += value;
                    }
                    if (newdata[j][0] == "evXyDr6c7eu.ZZFiCRpT37i" || newdata[j][0] == "gVmFx873rdZ.ZZFiCRpT37i" || newdata[j][0] == "IQgrP2W9gTV.ZZFiCRpT37i" || newdata[j][0] == "TBTHguhWty1") {
                        if (newdata[j][3] == "0.0") count3++;
                        value10 += value;

                    }

                    if (newdata[j][0] == "xl4EXfRMBrK.ZZFiCRpT37i" || newdata[j][0] == "xl4EXfRMBrK.Te9RyzefSAz" || newdata[j][0] == "xl4EXfRMBrK.sdMU6tpPki6") {
                        if (newdata[j][3] == "0.0") count4++;
                        value14 += value;

                    }
                    if (newdata[j][0] == "VBEhMPsLu53.HllvX50cXC0" || newdata[j][0] == "YVj2PYy0Slj.HllvX50cXC0" || newdata[j][0] == "ze0DbmcIajV") {
                        if (newdata[j][3] == "0.0") count5++;
                        value17 += value;

                    }
                    if (newdata[j][0] == "EHT4ON2ZtNl.HllvX50cXC0" || newdata[j][0] == "lhSRNgfsxYC.HllvX50cXC0") {
                        if (newdata[j][3] == "0.0") count6++;
                        value18 += value;

                    }
                    if (newdata[j][0] == "CAwisvSGkaj.qqJwrOzkzcz" || newdata[j][0] == "CAwisvSGkaj.G0EY8ZnkmVI" || newdata[j][0] == "CAwisvSGkaj.oSHl2cUvHmk" || newdata[j][0] == "sgdAybfDzTl.qqJwrOzkzcz" || newdata[j][0] == "sgdAybfDzTl.G0EY8ZnkmVI" || newdata[j][0] == "sgdAybfDzTl.oSHl2cUvHmk") {
                        if (newdata[j][3] == "0.0") count7++;
                        value23 += value;

                    }

                    //to see the proportion of child cases, if 5 cases in pivot of child i.e. mb, pb, unclassified, unentered and legacy.
                    if (newdata[j][0] == "TBTHguhWty1" || newdata[j][0] == "evXyDr6c7eu.ZZFiCRpT37i" || newdata[j][0] == "gVmFx873rdZ.ZZFiCRpT37i" || newdata[j][0] == "IQgrP2W9gTV.ZZFiCRpT37i") {
                        if (newdata[j][3] == "0.0") count8++;
                        value24 += value;
                    }

                }

                //if case is 0 then rate and percent must be 0 and if case is empty then rate and percent must be empty but not in child cases rate
                //for single values
                if (value1 == undefined) value1 = "";
                if (value3 == undefined) value3 = "";
                if (value5 == undefined) value5 = "";
                if (value6 == undefined) value6 = "";
                if (value7 == undefined) value7 = "";
                if (value8 == undefined) value8 = "";
                if (value9 == undefined) value9 = "";
                if (value11 == undefined) value11 = "";
                if (value12 == undefined) value12 = "";
                if (value13 == undefined) value13 = "";
                if (value15 == undefined) value15 = "";
                if (value16 == undefined) value16 = "";
                if (value19 == undefined) value19 = "";
                if (value20 == undefined) value20 = "";
                if (value21 == undefined) value21 = "";
                if (value22 == undefined) value22 = "";
                if (value25 == undefined) value25 = "";
                if (value26 == undefined) value26 = "";
                if (value27 == undefined) value27 = "";
                if (value28 == undefined) value28 = "";
                if (value29 == undefined) value29 = "";
                if (value30 == undefined) value30 = "";
                if (value31 == undefined) value31 = "";
                if (value32 == undefined) value32 = "";
                if (value33 == undefined) value33 = "";
                if (value34 == undefined) value34 = "";


                //for total value
                //Incase total value is 0 then print empty string
                if (value2 == 0) value2 = "";
                if (value4 == 0) value4 = "";
                if (value10 == 0) value10 = "";
                if (value14 == 0) value14 = "";
                if (value17 == 0) value17 = "";
                if (value18 == 0) value18 = "";
                if (value23 == 0) value23 = "";
                if (value27 == 0) value27 = "";
                if (value28 == 0) value28 = "";
                if (value30 == 0) value30 = "";
                if (value31 == 0) value31 = "";

                //changed the rate percent of 0.0 to empty string.
                if (value3 == '0.0') value3 = 0;
                if (value5 == '0.0') value5 = 0;
                if (value9 == '0.0') value9 = 0;
                if (value11 == '0.0') value11 = 0;
                if (value15 == '0.0') value15 = 0;
                if (value16 == '0.0') value16 = 0;
                if (value19 == '0.0') value19 = 0;
                if (value20 == '0.0') value20 = 0;
                if (value6 === 0) value7 = 0;
                if (value8 === 0) value9 = 0;

                if (value2 === '') value3 = '';
                if (value4 === '') value5 = '';
                if (value8 === '') value9 = '';
                if (value14 === '') { value15 = ''; value16 = ''; }

                if (count1 > 0 && value2 == 0) { value2 = 0; value3 = 0; }
                if (count2 > 0 && value4 == 0) { value4 = 0; value5 = 0; }
                if (count3 > 0 && value10 == 0) value10 = 0;
                if (count4 > 0 && value14 == 0) { value14 = 0; value15 = 0; value16 = 0; }
                if (count5 > 0 && value17 == 0) value17 = 0;
                if (count6 > 0 && value18 == 0) value18 = 0;
                if (count7 > 0 && value23 == 0) value23 = 0;
                if (count8 > 0 && value24 == 0) value11 = 0;
                if (!orgUnitPbMbCureRate[ouidRegion]) {
                    orgUnitPbMbCureRate[ouidRegion] = [];
                    orgUnitPbMbCureRate[ouidRegion]["0"] = 0;
                    orgUnitPbMbCureRate[ouidRegion]["1"] = 0;
                    orgUnitPbMbCureRate[ouidRegion]["2"] = 0;
                    orgUnitPbMbCureRate[ouidRegion]["3"] = 0;
                    orgUnitPbMbCureRate[ouidRegion]["4"] = 0;
                }





                totalValue1 += Number(value1);
                totalValue2 += Number(value2);
                totalValue3 = ((totalValue2 / totalValue1) * 100).toFixed(2);
                totalValue4 += Number(value4);
                totalValue5 = ((totalValue4 / totalValue1) * 10).toFixed(2);
                totalValue6 += Number(value6);
                totalValue7 = ((totalValue6 / totalValue2) * 100).toFixed(2);
                totalValue8 += Number(value8);
                totalValue9 = ((totalValue8 / totalValue2) * 100).toFixed(2);
                totalValue10 += Number(value10);
                totalValue11 = ((totalValue10 / totalValue2) * 100).toFixed(2);
                totalValue12 += Number(value12);
                totalValue13 += Number(value13);
                totalValue14 += Number(value14);
                totalValue15 = ((totalValue14 / totalValue2) * 100).toFixed(2);
                totalValue16 = ((totalValue14 / totalValue1) * 1000).toFixed(2);
                totalValue17 += Number(value17);
                totalValue18 += Number(value18);
                totalValue19 = orgUnitPbMbCureRate[ouidRegion]["0"];
                totalValue20 = orgUnitPbMbCureRate[ouidRegion]["1"];
                totalValue21 += Number(value21);
                totalValue22 += Number(value22);
                totalValue23 += Number(value23);
                totalValue25 += Number(value25);
                totalValue26 += Number(value26);
                totalValue27 += Number(value27);
                totalValue28 += Number(value28);
                totalValue29 = orgUnitPbMbCureRate[ouidRegion]["2"];
                totalValue30 += Number(value30);
                totalValue31 += Number(value31);
                totalValue32 = orgUnitPbMbCureRate[ouidRegion]["3"];;
                totalValue33 += Number(value33);
                totalValue34 = orgUnitPbMbCureRate[ouidRegion]["4"];;
                if (totalValue9 == 'NaN') totalValue9 = 0;
                if (totalValue11 == 'NaN') totalValue11 = 0;
                if (totalValue15 == 'NaN') totalValue15 = 0;

                ouname = orgUnitChildrenAll[ouidRegion][keys].name;
                ouidCode = orgUnitChildrenAll[ouidRegion][keys].code;
                if (ouidCode == undefined) {
                    ouidCode = '';
                }


                var tabledata = '<tr>';
                tabledata += '<td style="font:bold;">' + ouname + '</td><td style="font:bold;">' + ouidCode + '</td><td>' + value1 + '</td><td>' + value2 + '</td><td>' + value3 + '</td><td>' + value4 + '</td><td>' + value5 + '</td><td>' + value6 + '</td><td>' + value7 + '</td><td>' + value8 + '</td><td>' + value9 + '</td><td>' + value27 + '</td><td>' + value28 + '</td><td>' + value26 + '</td><td>' + value10 + '</td><td>' + value11 + '</td><td>' + value29 + '</td><td>' + value12 + '</td><td>' + value13 + '</td><td>' + value25 + '</td><td>' + value14 + '</td><td>' + value15 + '</td><td>' + value16 + '</td><td>' + value17 + '</td><td>' + value18 + '</td><td>' + value30 + '</td><td>' + value19 + '</td><td>' + value20 + '</td><td>' + value21 + '</td><td>' + value22 + '</td><td>' + value23 + '</td><td>' + value31 + '</td><td>' + value32 + '</td><td>' + value33 + '</td><td>' + value34 + '</td><td>' + value35 + '</td>';
                tabledata += '</tr>';
                document.getElementById("dataTable").innerHTML += tabledata;

                value1 = undefined; value2 = 0; value3 = undefined; value4 = 0; value5 = undefined; value6 = undefined; value7 = undefined; value8 = undefined; value9 = undefined; value10 = 0; value11 = undefined; value12 = undefined; value13 = undefined; value14 = 0; value15 = undefined; value16 = undefined; value17 = 0; value18 = 0; value19 = undefined; value20 = undefined; value21 = undefined; value22 = undefined; value23 = 0; value24 = 0; value25 = undefined; value26 = 0; value27 = 0; value28 = 0; value29 = undefined; value30 = 0; value31 = 0; value32 = undefined; value33 = undefined; value34 = undefined; value35 = "";
                count1 = 0, count2 = 0, count3 = 0, count4 = 0, count5 = 0, count6 = 0, count7 = 0, count8 = 0;
            }
            if (orgUnitLevel <= 1) {
                if (!orgUnitPbMbCureRate["WHO Global office"]) {
                    orgUnitPbMbCureRate["WHO Global office"] = [];
                    orgUnitPbMbCureRate["WHO Global office"]["0"] = 0;
                    orgUnitPbMbCureRate["WHO Global office"]["1"] = 0;
                    orgUnitPbMbCureRate["WHO Global office"]["2"] = 0;
                    orgUnitPbMbCureRate["WHO Global office"]["3"] = 0;
                    orgUnitPbMbCureRate["WHO Global office"]["4"] = 0;
                }
                globalTotalValue1 += totalValue1;
                globalTotalValue2 += Number(totalValue2);
                globalTotalValue3 = ((globalTotalValue2 / globalTotalValue1) * 100).toFixed(2);
                globalTotalValue4 += Number(totalValue4);
                globalTotalValue5 = ((globalTotalValue4 / globalTotalValue1) * 10).toFixed(2);
                globalTotalValue6 += Number(totalValue6);
                globalTotalValue7 = ((globalTotalValue6 / globalTotalValue2) * 100).toFixed(2);
                globalTotalValue8 += Number(totalValue8);
                globalTotalValue9 = ((globalTotalValue8 / globalTotalValue2) * 100).toFixed(2);
                globalTotalValue10 += Number(totalValue10);
                globalTotalValue11 = ((globalTotalValue10 / globalTotalValue2) * 100).toFixed(2);
                globalTotalValue12 += Number(totalValue12);
                globalTotalValue13 += Number(totalValue13);
                globalTotalValue14 += Number(totalValue14);
                globalTotalValue15 = ((globalTotalValue14 / globalTotalValue2) * 100).toFixed(2);
                globalTotalValue16 = ((globalTotalValue14 / globalTotalValue1) * 1000).toFixed(2);
                globalTotalValue17 += Number(totalValue17);
                globalTotalValue18 += Number(totalValue18);
                globalTotalValue19 = orgUnitPbMbCureRate["WHO Global office"]["0"];
                globalTotalValue20 = orgUnitPbMbCureRate["WHO Global office"]["1"];
                globalTotalValue21 += Number(totalValue21);
                globalTotalValue22 += Number(totalValue22);
                globalTotalValue23 += Number(totalValue23);
                globalTotalValue25 += Number(totalValue25);
                globalTotalValue26 += (totalValue26);
                globalTotalValue27 += Number(totalValue27);
                globalTotalValue28 += Number(totalValue28);
                globalTotalValue29  = orgUnitPbMbCureRate["WHO Global office"]["2"];
                globalTotalValue30 += Number(totalValue30);
                globalTotalValue31 += Number(totalValue31);
                globalTotalValue32  = orgUnitPbMbCureRate["WHO Global office"]["3"];
                globalTotalValue33 += Number(totalValue33);
                globalTotalValue34  = orgUnitPbMbCureRate["WHO Global office"]["4"];
                if (globalTotalValue9 == 'NaN') globalTotalValue9 = 0;
                if (globalTotalValue11 == 'NaN') globalTotalValue11 = 0;
                if (globalTotalValue15 == 'NaN') globalTotalValue15 = 0;

            }

            var tabledata = '<tr style="border:1px solid black; background-color:#DCDCDC">';
            tabledata += '<td style="font:bold;" colspan = "2">Total</td><td>' + Math.round(totalValue1) + '</td><td>' + totalValue2 + '</td><td>' + totalValue3 + '</td><td>' + totalValue4 + '</td><td>' + totalValue5 + '</td><td>' + totalValue6 + '</td><td>' + totalValue7 + '</td><td>' + totalValue8 + '</td><td>' + totalValue9 + '</td><td>' + totalValue27 + '</td><td>' + totalValue28 + '</td><td>' + Math.round(totalValue26) + '</td><td>' + totalValue10 + '</td><td>' + totalValue11 + '</td><td>' + totalValue29 + '</td><td>' + totalValue12 + '</td><td>' + totalValue13 + '</td><td>' + totalValue25 + '</td><td>' + totalValue14 + '</td><td>' + totalValue15 + '</td><td>' + totalValue16 + '</td><td>' + totalValue17 + '</td><td>' + totalValue18 + '</td><td>' + totalValue30 + '</td><td>' + totalValue19 + '</td><td>' + totalValue20 + '</td><td>' + totalValue21 + '</td><td>' + totalValue22 + '</td><td>' + totalValue23 + '</td><td>' + totalValue31 + '</td><td>' + totalValue32 + '</td><td>' + totalValue33 + '</td><td>' + totalValue34 + '</td><td>' + totalValue35 + '</td>';
            tabledata += '</tr>';
            totalValue1 = 0, totalValue2 = 0, totalValue3 = 0, totalValue4 = 0, totalValue5 = 0, totalValue6 = 0, totalValue7 = 0, totalValue8 = 0, totalValue9 = 0, totalValue10 = 0, totalValue11 = 0, totalValue12 = 0, totalValue13 = 0, totalValue14 = 0, totalValue15 = 0, totalValue16 = 0, totalValue17 = 0, totalValue18 = 0, totalValue19 = 0, totalValue20 = 0, totalValue21 = 0, totalValue22 = 0, totalValue23 = 0; totalValue25 = 0; totalValue26 = 0; totalValue27 = 0; totalValue28 = 0; totalValue29 = 0; totalValue30 = 0; totalValue31 = 0; totalValue32 = 0; totalValue33 = 0;; totalValue34 = 0; totalValue35 = ""

            document.getElementById("dataTable").innerHTML += tabledata;

        };
        tabledata = ''
        if (orgUnitLevel <= 1) {
            var tabledata = '<tr style="border:1px solid black; background-color:#ADD8E6">';
            tabledata += '<td style="font:bold;" colspan = "2"> Global Total</td><td>' + Math.round(globalTotalValue1) + '</td><td>' + globalTotalValue2 + '</td><td>' + globalTotalValue3 + '</td><td>' + globalTotalValue4 + '</td><td>' + globalTotalValue5 + '</td><td>' + globalTotalValue6 + '</td><td>' + globalTotalValue7 + '</td><td>' + globalTotalValue8 + '</td><td>' + globalTotalValue9 + '</td><td>' + globalTotalValue27 + '</td><td>' + globalTotalValue28 + '</td><td>' + Math.round(globalTotalValue26) + '</td><td>' + globalTotalValue10 + '</td><td>' + globalTotalValue11 + '</td><td>' + globalTotalValue29 + '</td><td>' + globalTotalValue12 + '</td><td>' + globalTotalValue13 + '</td><td>' + globalTotalValue25 + '</td><td>' + globalTotalValue14 + '</td><td>' + globalTotalValue15 + '</td><td>' + globalTotalValue16 + '</td><td>' + globalTotalValue17 + '</td><td>' + globalTotalValue18 + '</td><td>' + globalTotalValue30 + '</td><td>' + globalTotalValue19 + '</td><td>' + globalTotalValue20 + '</td><td>' + globalTotalValue21 + '</td><td>' + globalTotalValue22 + '</td><td>' + globalTotalValue23 + '</td><td>' + globalTotalValue31 + '</td><td>' + globalTotalValue32 + '</td><td>' + globalTotalValue33 + '</td><td>' + globalTotalValue34 + '</td><td>' + globalTotalValue35 + '</td>';
            tabledata += '</tr>';
        }


        document.getElementById("dataTable").innerHTML += tabledata;
        document.getElementById("loader").style.display = "none";
        document.getElementById("printing").style.display = "block";
    });
    function datavalue(value) {

        if (value.indexOf('e') > 0 || value.indexOf('E') > 0) {
            value = scientificToDecimal(value);
        } else {
            value = parseFloat(value).toFixed(2);
        }

        return value;
    };
    function scientificToDecimal(num) {
        const sign = Math.sign(num);
        //if the number is in scientific notation remove it
        if (/\d+\.?\d*e[\+\-]*\d+/i.test(num)) {
            const zero = '0';
            const parts = String(num).toLowerCase().split('e'); //split into coeff and exponent
            const e = parts.pop(); //store the exponential part
            let l = Math.abs(e); //get the number of zeros
            const direction = e / l; // use to determine the zeroes on the left or right
            const coeff_array = parts[0].split('.');

            if (direction === -1) {
                coeff_array[0] = Math.abs(coeff_array[0]);
                num = zero + '.' + new Array(l).join(zero) + coeff_array.join('');
            }
            else {
                const dec = coeff_array[1];
                if (dec) l = l - dec.length;
                num = coeff_array.join('') + new Array(l + 1).join(zero);
            }
        }

        if (sign < 0) {
            num = -num;
        }

        return num;
    }
    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="https://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            document.getElementById("show").style.display = "block";
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename;
            document.getElementById("dlink").click();
            document.getElementById("show").style.display = "none";
        }
    })()
</script>