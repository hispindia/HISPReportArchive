<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
    integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<style>
    thead>tr>td {
        font-weight: bold;
    }

    tbody>tr>td {
        font-weight: bold;
    }

    /* Center the loader  */

    #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #34B4DB;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Add animation to "page content" */

    .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0px;
            opacity: 1
        }
    }

    @keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }

        to {
            bottom: 0;
            opacity: 1
        }
    }

    #printing {

        text-align: center;
    }
</style>

<a id="dlink" style="display:none;"></a>
<button type="button" class="btn btn-primary btn-sm" style="vertical-align: middle;"
    onclick="printContent('printing')"><span class="glyphicon glyphicon-print" style="font-size: 15px;"></span> &nbsp;
    Print
</button>

<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;font-size: 15px;" id="btnExport"
    onclick="tableToExcel('printing', 'Cost Estimates Rifampicin requirement for PEP_10 years', 'Cost Estimates Rifampicin requirement for PEP_10 years')"><span
        class="glyphicon glyphicon-download-alt" ></span>Download As Excel</button>

<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;font-size: 15px;" id="btnExport"
    onclick="tableToExcel('printing', 'Cost Estimates Rifampicin requirement for PEP_10 years', 'Cost Estimates Rifampicin requirement for PEP_10 years.doc')"><span
        class="glyphicon glyphicon-download-alt" ></span>Download As Doc</button>
<br><br>
<!-- <div id="loader" style="display: block;"></div> -->
<div id="printing" class="animate-bottom">
    <div id='state'>
        <table id="dataTable" border="1" class="table  table-hover text-center" cellspacing="6" cellpadding="4"
            style=" text-align: center;width:100%">
            <tr style=" font:bold; text-align:center;">
                <td colspan="12" style="border:1px solid black; background-color: #dce6f1; text-align: center">Cost Estimates Rifampicin requirement for PEP_10 years</td>
            </tr>
            <tr>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: left">Number of cases reported in 2021 (previous year)</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Number of contacts expected per index case</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Total contacts expected </td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Age group and Body weight</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Proportion in population percentage % </td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Number of contacts</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Rifampicin formulations Capsule  dosage in mg</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Number of capsules</td>
                <td rowspan="2" style="border:1px solid black; background-color: #dce6f1; text-align: center">Total capsules per age group</td>
                <td colspan="3" style="border:1px solid black; background-color: #dce6f1; text-align: center">Total needs per capsule and Syrup doses</td>
            </tr>
            <tr>
                <td style="border:1px solid black; background-color: #dce6f1; text-align: center">150 mg capsule</td>
                <td style="border:1px solid black; background-color: #dce6f1; text-align: center">300 mg capsule</td>
                <td style="border:1px solid black; background-color: #dce6f1; text-align: center">200 ml Syrup</td>
            </tr>
            <tr>
                <td rowspan="6" style="border:1px solid black;  text-align: center"><span id="A3"></span></td>
                <td rowspan="6" style="border:1px solid black;  text-align: center">45</td>
                <td rowspan="6" style="border:1px solid black;  text-align: center"><span id="C3"></span></td>
                <td style="border:1px solid black;  text-align: center"><span>≥ 15 years</span></td>
                <td style="border:1px solid black;  text-align: center"><span>52</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="F3"></span></td>
                <td style="border:1px solid black;  text-align: center"><span>300 mg</span></td>
                <td style="border:1px solid black;  text-align: center"><span>2</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="I3"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K3"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td rowspan="2" style="border:1px solid black;  text-align: center">10-14 years</td>
                <td rowspan="2" style="border:1px solid black;  text-align: center">12</td>
                <td rowspan="2" style="border:1px solid black;  text-align: center"><span id="F4"></span></td>
                <td style="border:1px solid black;  text-align: center">300 mg</td>
                <td style="border:1px solid black;  text-align: center">1</td>
                <td style="border:1px solid black;  text-align: center"><span id="I4"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K4"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td style="border:1px solid black;  text-align: center"><span>150 mg</span></td>
                <td style="border:1px solid black;  text-align: center"><span>1</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="I5"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="J5"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td style="border:1px solid black;  text-align: center"><span>6-9 years (≥ 20 kg)</span></td>
                <td style="border:1px solid black;  text-align: center"><span>5</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="F6"></span></td>
                <td style="border:1px solid black;  text-align: center"><span >300 mg</span></td>
                <td style="border:1px solid black;  text-align: center"><span >1</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="I6"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K6"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td style="border:1px solid black;  text-align: center"><span>6-9 years ( < 20 kg) </span></td>
                <td style="border:1px solid black;  text-align: center"><span>10</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="F7"></span></td>
                <td style="border:1px solid black;  text-align: center"><span >150 mg</span></td>
                <td style="border:1px solid black;  text-align: center"><span >1</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="I7"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="J7"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td style="border:1px solid black;  text-align: center"><span >2-5 Years</span></td>
                <td style="border:1px solid black;  text-align: center"><span >11</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="F8"></span></td>
                <td style="border:1px solid black;  text-align: center"><span >100 mg</span></td>
                <td style="border:1px solid black;  text-align: center"><span >100 mg/ 5 ml</span></td>
                <td style="border:1px solid black;  text-align: center"><span id="I8"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="L8"></span></td>
            </tr>
            <tr>
                <td rowspan="11" colspan="3" style="border:1px solid black;  text-align: center"></td>
                <td colspan="6" style="border:1px solid black;  text-align: left">Total capsules (exact)</td>
                <td style="border:1px solid black;  text-align: center"><span id="J9"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="K9"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="6" style="border:1px solid black;  text-align: left">Total Rifampcin syrup bottles</td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="6" style="border:1px solid black;  text-align: left">Total capsules (rounded) (to be ordered)</td>
                <td style="border:1px solid black;  text-align: center"><span id="J11"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="K11"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="L11"></span></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left">Rifampicin 150mg (Lupin) strip of 10 capsules INR = 50.15</td>
                <td style="border:1px solid black;  text-align: center">21</td>
                <td style="border:1px solid black;  text-align: center"><span id="J12"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left">Rifampicin 150mg (Lupin) strip of 10 capsules US$ = 0.70</td>
                <td style="border:1px solid black;  text-align: center"><span id="I13"></span></td>
                <td style="border:1px solid black;  text-align: center"><span id="J13"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left"><b>Rifampicin 300mg (Lupin) strip of 10 capsules INR =45.00</b></td>
                <td style="border:1px solid black;  text-align: center">45</td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K14"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left"><b>Rifampicin 300mg (Lupin) strip of 10 capsules US$ =0.625</b></td>
                <td style="border:1px solid black;  text-align: center"><span id="I15"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K15"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left"><b>Rifampicin Syrup 200ml (Novartis) INR = 66.00</b></td>
                <td style="border:1px solid black;  text-align: center">66</td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K16"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="5" style="border:1px solid black;  text-align: left"><b>Rifampicin Syrup 200ml (Novartis) US$ = 0.92</b></td>
                <td style="border:1px solid black;  text-align: center"><span id="I17"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K17"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="6" style="border:1px solid black;  text-align: left"><b>Total Costs for Single Dose Rifampicin for one year INR</b></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K18"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
            <tr>
                <td colspan="6" style="border:1px solid black;  text-align: left"><b>Total Costs for Single Dose Rifampicin for one year US$</b></td>
                <td style="border:1px solid black;  text-align: center"></td>
                <td style="border:1px solid black;  text-align: center"><span id="K19"></span></td>
                <td style="border:1px solid black;  text-align: center"></td>
            </tr>
        </table>
    </div>
</div>

<!--  script -->
<script type="text/javascript">
    var selectedOrgUnit = dhis2.report.organisationUnit;
    var period = Number(dhis2.report.periods[0])-1;
    $.ajax({
                type: "GET",
                async: false,
                url: "../api/29/analytics.json?dimension=pe:"+period+"&dimension=dx:gY7b9azcUQG;&dimension=ou:"+selectedOrgUnit.id+"&displayProperty=NAME&outputIdScheme=UID",
                data: JSON,
                success: function (data, status) {
                    if(data.rows.length>0){
                    data.rows.forEach(element => {
                    let C3 = Number(element[3])*45
                    let F3= Math.round(C3/100*52)
                    let F4= Math.round(C3/100*12)
                    let F6= Math.round(C3/100*5)
                    let F7= Math.round(C3/100*10)
                    let F8= Math.round(C3/100*11)
                    let I3= F3*1
                    let I4= F4*1
                    let I5= F4*1
                    let I6= F6*1
                    let I7= F7*1
                    let I8= 92550
                    let J9 = I5+I7 
                    let K9 = I3+I4+I6
                    let J11 = J9
                    let K11 = K9
                    let L9 = 4650
                    let L11 = L9
                    let J12 = Math.round(J11/10*21)
                    let J13 = Math.round(J12/72)
                    let I13 = (21/72).toFixed(2)
                    let K14 = Math.round(K11/10*45)
                    let K15 = Math.round(K14/72)
                    let I15 = 45/72
                    let K16 = 66*L11
                    let I17 = (66/72).toFixed(2)
                    let K17 = I17*L11
                    let K18 = Number(J12)+Number(K14)+Number(K16)
                    let K19 = Number(J13)+Number(K15)+Number(K17)
                    document.getElementById("A3").innerHTML = Math.round(Number(element[3]))
                    document.getElementById("C3").innerHTML = C3
                    document.getElementById("F3").innerHTML = F3
                    document.getElementById("I3").innerHTML = I3
                    document.getElementById("K3").innerHTML = I3
                    document.getElementById("F4").innerHTML = F4
                    document.getElementById("I4").innerHTML = I4
                    document.getElementById("K4").innerHTML = I4
                    document.getElementById("I5").innerHTML = I5
                    document.getElementById("J5").innerHTML = I5
                    document.getElementById("F6").innerHTML = F6
                    document.getElementById("I6").innerHTML = I6
                    document.getElementById("K6").innerHTML = I6
                    document.getElementById("F7").innerHTML = F7
                    document.getElementById("I7").innerHTML = I7
                    document.getElementById("J7").innerHTML = I7
                    document.getElementById("F8").innerHTML = F8
                    document.getElementById("I8").innerHTML = I8
                    document.getElementById("L8").innerHTML = Math.round(I8/4)
                    document.getElementById("J9").innerHTML = J9
                    document.getElementById("K9").innerHTML = K9
                    document.getElementById("J11").innerHTML = J11
                    document.getElementById("K11").innerHTML = K11
                    document.getElementById("L11").innerHTML = L11
                    document.getElementById("J12").innerHTML = J12
                    document.getElementById("I13").innerHTML = I13
                    document.getElementById("J13").innerHTML = J13
                    document.getElementById("K14").innerHTML = K14
                    document.getElementById("I15").innerHTML = I15
                    document.getElementById("K16").innerHTML = K16
                    document.getElementById("I17").innerHTML = I17
                    document.getElementById("K17").innerHTML = K17
                    document.getElementById("K18").innerHTML = Math.round(K18)
                    document.getElementById("K19").innerHTML =Math.round(K19)
                });
               }
                }
            });
    

    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }

    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="https://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename;
            document.getElementById("dlink").click();
        }
    })()
</script>