<table id="buttonTable">
    <tr>
        <td>   
            <button id="btnExport" onclick="tableToExcel('tableData', 'MDT request report','MDT request Report_' + province.name + '_' + period+' .xls')">
                Downlaod Excel </button>
        </td>
    </tr>
    <a id="dlink" style="display:none;"></a>
</table>
<div id="printing">
<table id="tableData" style="border-collapse: collapse; width: 100%;  padding: 10px;" cellpadding="10">
</table>
</div>
<script type="text/javascript">
     var IdArr = [
"oLEab4Rhnwr.LTQHOPaKMQJ",
"oLEab4Rhnwr.YHDqMJmO2Md", 
"oLEab4Rhnwr.xhJy8oBojWx",
"oLEab4Rhnwr.MrHELxsViH0",
"dhUDcZGjdk0.eatfMXElyaF",
"dhUDcZGjdk0.XBRpTGM2aXx",
"dhUDcZGjdk0.IebHHBxqmFY",
"dhUDcZGjdk0.DjfdPEUrnuX",
"Ftxqss9Mg5Q.eatfMXElyaF",
"Ftxqss9Mg5Q.XBRpTGM2aXx",
"Ftxqss9Mg5Q.IebHHBxqmFY",
"Ftxqss9Mg5Q.DjfdPEUrnuX",
"wqrCGRNetor.eatfMXElyaF",
"wqrCGRNetor.XBRpTGM2aXx",
"wqrCGRNetor.IebHHBxqmFY",
"wqrCGRNetor.DjfdPEUrnuX",
"pJzIZRMUQQr.eatfMXElyaF",
"pJzIZRMUQQr.XBRpTGM2aXx", 
"pJzIZRMUQQr.IebHHBxqmFY",
"pJzIZRMUQQr.DjfdPEUrnuX",

    ]

    // BegIjKlQ3TH.PmDbUbKCU9h, BegIjKlQ3TH.FLsghokqIM3, BegIjKlQ3TH.CSoPBbcmmVv
    // dhUDcZGjdk0.HllvX50cXC0 expect
    // Ftxqss9Mg5Q.HllvX50cXC0 stock
    // wqrCGRNetor.yPXfTqw9GFV patient
    // wqrCGRNetor.x4buGmmlFHz 
   // var  totalRegister= 0, totMDT =0, 
    var printValue = [];
	for (let i = 0; i < IdArr.length; i++) {
		printValue[IdArr[i]] = 0;
    }
    var district = dhis2.report.organisationUnitHierarchy;
    var province = dhis2.report.organisationUnit;
    var periods = dhis2.report.date;
    var value;
    var value1 =0, value2=0, value3=0, value4=0, value5 =0, value6 =0, value7=0, value8=0;
    var val1 =0, val2=0, val3=0, val4=0, val5 =0, val6 =0, val7=0, val8=0;
    var value9 =0, value10=0, value11=0, value12=0, value13 =0, value14 =0, value15=0, value16=0;
    var value17 =0, value18=0, value19=0, value20=0, value21 =0, value22 =0, value23=0, value24=0;
    var value25 =0, value26=0, value27=0, value28=0, value29 =0, value30 =0, value31=0, value32=0;
	var dataJsonObj;
	var urls = window.location.href;
    var params = urls.split('=');
	var ou = params[3];
	// var period = periods.substr(0, 4);
    var period = params[2].substr(0, 6);
	var quater = params[2].substr(4,2);
    var Quat; 
    if(quater == "Q1"){  Quat = "Jan to Mar"}
    if(quater == "Q2"){  Quat = "Apr to Jun"}
    if(quater == "Q3"){  Quat = "Jul to Sep"}
    if(quater == "Q4"){  Quat = "Oct to Dec"}
    var year = params[2].substr(0, 4);
	console.log('here is url',ou, urls, params[2], period);
    apiCall();
	function apiCall() {
          var url = "../api/dataValueSets.json?dataSet=X4kGPBY1WeG&orgUnit="+ ou +"&period="+ period;
          // var url = "../api/dataValueSets.json?dataSet=X4kGPBY1WeG&orgUnit="+ ou +"&period="+ period;
    $.get(url, function (json){
			dataJsonObj = json;
             value = dataJsonObj.dataValues;
            console.log('here is  value', value, dataJsonObj)
            if(value != undefined ) {
			    value.forEach(element => {
				dataElementId = element.dataElement;
				categoryOptionComboId = element.categoryOptionCombo;
				var joinId = dataElementId.concat('.',categoryOptionComboId);
				for ( let i=0; i<=IdArr.length; i++) {
						if(IdArr[i] === joinId) {
						printValue[IdArr[i]]=element.value;
					}
                    if(joinId === "oLEab4Rhnwr.LTQHOPaKMQJ") {
						value1=element.value *3;
                        val1 =element.value;
					}
                    if(joinId === "oLEab4Rhnwr.YHDqMJmO2Md") {
						value2=element.value *3;
                        val2 =element.value;

					}
                    if(joinId === "oLEab4Rhnwr.xhJy8oBojWx") {
						value3=element.value *3;
                        val3 =element.value;
                        
					}
                    if(joinId === "oLEab4Rhnwr.MrHELxsViH0") {
						value4=element.value *3;
                        val4 =element.value;

					}
                    if(joinId === "dhUDcZGjdk0.eatfMXElyaF") {
						value5=element.value *3;
                        val5 =element.value;

					}
                    if(joinId === "dhUDcZGjdk0.XBRpTGM2aXx") {
						value6=element.value *3;
                        val6 =element.value;

					}
                    if(joinId === "dhUDcZGjdk0.IebHHBxqmFY") {
						value7=element.value *3;
                        val7 =element.value;

					}
                    if(joinId === "dhUDcZGjdk0.DjfdPEUrnuX") {
						value8=element.value *3;
                        val8 =element.value;

					}
                    value9 = value3+value5;
                    value10 = value4+value6;
                    value11 = value1+value7;
                    value12 = value2+value8;

                    if(joinId === "Ftxqss9Mg5Q.eatfMXElyaF") {
						value13= value9 - element.value;
					}
                    if(joinId === "Ftxqss9Mg5Q.XBRpTGM2aXx") {
						value14= value10 - element.value;
					}
                    if(joinId === "Ftxqss9Mg5Q.IebHHBxqmFY") {
						value15= value11 - element.value;
					}
                    if(joinId === "Ftxqss9Mg5Q.DjfdPEUrnuX") {
						value16= value12 - element.value;
					}
                    value17 = val1 + val5;
                    value18 = val2 + val6;
                    value19 = val3 + val7;
                    value20 = val4 + val8;

                    value21 = value13 + value17;
                    value22 = value14 + value18;
                    value23 = value15 + value19;
                    value24 = value16 + value20;

                    if(joinId === "wqrCGRNetor.eatfMXElyaF") {
						value25= 366* element.value;
					}
                    if(joinId === "wqrCGRNetor.XBRpTGM2aXx") {
						value26= 366* element.value;
					}
                    if(joinId === "wqrCGRNetor.IebHHBxqmFY") {
						value27= 366* element.value;
					}
                    if(joinId === "wqrCGRNetor.DjfdPEUrnuX") {
						value28= 366* element.value;
					}

                    if(joinId === "pJzIZRMUQQr.eatfMXElyaF") {
						value29= 360* element.value;
					}
                    if(joinId === "pJzIZRMUQQr.XBRpTGM2aXx") {
						value30= 360* element.value;
					}
                    if(joinId === "pJzIZRMUQQr.IebHHBxqmFY") {
						value31= 360* element.value;
					}
                    if(joinId === "pJzIZRMUQQr.DjfdPEUrnuX") {
						value32= 360* element.value;
					}
				}
            });
            }
			
           document.getElementById("tableData").innerHTML ='<tr style="font-weight:800">\
    <td colspan="6" style="width:450.8pt; border:solid windowtext 1.0pt" width="601" bgcolor="#FFFFCC" align="center">\
        <p align="center"><font color="#000000"><b><h2>MDT request form</h2></b></font></p>\
    </td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black; padding: 20px 5px 20px 5px;" bgcolor="#FFFFCC">Health Service Center:\
    <span style="border:1px solid black; background-color: white; text-align: center; padding: 10px 5px 10px 5px;">'+ province.name +'&nbsp; &nbsp; &nbsp; &nbsp;</span>\</td>\
    <td colspan="4" style="border:1px solid black; padding: 20px 5px 20px 5px;" bgcolor="#FFFFCC">Year:\
    <span style="border:1px solid black; background-color: white; text-align: center; padding: 10px 20px 10px 20px;">' +Quat+' '+year+ '</span>\
    </td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" align="center"><b>Indicator</b></td>\
    <td colspan="1" style="border:1px solid black;" bgcolor="#FFFFCC" align="center"><b>MB-adult</b></td>\
    <td colspan="1" style="border:1px solid black;" bgcolor="#FFFFCC" align="center"><b>MB-child</b></td>\
    <td colspan="1" style="border:1px solid black;" bgcolor="#FFFFCC" align="center"><b>PB-adult</b></td>\
    <td colspan="1" style="border:1px solid black;" bgcolor="#FFFFCC" align="center"><b>PB-child</b></td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC">Number of registered cases in the end of this quarter</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["oLEab4Rhnwr.xhJy8oBojWx"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["oLEab4Rhnwr.MrHELxsViH0"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["oLEab4Rhnwr.LTQHOPaKMQJ"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["oLEab4Rhnwr.YHDqMJmO2Md"] +'</td>\
    </tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC"> MDT required for no 1 treatment </td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value3+ '</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value4 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value1 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value2+ '</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC">Expected new cases for this quarter</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["dhUDcZGjdk0.eatfMXElyaF"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["dhUDcZGjdk0.XBRpTGM2aXx"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["dhUDcZGjdk0.IebHHBxqmFY"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["dhUDcZGjdk0.DjfdPEUrnuX"] +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >MDT required for new cases</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value5 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value6 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value7 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value8 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Total Calculated MDT required </td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value9 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value10 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value11 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value12 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC">Current Stock MDT</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["Ftxqss9Mg5Q.eatfMXElyaF"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["Ftxqss9Mg5Q.XBRpTGM2aXx"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["Ftxqss9Mg5Q.IebHHBxqmFY"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["Ftxqss9Mg5Q.DjfdPEUrnuX"] +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Total MDT required for this quarter</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value13 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value14 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value15 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value16 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Buffer Stock for 1 months </td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value17 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value18 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value19 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value20 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC">Total MDT to be supplied this quarter </td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value21 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value22 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value23 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value24 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Number of patient suffered from severe leprosy reaction</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["wqrCGRNetor.eatfMXElyaF"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["wqrCGRNetor.XBRpTGM2aXx"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["wqrCGRNetor.IebHHBxqmFY"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["wqrCGRNetor.DjfdPEUrnuX"] +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Prednison required for number 10 tabs</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value25 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value26 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value27 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value28 +'</td>\
</tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC">Number of recurrent ENL patients</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["pJzIZRMUQQr.eatfMXElyaF"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["pJzIZRMUQQr.XBRpTGM2aXx"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["pJzIZRMUQQr.IebHHBxqmFY"] +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ printValue["pJzIZRMUQQr.DjfdPEUrnuX"] +'</td>\
    </tr>\
<tr style="font-weight:800">\
    <td colspan="2" style="border:1px solid black;" bgcolor="#FFFFCC" >Lamprene required for no 12 </td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value29 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value30 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value31 +'</td>\
    <td colspan="1" style="border:1px solid black;" align="center">'+ value32 +'</td>\
</tr>'
  });
}
</script>
<script>
    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            // if (!table.nodeType) 
            table = document.getElementById(table);
            // table1 = document.getElementById(table[1]);
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename;
            document.getElementById("dlink").click();
        }
    })()
</script>
